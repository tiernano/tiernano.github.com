/*
 MIT
 @url http://livepipe.net/projects/control_modal/
 @version 2.2.3
*/
(function(a){var b={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},c=function(g,e,j){var k=e||window;g=g?g.split(/\./):[];for(var m=0;m<g.length-1&&k;m++)k=k[g[m]]||j&&(k[g[m]]={});if(g.length==0)return e;e=k[g[m]]||j&&(k[g[m]]={});j===false&&delete k[g[m]];return e},d=a.String={getObject:c,strip:function(g){return g.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(g){return g.charAt(0).toUpperCase()+
g.substr(1)},endsWith:function(g,e){var j=g.length-e.length;return j>=0&&g.lastIndexOf(e)===j},camelize:function(g){g=g.split(b.undHash);var e=1;for(g[0]=g[0].charAt(0).toLowerCase()+g[0].substr(1);e<g.length;e++)g[e]=d.capitalize(g[e]);return g.join("")},classize:function(g){g=g.split(b.undHash);for(var e=0;e<g.length;e++)g[e]=d.capitalize(g[e]);return g.join("")},niceName:function(g){g=g.split(b.undHash);for(var e=0;e<g.length;e++)g[e]=d.capitalize(g[e]);return g.join(" ")},underscore:function(g){return g.replace(b.colons,
"/").replace(b.words,"$1_$2").replace(b.lowerUpper,"$1_$2").replace(b.dash,"_").toLowerCase()},sub:function(g,e,j){var k=[];k.push(g.replace(b.replacer,function(m,q){var w=c(q,e,!j),u=typeof w;if((u==="object"||u==="function")&&u!==null){k.push(w);return""}else return""+w}));return k.length<=1?k[0]:k}}})(jQuery);
(function(a){var b=false,c=a.makeArray,d=a.isFunction,g=a.isArray,e=/xyz/.test(function(){})?/\b_super\b/:/.*/,j=function(m,q,w){w=w||m;for(var u in m)w[u]=d(m[u])&&d(q[u])&&e.test(m[u])?function(r,v){return function(){var h=this._super,l;this._super=q[r];l=v.apply(this,arguments);this._super=h;return l}}(u,m[u]):m[u]},k=a.Class=function(){arguments.length&&k.extend.apply(k,arguments)};a.extend(k,{callback:function(m){var q=c(arguments),w;m=q.shift();g(m)||(m=[m]);w=this;return function(){for(var u=
q.concat(c(arguments)),r,v=m.length,h=0,l;h<v;h++)if(l=m[h]){if((r=typeof l=="string")&&w._set_called)w.called=l;u=(r?w[l]:l).apply(w,u||[]);if(h<v-1)u=!g(u)||u._use_call?[u]:u}return u}},getObject:a.String.getObject,newInstance:function(){var m=this.rawInstance(),q;if(m.setup)q=m.setup.apply(m,arguments);if(m.init)m.init.apply(m,g(q)?q:arguments);return m},setup:function(m){this.defaults=a.extend(true,{},m.defaults,this.defaults);return arguments},rawInstance:function(){b=true;var m=new this;b=false;
return m},extend:function(m,q,w){function u(){if(!b)return this.constructor!==u&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof m!="string"){w=q;q=m;m=null}if(!w){w=q;q=null}w=w||{};var r=this.prototype,v,h,l,n;b=true;n=new this;b=false;j(w,r,n);for(v in this)if(this.hasOwnProperty(v)&&a.inArray(v,["prototype","defaults","getObject"])==-1)u[v]=this[v];j(q,this,u);if(m){l=m.split(/\./);h=l.pop();l=r=k.getObject(l.join("."),
window,true);r[h]=u}a.extend(u,{prototype:n,namespace:l,shortName:h,constructor:u,fullName:m});u.prototype.Class=u.prototype.constructor=u;h=u.setup.apply(u,[this].concat(c(arguments)));if(u.init)u.init.apply(u,h||[]);return u}});k.prototype.callback=k.callback})(jQuery);LowPro={};LowPro.Version="0.5";LowPro.CompatibleWithPrototype="1.6";
Prototype.Version.indexOf(LowPro.CompatibleWithPrototype)!=0&&window.console&&window.console.warn&&console.warn("This version of Low Pro is tested with Prototype "+LowPro.CompatibleWithPrototype+" it may not work as expected with this version ("+Prototype.Version+")");if(!Element.addMethods)Element.addMethods=function(a){Object.extend(Element.Methods,a)};DOM={};
DOM.Builder={tagFunc:function(a){return function(){var b,c;if(arguments.length>0){if(arguments[0].constructor==Object){b=arguments[0];c=Array.prototype.slice.call(arguments,1)}else c=arguments;c=$A(c).flatten()}return DOM.Builder.create(a,b,c)}},create:function(a,b,c){b=b||{};c=c||[];a=a.toLowerCase();a=new Element(a,b);for(b=0;b<c.length;b++){if(typeof c[b]=="string")c[b]=document.createTextNode(c[b]);a.appendChild(c[b])}return $(a)}};
(function(){for(var a="p|div|span|strong|em|img|table|tr|td|th|thead|tbody|tfoot|pre|code|h1|h2|h3|h4|h5|h6|ul|ol|li|form|input|textarea|legend|fieldset|select|option|blockquote|cite|br|hr|dd|dl|dt|address|a|button|abbr|acronym|script|link|style|bdo|ins|del|object|param|col|colgroup|optgroup|caption|label|dfn|kbd|samp|var".split("|"),b,c=0;b=a[c++];)window["$"+b]=DOM.Builder.tagFunc(b)})();
DOM.Builder.fromHTML=function(a){var b;if(!(b=arguments.callee._root))b=arguments.callee._root=document.createElement("div");b.innerHTML=a;return b.childNodes[0]};Object.extend(Event,{onReady:function(a){document.body?a():document.observe("dom:loaded",a)}});
Event.addBehavior=function(a){var b=this.addBehavior;Object.extend(b.rules,a);if(!b.responderApplied){Ajax.Responders.register({onComplete:function(){Event.addBehavior.reassignAfterAjax&&setTimeout(function(){b.reload()},10)}});b.responderApplied=true}b.autoTrigger&&this.onReady(b.load.bind(b,a))};Event.delegate=function(a){return function(b){for(var c in a)if(b.findElement(c))return a[c].apply(this,$A(arguments))}};
Object.extend(Event.addBehavior,{rules:{},cache:[],reassignAfterAjax:false,autoTrigger:true,load:function(a){for(var b in a){var c=a[b];b.split(",").each(function(d){d=d.split(/:(?=[a-z]+$)/);var g=d[1];$$(d[0]).each(function(e){if(g){var j=Event.addBehavior._wrapObserver(c);$(e).observe(g,j);Event.addBehavior.cache.push([e,g,j])}else if(!e.$$assigned||!e.$$assigned.include(c)){c.attach?c.attach(e):c.call($(e));e.$$assigned=e.$$assigned||[];e.$$assigned.push(c)}})})}},unload:function(){this.cache.each(function(a){Event.stopObserving.apply(Event,
a)});this.cache=[]},reload:function(){var a=Event.addBehavior;a.unload();a.load(a.rules)},_wrapObserver:function(a){return function(b){a.call(this,b)===false&&b.stop()}}});Event.observe(window,"unload",Event.addBehavior.unload.bind(Event.addBehavior));$$$=Event.addBehavior.bind(Event);
var Behavior={create:function(){var a=null,b=$A(arguments);if(Object.isFunction(b[0]))a=b.shift();var c=function(){if(this.initialize){g=arguments.length==2&&arguments[1]instanceof Array?arguments[1]:Array.prototype.slice.call(arguments,1);this.element=$(arguments[0]);this.initialize.apply(this,g);c._bindEvents(this);c.instances.push(this)}else{var g=$A(arguments);return function(){var e=[this].concat(g);c.attach.apply(c,e)}}};Object.extend(c,Class.Methods);Object.extend(c,Behavior.Methods);c.superclass=
a;c.subclasses=[];c.instances=[];if(a){var d=function(){};d.prototype=a.prototype;c.prototype=new d;a.subclasses.push(c)}for(a=0;a<b.length;a++)c.addMethods(b[a]);if(!c.prototype.initialize)c.prototype.initialize=Prototype.emptyFunction;return c.prototype.constructor=c},Methods:{attach:function(a){return new this(a,Array.prototype.slice.call(arguments,1))},_bindEvents:function(a){for(var b in a){var c=b.match(/^on(.+)/);c&&typeof a[b]=="function"&&a.element.observe(c[1],Event.addBehavior._wrapObserver(a[b].bindAsEventListener(a)))}}}};
Remote=Behavior.create({initialize:function(a){if(this.element.nodeName=="FORM")new Remote.Form(this.element,a);else new Remote.Link(this.element,a)}});
Remote.Base={initialize:function(a){this.options=Object.extend({evaluateScripts:true},a||{});this._bindCallbacks()},_makeRequest:function(a){if(a.update)new Ajax.Updater(a.update,a.url,a);else new Ajax.Request(a.url,a);return false},_bindCallbacks:function(){$w("onCreate onComplete onException onFailure onInteractive onLoading onLoaded onSuccess").each(function(a){if(Object.isFunction(this.options[a]))this.options[a]=this.options[a].bind(this)}.bind(this))}};
Remote.Link=Behavior.create(Remote.Base,{onclick:function(){return this._makeRequest(Object.extend({url:this.element.href,method:"get"},this.options))}});
Remote.Form=Behavior.create(Remote.Base,{onclick:function(a){a=a.element();if(["input","button"].include(a.nodeName.toLowerCase())&&["submit","image"].include(a.type))this._submitButton=a},onsubmit:function(){var a=Object.extend({url:this.element.action,method:this.element.method||"get",parameters:this.element.serialize({submit:this._submitButton.name})},this.options);this._submitButton=null;return this._makeRequest(a)}});
Observed=Behavior.create({initialize:function(a,b){this.callback=a.bind(this);this.options=b||{};this.observer=this.element.nodeName=="FORM"?this._observeForm():this._observeField()},stop:function(){this.observer.stop()},_observeForm:function(){return this.options.frequency?new Form.Observer(this.element,this.options.frequency,this.callback):new Form.EventObserver(this.element,this.callback)},_observeField:function(){return this.options.frequency?new Form.Element.Observer(this.element,this.options.frequency,
this.callback):new Form.Element.EventObserver(this.element,this.callback)}});Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();Ajax.activeRequestCount--};if(typeof console==="undefined")console={log:function(){}};function trace(a){try{console.log(a)}catch(b){}}
var PChangedEvent=Class.create({initialize:function(a,b){this.changedObject=a;this.attribute=null;this.type="change";Object.extend(this,b)}}),PBaseModel=Class.create({initialize:function(a){this.changeListeners=[];this.destroyed=false;Object.extend(this,a);this.attribute_names=[];$H(a).each(function(b){this.attribute_names.push(b.key)}.bind(this))},getModelName:function(){return"PBaseModel"},serializeAttr:function(a,b){return b.get(a)},serialize:function(){var a=$H(this),b=new Hash;this.attribute_names.each(function(c){b.set(c,
this.serializeAttr(c,a))}.bind(this));return b},destroy:function(){trace("destroy called!");this.destroyed=true;this.fireChange({type:"destroy"})},addChangeListener:function(a){this.changeListeners.push(a)},removeChangeListener:function(a){this.changeListeners=this.changeListeners.without(a)},fireChange:function(a){var b=new PChangedEvent(this,a);this.changeListeners.each(function(c){c(b)})},getId:function(){return this.id}});
document.observe("dom:loaded",function(){$("feedback_anchor")&&new PModal("feedback_anchor","/main/feedback",{},{});$$(".CodeRay").each(function(a){a.observe("click",function(){a.toggleClassName("hide_numbers")})})});
var PModal=Class.create({initialize:function(a,b,c,d){this.options=Object.extend({opacity:0.5,position:"absolute",width:500,height:570,identifier:null,modalTitle:null,padContents:true,onComplete:function(){},onSuccess:function(){},onFailure:function(){}},d||{});this.options.beforeOpen=this.openHandler.bindAsEventListener(this);this.options.beforeClose=this.closeHandler.bindAsEventListener(this);this.identifier=(this.action_id=$(a))?this.action_id.getAttribute("id"):this.options.identifier;this.target_callback=
b;this.parameters=c||{};this.action_id&&this.action_id.observe("click",this.click.bindAsEventListener(this));this.action_id&&this.action_id.getAttribute("href")&&this.action_id.setAttribute("href","#")},openHandler:function(){$$("object, embed").each(function(a){a.hide()})},closeHandler:function(){$$("object, embed").each(function(a){a.show()})},click:function(a){a&&a.stop();this.modal=Control.Modal.open('<div id="modal_'+this.identifier+'" style="padding: 5px;"><img src="/images/loading.gif"></div>',
this.options);this.modalDiv=$("modal_"+this.identifier);new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,onSuccess:function(b){this.response=b.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.modalDiv.update(this.response);this.modalDiv.select(".close_modal_button").each(function(c){c.observe("click",function(d){Event.stop(d);Control.Modal.close()})});this.options.onSuccess()}.bindAsEventListener(this),
onFailure:function(){this.options.onFailure();alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},getContainerNode:function(){return $("modal_"+this.identifier)},finishLazyLoad:function(){this.modalDiv.update(this.response)}});PModal.click_listener_hash=new Hash;
PModal2=Class.create(PModal,{click:function(a){a&&a.stop();PModal2.currentModal=this;this.modal=Control.Modal.open('<div id="modal_'+this.identifier+'"></div>',this.options);a=this.assembleModal();var b=this.getContainerNode();b.appendChild(a);this.modalDiv=b.down(".main_area");this.modalDiv.update('<img src="/images/loading.gif" width="16" height="16" />');this.options.modalTitle&&b.down(".modal_title").update(this.options.modalTitle);new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,
onComplete:function(){Event.addBehavior.reload();FB&&FB.XFBML&&FB.XFBML.parse();this.options.onComplete()}.bindAsEventListener(this),onSuccess:function(c){this.response=c.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.modalDiv.update(this.response);this.modalDiv.select(".close_modal_button").each(function(d){d.observe("click",function(g){Event.stop(g);Control.Modal.close()})});this.options.padContents||this.modalDiv.removeClassName("padded_content");
this.options.onSuccess()}.bindAsEventListener(this),onFailure:function(){this.options.onFailure();alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},assembleModal:function(){return $div({"class":"posterous_modal_skeleton1"},$div({"class":"header"},$h3({"class":"modal_title"})),$div({"class":"sidebar"}),$div({"class":"main_area padded_content"}),$div({"class":"commands"},$div({"class":"right"},$div({"class":"ok_cmd button",onclick:"Control.Modal.close(); return false;"}))))}});
document.observe("dom:loaded",function(){$("feedback_anchor")&&new PModal("feedback_anchor","/main/feedback",{},{});$$(".CodeRay").each(function(a){a.observe("click",function(){a.toggleClassName("hide_numbers")})});$$(".slide-out").each(function(a){a.select(".slide-out-toggler").each(function(b){b.observe("click",function(){a.toggleClassName("slide-out-opened")})})})});var PREFILL_CLASSNAME="prefilled";
function prefillClearer(a,b){a=$(a);var c=function(){a.value=b;a.addClassName(PREFILL_CLASSNAME)};a.observe("focus",function(){if(a.value==b||a.value=="Untitled"){a.value="";a.removeClassName(PREFILL_CLASSNAME)}a.removeClassName(PREFILL_CLASSNAME)});a.observe("blur",function(){a.value.blank()&&c()});$(a.form).observe("reset",c);a.value.blank()&&c();if(a.value!=b||a.value=="Untitled")a.removeClassName(PREFILL_CLASSNAME)}if(typeof Control=="undefined")Control={};Control.Modal=Class.create();
Object.extend(Control.Modal,{loaded:false,loading:false,loadingTimeout:false,overlay:false,container:false,current:false,ie:false,effects:{containerFade:false,containerAppear:false,overlayFade:false,overlayAppear:false},targetRegexp:/#(.+)$/,imgRegexp:/\.(jpe?g|gif|png|tiff?)($|\?.+)/i,overlayStyles:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9998},overlayIEStyles:{position:"absolute",top:0,left:0,zIndex:9998},disableHoverClose:false,load:function(){if(!Control.Modal.loaded){Control.Modal.loaded=
true;Control.Modal.ie=typeof document.body.style.maxHeight=="undefined";Control.Modal.overlay=$(document.createElement("div"));Control.Modal.overlay.id="modal_overlay";Object.extend(Control.Modal.overlay.style,Control.Modal["overlay"+(Control.Modal.ie?"IE":"")+"Styles"]);Control.Modal.overlay.hide();Control.Modal.container_holder=$(document.createElement("div"));Control.Modal.container_holder.id="modal_container_holder";Control.Modal.container=$(document.createElement("div"));Control.Modal.container.id=
"modal_container";Control.Modal.container_holder.hide();Control.Modal.loading=$(document.createElement("div"));Control.Modal.loading.id="modal_loading";Control.Modal.loading.hide();var a=document.getElementsByTagName("body")[0];a.appendChild(Control.Modal.overlay);Control.Modal.container_holder.appendChild(Control.Modal.container);a.appendChild(Control.Modal.container_holder);a.appendChild(Control.Modal.loading);Control.Modal.container_holder.observe("mouseout",function(b){!Control.Modal.disableHoverClose&&
Control.Modal.current&&Control.Modal.current.options.hover&&!Position.within(Control.Modal.container_holder,Event.pointerX(b),Event.pointerY(b))&&Control.Modal.close()})}},open:function(a,b){b=b||{};if(!b.contents)b.contents=a;var c=new Control.Modal(false,b);c.open();return c},close:function(a){if(typeof a!="boolean")a=false;Control.Modal.current&&Control.Modal.current.close(a)},attachEvents:function(){Event.observe(window,"load",Control.Modal.load)},center:function(a){if(!a._absolutized){a.setStyle({position:"absolute"});
a._absolutized=true}var b=a.getDimensions();if(b.width==0||b.height==0)b=Control.Modal.recursiveGetDimensions(a);Position.prepare();var c=Position.deltaX+Math.floor((Control.Modal.getWindowWidth()-b.width)/2),d=Position.deltaY+(Control.Modal.getWindowHeight()>b.height?Math.floor((Control.Modal.getWindowHeight()-b.height)/2):0),g=a.cumulativeScrollOffset()[1];a.down(1)!=undefined&&a.down(1).hasClassName("subscription_form")?a.setStyle({margin:(g!=null&&g>0?g:"0")+"px 0px 0px 0px ",left:b.width<=Control.Modal.getWindowWidth()?
(c!=null&&c>0?c:"0")+"px":0}):a.setStyle({top:(d!=null&&d>0?d:"0")+"px",left:b.width<=Control.Modal.getWindowWidth()?(c!=null&&c>0?c:"0")+"px":0})},recursiveGetDimensions:function(a){a=a.select("*");return{width:a.clone().map(function(b){return b.getWidth()}).max(),height:a.clone().map(function(b){return b.getHeight()}).max()}},getWindowWidth:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0},getWindowHeight:function(){return self.innerHeight||document.documentElement.clientHeight||
document.body.clientHeight||0},getDocumentWidth:function(){return Math.min(document.body.scrollWidth,Control.Modal.getWindowWidth())},getDocumentHeight:function(){return Math.max(document.body.scrollHeight,Control.Modal.getWindowHeight())},onKeyDown:function(a){a.keyCode==Event.KEY_ESC&&Control.Modal.close()}});
Object.extend(Control.Modal.prototype,{mode:"",html:false,href:"",element:false,src:false,imageLoaded:false,ajaxRequest:false,initialize:function(a,b){this.element=$(a);this.options={beforeOpen:Prototype.emptyFunction,afterOpen:Prototype.emptyFunction,beforeClose:Prototype.emptyFunction,afterClose:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,onException:Prototype.emptyFunction,beforeImageLoad:Prototype.emptyFunction,afterImageLoad:Prototype.emptyFunction,
autoOpenIfLinked:true,contents:false,loading:false,fade:false,fadeDuration:0.75,image:false,target:false,imageCloseOnClick:true,hover:false,iframe:false,iframeTemplate:new Template('<iframe src="#{href}" width="100%" height="100%" frameborder="0" id="#{id}"></iframe>'),evalScripts:true,requestOptions:{},overlayDisplay:true,overlayClassName:"",overlayCloseOnClick:true,containerClassName:"",opacity:0.3,zIndex:9998,width:null,height:null,offsetLeft:0,offsetTop:0,position:"absolute",borderRadius:10,padding:0};
Object.extend(this.options,b||{});var c=false,d=false;if(this.element){c=Control.Modal.targetRegexp.exec(this.element.href);d=Control.Modal.imgRegexp.exec(this.element.href)}if(this.options.position=="mouse")this.options.hover=true;if(this.options.contents)this.mode="contents";else if(this.options.image||d){this.mode="image";this.src=this.element.href}else if(this.options.target||c){this.mode="named";c=this.options.target||c[1];d=$(c);this.html=d.innerHTML;d.remove();this.href=c}else{this.mode=this.options.iframe?
"iframe":"ajax";this.href=this.element.href}if(this.element)if(this.options.hover){this.element.observe("mouseover",this.open.bind(this));this.element.observe("mouseout",function(g){Position.within(Control.Modal.container_holder,Event.pointerX(g),Event.pointerY(g))||this.close()}.bindAsEventListener(this))}else this.element.onclick=function(g){this.open();Event.stop(g);return false}.bindAsEventListener(this);c=Control.Modal.targetRegexp.exec(window.location);this.position=function(g){if(this.options.position==
"absolute")Control.Modal.center(Control.Modal.container_holder);else{g=g&&this.options.position=="mouse"?[Event.pointerX(g),Event.pointerY(g)]:Position.cumulativeOffset(this.element);Control.Modal.container_holder.setStyle({position:"absolute",top:g[1]+(typeof this.options.offsetTop=="function"?this.options.offsetTop():this.options.offsetTop)+"px",left:g[0]+(typeof this.options.offsetLeft=="function"?this.options.offsetLeft():this.options.offsetLeft)+"px"})}Control.Modal.ie&&Control.Modal.overlay.setStyle({height:Control.Modal.getDocumentHeight()+
"px",width:Control.Modal.getDocumentWidth()+"px"})}.bind(this);this.mode=="named"&&this.options.autoOpenIfLinked&&c&&c[1]&&c[1]==this.href&&this.open()},showLoadingIndicator:function(){if(this.options.loading)Control.Modal.loadingTimeout=window.setTimeout(function(){var a=$("modal_image");a&&a.hide();Control.Modal.loading.style.zIndex=this.options.zIndex+1;Control.Modal.loading.update('<img id="modal_loading" src="'+this.options.loading+'"/>');Control.Modal.loading.show();Control.Modal.center(Control.Modal.loading)}.bind(this),
250)},hideLoadingIndicator:function(){if(this.options.loading){Control.Modal.loadingTimeout&&window.clearTimeout(Control.Modal.loadingTimeout);var a=$("modal_image");a&&a.show();Control.Modal.loading.hide()}},open:function(a){if(!(!a&&this.notify("beforeOpen")===false)){Control.Modal.loaded||Control.Modal.load();Control.Modal.close();this.options.hover||Event.observe($(document.getElementsByTagName("body")[0]),"keydown",Control.Modal.onKeyDown);Control.Modal.current=this;this.options.hover||Control.Modal.overlay.setStyle({zIndex:this.options.zIndex,
opacity:this.options.opacity});a=this.options.borderRadius+"px";Control.Modal.container.setStyle({zIndex:this.options.zIndex+2,position:"absolute",backgroundColor:"#fff",top:a,left:a,right:a,bottom:a});Control.Modal.container_holder.setStyle({zIndex:this.options.zIndex+1,padding:this.options.padding+"px",backgroundColor:Prototype.Browser.IE?"#999999":"rgba(44, 44, 44, 0.4)",width:this.options.width?(typeof this.options.width=="function"?this.options.width():this.options.width)+this.options.borderRadius*
2+this.options.padding+"px":null,height:this.options.height?(typeof this.options.height=="function"?this.options.height():this.options.height)+this.options.borderRadius*2+this.options.padding+"px":null});Control.Modal.ie&&!this.options.hover&&$A(document.getElementsByTagName("select")).each(function(b){b.style.visibility="hidden"});Control.Modal.overlay.addClassName(this.options.overlayClassName);Control.Modal.container.addClassName(this.options.containerClassName);switch(this.mode){case "image":this.imageLoaded=
false;this.notify("beforeImageLoad");this.showLoadingIndicator();a=document.createElement("img");a.onload=function(b){this.hideLoadingIndicator();this.update([b]);this.options.imageCloseOnClick&&$(b).observe("click",Control.Modal.close);this.position();this.notify("afterImageLoad");b.onload=null}.bind(this,a);a.src=this.src;a.id="modal_image";break;case "ajax":this.notify("beforeLoad");a={method:"post",onSuccess:function(b){this.hideLoadingIndicator();this.update(b.responseText);this.notify("onSuccess",
b);this.ajaxRequest=false}.bind(this),onFailure:function(){this.notify("onFailure")}.bind(this),onException:function(){this.notify("onException")}.bind(this)};Object.extend(a,this.options.requestOptions);this.showLoadingIndicator();this.ajaxRequest=new Ajax.Request(this.href,a);break;case "iframe":this.update(this.options.iframeTemplate.evaluate({href:this.href,id:"modal_iframe"}));break;case "contents":this.update(typeof this.options.contents=="function"?this.options.contents():this.options.contents);
break;case "named":this.update(this.html)}if(!this.options.hover){this.options.overlayCloseOnClick&&this.options.overlayDisplay&&Control.Modal.overlay.observe("click",Control.Modal.close);if(this.options.overlayDisplay)if(this.options.fade){Control.Modal.effects.overlayFade&&Control.Modal.effects.overlayFade.cancel();Control.Modal.effects.overlayAppear=new Effect.Appear(Control.Modal.overlay,{queue:{position:"front",scope:"Control.Modal"},to:this.options.opacity,duration:this.options.fadeDuration/
2})}else Control.Modal.overlay.show()}if(this.options.position=="mouse"){this.mouseHoverListener=this.position.bindAsEventListener(this);this.element.observe("mousemove",this.mouseHoverListener)}this.notify("afterOpen")}},update:function(a){if(typeof a=="string")Control.Modal.container.update(a);else{Control.Modal.container.update("");a.each?a.each(function(b){Control.Modal.container.appendChild(b)}):Control.Modal.container.appendChild(a)}if(this.options.fade){Control.Modal.effects.containerFade&&
Control.Modal.effects.containerFade.cancel();Control.Modal.effects.containerAppear=new Effect.Appear(Control.Modal.container_holder,{queue:{position:"end",scope:"Control.Modal"},to:1,duration:this.options.fadeDuration/2})}else Control.Modal.container_holder.show();this.position();Event.observe(window,"resize",this.position,false)},close:function(a){if(!(!a&&this.notify("beforeClose")===false)){this.ajaxRequest&&this.ajaxRequest.transport.abort();this.hideLoadingIndicator();if(this.mode=="image"){a=
$("modal_image");this.options.imageCloseOnClick&&a&&a.stopObserving("click",Control.Modal.close)}Control.Modal.ie&&!this.options.hover&&$A(document.getElementsByTagName("select")).each(function(b){b.style.visibility="visible"});this.options.hover||Event.stopObserving(window,"keyup",Control.Modal.onKeyDown);Control.Modal.current=false;Event.stopObserving(window,"resize",this.position,false);Event.stopObserving(window,"scroll",this.position,false);if(!this.options.hover){this.options.overlayCloseOnClick&&
this.options.overlayDisplay&&Control.Modal.overlay.stopObserving("click",Control.Modal.close);if(this.options.overlayDisplay)if(this.options.fade){Control.Modal.effects.overlayAppear&&Control.Modal.effects.overlayAppear.cancel();Control.Modal.effects.overlayFade=new Effect.Fade(Control.Modal.overlay,{queue:{position:"end",scope:"Control.Modal"},from:this.options.opacity,to:0,duration:this.options.fadeDuration/2})}else Control.Modal.overlay.hide()}if(this.options.fade){Control.Modal.effects.containerAppear&&
Control.Modal.effects.containerAppear.cancel();Control.Modal.effects.containerFade=new Effect.Fade(Control.Modal.container,{queue:{position:"front",scope:"Control.Modal"},from:1,to:0,duration:this.options.fadeDuration/2,afterFinish:function(){Control.Modal.container.update("");this.resetClassNameAndStyles()}.bind(this)})}else{Control.Modal.container_holder.hide();Control.Modal.container.update("");this.resetClassNameAndStyles()}this.options.position=="mouse"&&this.element.stopObserving("mousemove",
this.mouseHoverListener);this.notify("afterClose")}},resetClassNameAndStyles:function(){Control.Modal.overlay.removeClassName(this.options.overlayClassName);Control.Modal.container_holder.removeClassName(this.options.containerClassName);Control.Modal.container_holder.setStyle({height:null,width:null,top:null,left:null})},notify:function(a){try{if(this.options[a])return[this.options[a].apply(this.options[a],$A(arguments).slice(1))]}catch(b){if(b!=$break)throw b;else return false}}});
typeof Object.Event!="undefined"&&Object.Event.extend(Control.Modal);Control.Modal.attachEvents();
Object.extend(Control.Modal,{dynamicResize:function(a,b,c){b||(b="control_modal_resize");c||(c="front");new_height=a.height;new_width=a.width;win_height=this.getWindowHeight();win_width=this.getWindowWidth();new_left=Math.floor((win_width-new_width)/2);new_top=Math.floor((win_height-new_height)/2);new Effect.Morph(this.container_holder.id,{style:{height:new_height+"px",width:new_width+"px",left:new_left+"px",top:new_top+"px"},duration:0.2,scope:b,queue:c})},hideInternalElement:function(a,b){modal_height=
$("modal_container_holder").getHeight();elem_height=this.getElemHeight(a);b?b(a,{queue:"front",scope:"control_modal_resize",duration:0.4}):a.hide();this.waitForResize(function(){this.dynamicResize({height:modal_height-elem_height},"control_modal_resize","end")}.bind(this))},showInternalElement:function(a,b){modal_height=$("modal_container_holder").getHeight();elem_height=this.getElemHeight(a);a.setStyle({display:"none"});this.dynamicResize({height:modal_height+elem_height},"control_modal_resize",
"front");this.waitForResize(function(){b?b(a,{queue:"end",scope:"control_modal_resize",duration:0.2}):a.show()}.bind(this))},getElemHeight:function(a){elem_height=a.getHeight();elem_margins=parseInt(a.getStyle("margin-top"),"decimal")+parseInt(a.getStyle("margin-bottom"),"decimal");return elem_height+elem_margins},waitForResize:function(a){new PeriodicalExecuter(function(b){if(Effect.Queues.get("control_modal_resize").effects.length==0){b.stop();a()}},0.2)},swapElems:function(a,b){elem_hide=typeof a==
"string"?$(a):a;elem_show=typeof b=="string"?$(b):b;height_add=this.getElemHeight(elem_show);height_sub=this.getElemHeight(elem_hide);delta=height_add-height_sub;modal_height=$("modal_container_holder").getHeight();if(delta>0){this.dynamicResize({height:modal_height+delta});this.waitForResize(function(){Effect.SlideUp(elem_hide,{queue:"front",scope:"control_modal_resize",duration:0.4});Effect.SlideDown(elem_show,{queue:"end",scope:"control_modal_resize",duration:0.4})})}else{Effect.Fade(elem_hide,
{queue:"front",scope:"control_modal_resize"});Effect.Appear(elem_show,{queue:"front",scope:"control_modal_resize"});this.waitForResize(function(){this.dynamicResize({height:modal_height+delta})}.bind(this))}},visible:function(){return this.container_holder?this.container_holder.visible():false}});if(Object.isUndefined(Proto))var Proto={};
Proto.Menu=Class.create({initialize:function(a){var b=Prototype.emptyFunction;this.ie=Prototype.Browser.IE;this.options=Object.extend({selector:".contextmenu",className:"protoMenu",pageOffset:25,fade:false,zIndex:100,beforeShow:b,beforeHide:b,beforeSelect:b,position:"mouse_click",location:null,click:"right",width:null,menuAlign:"left"},a||{});this.shim=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:false;",frameborder:0});
this.options.fade=this.options.fade&&!Object.isUndefined(Effect);this.container=new Element("div",{className:this.options.className,style:"display:none"});this.options.width!=null&&this.container.setStyle({width:this.options.width+"px"});var c=new Element("ul");this.options.menuItems.each(function(d){var g="";if(!d.separator){g=Object.extend(new Element("a",{href:!d.href||d.method=="post"||d.method=="put"||d.method=="delete"?"#":d.href,title:d.name,className:(d.className||"")+(d.disabled?" disabled":
" enabled")}),{_method:d.method,_params:d.params,_confirm:d.confirm,_href:d.href,_callback:d.callback});g.observe("click",this.onClick.bind(this));g.observe("contextmenu",Event.stop);g.update(d.name);d.icon&&g.setStyle({backgroundImage:"url("+d.icon+")",backgroundPosition:"8px 50%",backgroundRepeat:"no-repeat"})}c.insert((new Element("li",{className:d.separator?"separator":""})).insert(g))}.bind(this));$(document.body).insert(this.container.insert(c).observe("contextmenu",Event.stop));this.ie&&$(document.body).insert(this.shim);
if(this.options.click=="right"){document.observe("click",function(d){if(this.container.visible()&&!d.isRightClick()){this.options.beforeHide(d);this.ie&&this.shim.hide();this.container.hide()}}.bind(this));$$(this.options.selector).invoke("observe",Prototype.Browser.Opera?"click":"contextmenu",function(d){Prototype.Browser.Opera&&!d.ctrlKey||this.show(d)}.bind(this))}else{document.observe("click",function(d){if(this.container.visible()){this.options.beforeHide(d);this.ie&&this.shim.hide();this.container.hide()}}.bind(this));
$$(this.options.selector).invoke("observe","click",function(d){this.container.visible()?this.container.hide():this.show(d);d.stop()}.bind(this))}},is_form_post:function(){},show:function(a){a.stop();this.options.beforeShow(a);var b=Event.pointer(a).x,c=Event.pointer(a).y,d=this.container.getDimensions();if(this.options.position=="relative"){c=this.options.location.cumulativeOffset();b=this.options.menuAlign=="left"?c[0]:c[0]+this.options.location.getWidth()-d.width;c=c[1]+this.options.location.getHeight()-
2}var g=document.viewport.getDimensions(),e=document.viewport.getScrollOffsets();b={left:(b+d.width+this.options.pageOffset>g.width?g.width-d.width-this.options.pageOffset:b)+"px",top:(c-e.top+d.height>g.height&&c-e.top>d.height?c-d.height:c)+"px"};this.container.setStyle(b).setStyle({zIndex:this.options.zIndex});this.ie&&this.shim.setStyle(Object.extend(Object.extend(d,b),{zIndex:this.options.zIndex-1})).show();this.options.fade?Effect.Appear(this.container,{duration:0.25}):this.container.show();
this.event=a},onClick:function(a){var b=false;if(a.target._href&&(!a.target._method||a.target._method=="get"))return true;else if(a.target._method=="delete")if(confirm("Are you sure?")){var c=document.createElement("form");c.style.display="none";a.target.appendChild(c);c.method="POST";c.action=a.target._href;var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","_method");d.setAttribute("value","delete");c.appendChild(d);d=document.createElement("input");d.setAttribute("type",
"hidden");d.setAttribute("name","authenticity_token");d.setAttribute("value",window._token);c.appendChild(d);$H(a.target._params).each(function(g){d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name",g.key);d.setAttribute("value",g.value);c.appendChild(d)});c.submit();a.stop();return false}else b=true;a.stop();if((b||a.target._callback)&&!a.target.hasClassName("disabled")){this.options.beforeSelect(a);this.ie&&this.shim.hide();this.container.hide();a.target._callback(this.event)}return true}});
String.prototype.parseColor=function(a){var b="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(","),d=0;do b+=parseInt(c[d]).toColorPart();while(++d<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(d=1;d<4;d++)b+=(this.charAt(d)+this.charAt(d)).toLowerCase();if(this.length==7)b=this.toLowerCase()}return b.length==7?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return b.nodeType==3?b.nodeValue:b.hasChildNodes()?Element.collectTextNodes(b):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return c.nodeType==3?c.nodeValue:c.hasChildNodes()&&!Element.hasClassName(c,b)?Element.collectTextNodesIgnoreClass(c,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE)b+=";zoom:1";a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(a,b,c){a=
(typeof a=="object"||Object.isFunction(a))&&a.length?a:$(a).childNodes;var d=Object.extend({speed:0.1,delay:0},c||{}),g=d.delay;$A(a).each(function(e,j){new b(e,Object.extend(d,{delay:j*d.speed+g}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();c=Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{});Effect[a.visible()?Effect.PAIRS[b][1]:Effect.PAIRS[b][0]](a,c)}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(c){return c.state=="idle"}).each(function(c){c.startOn+=a.finishOn;c.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b}a.startOn+=b;a.finishOn+=b;if(!a.options.queue.limit||this.effects.length<a.options.queue.limit)this.effects.push(a);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a))return a;return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false)a.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=function(){function b(c,
d){c.options[d+"Internal"]&&c.options[d+"Internal"](c);c.options[d]&&c.options[d](c)}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");this.setup&&this.setup();b(this,"afterSetup")}if(this.state==="running"){this.position=c=this.options.transition(c)*this.fromToDelta+this.options.from;b(this,"beforeUpdate");this.update&&this.update(c);b(this,"afterUpdate")}}}();this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":
this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn)if(a>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");this.finish&&this.finish();this.event("afterFinish")}else{a=(a-this.startOn)/this.totalTime;var b=(a*this.totalFrames).round();if(b>this.currentFrame){this.render(a);this.currentFrame=b}}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},
event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this);this.options[a]&&this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){a=Object.isString(a)?$(a):a;var d=$A(arguments),g=d.last();d=d.length==5?d[3]:null;this.method=Object.isFunction(g)?g.bind(a):Object.isFunction(a[g])?a[g].bind(a):function(e){a[g]=e};this.start(Object.extend({from:b,to:c},d||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});this.start(Object.extend({from:this.element.getOpacity()||0,to:1},b||{}))},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({x:0,y:0,mode:"relative"},b||{}))},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,d){return new Effect.Move(a,Object.extend({x:c,y:b},d||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{}))},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=
this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=
[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
if(this.options.scaleX)c.width=b.round()+"px";if(this.options.scaleY)c.height=a.round()+"px";if(this.options.scaleFromCenter){var d=(a-this.dims[0])/2,g=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)c.top=this.originalTop-d+"px";if(this.options.scaleX)c.left=this.originalLeft-g+"px"}else{if(this.options.scaleY)c.top=-d+"px";if(this.options.scaleX)c.left=-g+"px"}}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({startcolor:"#ffff99"},b||{}))},setup:function(){if(this.element.getStyle("display")=="none")this.cancel();else{this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))}},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+
(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){var c=b||{},d=document.viewport.getScrollOffsets(),g=$(a).cumulativeOffset();if(c.offset)g[1]+=c.offset;return new Effect.Tween(null,d.top,g[1],c,function(e){scrollTo(d.left,e.round())})};
Effect.Fade=function(a,b){a=$(a);var c=a.getInlineOpacity(),d=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(g){g.options.to==0&&g.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,d)};
Effect.Appear=function(a,b){a=$(a);var c=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(d){d.element.forceRerendering()},beforeSetup:function(d){d.element.setOpacity(d.options.from).show()}},b||{});return new Effect.Opacity(a,c)};
Effect.Puff=function(a,b){a=$(a);var c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(d){Position.absolutize(d.effects[0].element)},afterFinishInternal:function(d){d.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(c){c.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){a=$(a);var c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(d){d.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){a=$(a);var c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(d){new Effect.Scale(d.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(g){g.element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){a=$(a);var c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(d){d.effects[0].element.makePositioned()},afterFinishInternal:function(d){d.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){a=$(a);var c=Object.extend({distance:20,duration:0.5},b||{}),d=parseFloat(c.distance),g=parseFloat(c.duration)/10,e={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:d,y:0,duration:g,afterFinishInternal:function(j){new Effect.Move(j.element,{x:-d*2,y:0,duration:g*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:d*2,y:0,duration:g*2,afterFinishInternal:function(m){new Effect.Move(m.element,{x:-d*2,y:0,duration:g*2,afterFinishInternal:function(q){new Effect.Move(q.element,
{x:d*2,y:0,duration:g*2,afterFinishInternal:function(w){new Effect.Move(w.element,{x:-d,y:0,duration:g,afterFinishInternal:function(u){u.element.undoPositioned().setStyle(e)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:true,afterSetup:function(g){g.element.makePositioned();g.element.down().makePositioned();window.opera&&g.element.setStyle({top:""});g.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(g){g.element.down().setStyle({bottom:g.dims[0]-
g.element.clientHeight+"px"})},afterFinishInternal:function(g){g.element.undoClipping().undoPositioned();g.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:true,afterSetup:function(g){g.element.makePositioned();g.element.down().makePositioned();window.opera&&g.element.setStyle({top:""});g.element.makeClipping().show()},afterUpdateInternal:function(g){g.element.down().setStyle({bottom:g.dims[0]-
g.element.clientHeight+"px"})},afterFinishInternal:function(g){g.element.hide().undoClipping().undoPositioned();g.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){a=$(a);var c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},g=a.getDimensions(),e,j,k,m;switch(c.direction){case "top-left":e=j=k=m=0;break;case "top-right":e=g.width;j=m=0;k=-g.width;break;case "bottom-left":e=k=0;j=g.height;m=-g.height;break;
case "bottom-right":e=g.width;j=g.height;k=-g.width;m=-g.height;break;case "center":e=g.width/2;j=g.height/2;k=-g.width/2;m=-g.height/2}return new Effect.Move(a,{x:e,y:j,duration:0.01,beforeSetup:function(q){q.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(q){new Effect.Parallel([new Effect.Opacity(q.element,{sync:true,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(q.element,{x:k,y:m,sync:true,transition:c.moveTransition}),new Effect.Scale(q.element,100,
{scaleMode:{originalHeight:g.height,originalWidth:g.width},sync:true,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(w){w.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(w){w.effects[0].element.undoClipping().undoPositioned().setStyle(d)}},c))}})};
Effect.Shrink=function(a,b){a=$(a);var c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},g=a.getDimensions(),e,j;switch(c.direction){case "top-left":e=j=0;break;case "top-right":e=g.width;j=0;break;case "bottom-left":e=0;j=g.height;break;case "bottom-right":e=g.width;j=
g.height;break;case "center":e=g.width/2;j=g.height/2}return new Effect.Parallel([new Effect.Opacity(a,{sync:true,to:0,from:1,transition:c.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:true,transition:c.scaleTransition,restoreAfterFinish:true}),new Effect.Move(a,{x:e,y:j,sync:true,transition:c.moveTransition})],Object.extend({beforeStartInternal:function(k){k.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(k){k.effects[0].element.hide().undoClipping().undoPositioned().setStyle(d)}},
c))};Effect.Pulsate=function(a,b){a=$(a);var c=b||{},d=a.getInlineOpacity(),g=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(e){e.element.setStyle({opacity:d})}},c),{transition:function(e){return 1-g(-Math.cos(e*(c.pulses||5)*2*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){a=$(a);var c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({style:{}},b||{});if(Object.isString(c.style))if(c.style.include(":"))this.style=c.style.parseStyle();else{this.element.addClassName(c.style);this.style=$H(this.element.getStyles());this.element.removeClassName(c.style);var d=this.element.getStyles();this.style=this.style.reject(function(g){return g.value==d[g.key]});c.afterFinishInternal=function(g){g.element.addClassName(g.options.style);
g.transforms.each(function(e){g.element.style[e.style]=""})}}else this.style=$H(c.style);this.start(c)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b))b="#ffffff";b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(b){var c=b[0];b=b[1];var d=null;if(b.parseColor("#zzzzzz")!="#zzzzzz"){b=b.parseColor();d="color"}else if(c=="opacity"){b=parseFloat(b);Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})}else if(Element.CSS_LENGTH.test(b)){d=b.match(/^([\+\-]?[0-9\.]+)(.*)$/);b=parseFloat(d[1]);d=d.length==3?d[2]:null}var g=this.element.getStyle(c);return{style:c.camelize(),originalValue:d=="color"?a(g):parseFloat(g||0),targetValue:d=="color"?a(b):b,unit:d}}.bind(this)).reject(function(b){return b.originalValue==b.targetValue||b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))})},update:function(a){for(var b={},c,d=this.transforms.length;d--;)b[(c=this.transforms[d]).style]=
c.unit=="color"?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(c.unit===null?"":c.unit);this.element.setStyle(b,true)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options");return[$(b)||$$(b)].flatten().map(function(g){return new c(g,Object.extend({sync:true},
d))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();if(Prototype.Browser.WebKit)a=(new Element("div",{style:this})).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';a=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=b[d];return c})}:function(a){a=$(a);var b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,g){d[g]=b[g];return d});if(!c.opacity)c.opacity=a.getOpacity();return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);
if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){this.element=a=$(a);this.update=$(b);this.active=this.changed=this.hasFocus=false;this.entryCount=this.index=0;this.oldElementValue=this.element.value;if(this.setOptions)this.setOptions(c);else this.options=c||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=
this.options.onShow||function(d,g){if(!g.style.position||g.style.position=="absolute"){g.style.position="absolute";Position.clone(d,g,{setHeight:false,offsetTop:d.offsetHeight})}Effect.Appear(g,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,g){new Effect.Fade(g,{duration:0.15})};if(typeof this.options.tokens=="string")this.options.tokens=Array(this.options.tokens);this.options.tokens.include("\n")||this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete",
"off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){Element.getStyle(this.update,"display")=="none"&&this.options.onShow(this.element,this.update);if(!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")=="absolute"){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
this.iefix=$(this.update.id+"_iefix")}this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();Element.getStyle(this.update,"display")!="none"&&this.options.onHide(this.element,this.update);this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},
stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}else if(a.keyCode==Event.KEY_TAB||
a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0)return;this.hasFocus=this.changed=true;this.observer&&clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1E3)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");if(this.index!=b.autocompleteIndex){this.index=b.autocompleteIndex;this.render()}Event.stop(a)},onClick:function(a){this.index=
Event.findElement(a,"LI").autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(){setTimeout(this.hide.bind(this),250);this.active=this.hasFocus=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0)this.index--;else this.index=
this.entryCount-1;this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=0;this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement)this.options.updateElement(a);else{var b=
"";if(this.options.select){var c=$(a).select("."+this.options.select)||[];if(c.length>0)b=Element.collectTextNodes(c[0],this.options.select)}else b=Element.collectTextNodesIgnoreClass(a,"informal");c=this.getTokenBounds();if(c[0]!=-1){var d=this.element.value.substr(0,c[0]),g=this.element.value.substr(c[0]).match(/^\s+/);if(g)d+=g[0];this.element.value=d+b+this.element.value.substr(c[1])}else this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();this.options.afterUpdateElement&&
this.options.afterUpdateElement(this.element,a)}},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.index=0;if(this.entryCount==1&&
this.options.autoSelect){this.selectEntry();this.hide()}else this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars)this.getUpdatedChoices();else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();
return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];for(var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,d=-1,g=a.length,e,j=0,k=this.options.tokens.length;j<k;++j){e=a.lastIndexOf(this.options.tokens[j],b+c-1);if(e>d)d=e;e=a.indexOf(this.options.tokens[j],b+c);if(-1!=e&&e<g)g=e}return this.tokenBounds=[d+
1,g]}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;++d)if(a[d]!=b[d])return d;return c};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams)this.options.parameters+=
"&"+this.options.defaultParams;new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){for(var c=[],d=[],g=b.getToken(),e=0;e<b.options.array.length&&c.length<b.options.choices;e++)for(var j=b.options.array[e],k=b.options.ignoreCase?
j.toLowerCase().indexOf(g.toLowerCase()):j.indexOf(g);k!=-1;){if(k==0&&j.length!=g.length){c.push("<li><strong>"+j.substr(0,g.length)+"</strong>"+j.substr(g.length)+"</li>");break}else if(g.length>=b.options.partialChars&&b.options.partialSearch&&k!=-1)if(b.options.fullSearch||/\s/.test(j.substr(k-1,1))){d.push("<li>"+j.substr(0,k)+"<strong>"+j.substr(k,g.length)+"</strong>"+j.substr(k+g.length)+"</li>");break}k=b.options.ignoreCase?j.toLowerCase().indexOf(g.toLowerCase(),k+1):j.indexOf(g,k+1)}if(d.length)c=
c.concat(d.slice(0,b.options.choices-c.length));return"<ul>"+c.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b;this.element=a=$(a);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(c);Object.extend(this.options,c||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId))this.options.formId=""}if(this.options.externalControl)this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)this.options.externalControlOnly=
false;this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!(!this._editing||
a.ctrlKey||a.altKey||a.shiftKey))if(Event.KEY_ESC==a.keyCode)this.handleFormCancellation(a);else Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a)},createControl:function(a,b,c){var d=this.options[a+"Control"];b=this.options[a+"Text"];if("button"==d){c=document.createElement("input");c.type="submit";c.value=b;c.className="editor_"+a+"_button";if("cancel"==a)c.onclick=this._boundCancelHandler;this._form.appendChild(c);this._controls[a]=c}else if("link"==d){d=document.createElement("a");d.href=
"#";d.appendChild(document.createTextNode(b));d.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+a+"_link";if(c)d.className+=" "+c;this._form.appendChild(d);this._controls[a]=d}},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var c=this.options.size||this.options.cols||0;if(0<c)b.size=c}else{b=document.createElement("textarea");
b.rows=1>=this.options.rows?this.options.autoRows:this.options.rows;b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=a;b.className="editor_field";if(this.options.submitOnBlur)b.onblur=this._boundSubmitHandler;this._controls.editor=b;this.options.loadTextURL&&this.loadExternalText();this._form.appendChild(this._controls.editor)},createForm:function(){function a(c,d){var g=b.options["text"+c+"Controls"];!g||d===false||b._form.appendChild(document.createTextNode(g))}var b=this;this._form=
$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br"));this.options.onFormCustomization&&this.options.onFormCustomization(this,this._form);a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",
this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(!(this._saving||this._editing)){this._editing=true;this.triggerCallback("onEnterEditMode");this.options.externalControl&&this.options.externalControl.hide();
this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);this.options.loadTextURL||this.postProcessEditField();a&&Event.stop(a)}},enterHover:function(){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=
this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();b=this.options.callback(b,c)||"";if(Object.isString(b))b=b.toQueryParams();b.editorId=this.element.id;if(this.options.htmlResponse){c=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});
new Ajax.Updater({success:this.element},this.url,c)}else{c=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,c)}a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();this.options.externalControl&&this.options.externalControl.show();
this._editing=this._saving=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),
onComplete:Prototype.emptyFunction,onSuccess:function(b){this._form.removeClassName(this.options.loadingClassName);b=b.responseText;if(this.options.stripLoadedTextTags)b=b.stripTags();this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a)$(this._controls.editor)["focus"==a?"focus":"activate"]()},
prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=
a;this.options.externalControlOnly||this.element.observe(b.key,a);this.options.externalControl&&this.options.externalControl.observe(b.key,a)}.bind(this))},removeForm:function(){if(this._form){this._form.remove();this._form=null;this._controls={}}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(a,
b){"function"==typeof this.options[a]&&this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||this.element.stopObserving(a.key,a.value);this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,b,c,d){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(b,c,d)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText();this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);
this.showLoadingText(this.options.loadingCollectionText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){b=b.responseText.strip();if(!/^\[.*\]$/.test(b))throw"Server returned an invalid collection representation.";this._collection=eval(b);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,a)},
showLoadingText:function(a){this._controls.editor.disabled=true;var b=this._controls.editor.firstChild;if(!b){b=document.createElement("option");b.value="";this._controls.editor.appendChild(b);b.selected=true}b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);
Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var a="value"in this.options?this.options.value:this._text,
b=this._collection.any(function(d){return d[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(d,g){c=document.createElement("option");c.value=d[0];c.selected=b?d[0]==a:0==g;c.appendChild(document.createTextNode(d[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(c,d){c in a||d===undefined||(a[c]=d)}if(a){b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined);b("okControl",a.okLink?"link":a.okButton?"button":a.okLink==a.okButton==false?false:undefined);b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)}};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;a._effect&&a._effect.cancel()},onFailure:function(a){alert("Error communication with the server: "+
a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||0.5;this.element=$(a);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(){if(this.lastValue!=$F(this.element)){this.timer&&clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1E3);this.lastValue=$F(this.element)}},onTimerEvent:function(){this.timer=null;this.callback(this.element,
$F(this.element))}});
(function(){Object.extend(Event,{mouseEnter:function(a,b,c){a=$(a);var d=c&&c.enterDelay?function(){window.setTimeout(b,c.enterDelay)}:b;if(Prototype.Browser.IE)a.observe("mouseenter",d);else{a.hovered=false;a.observe("mouseover",function(g){if(!a.hovered){a.hovered=true;d(g)}})}},mouseLeave:function(a,b,c){a=$(a);var d=c&&c.leaveDelay?function(){window.setTimeout(b,c.leaveDelay)}:b;Prototype.Browser.IE?a.observe("mouseleave",d):a.observe("mouseout",function(g){Event.element(g);for(var e=g.relatedTarget;e&&
e!=a;)try{e=e.parentNode}catch(j){e=a}if(e!=a){d(g);a.hovered=false}})}});Element.addMethods({hover:function(a,b,c,d){d=Object.extend({},d)||{};Event.mouseEnter(a,b,d);Event.mouseLeave(a,c,d)}})})();
var PHover=Class.create({initialize:function(a,b,c){this.options=Object.extend({top_active_area_px:35,y_offset:0},c||{});this.hover_div=$(a);this.position_div=$(b);this.child_divs=[];this.child_div_position=new Hash;this.setup();this.t_off=this.t_dim=null},setup:function(){this.hover_div.hover(this.hoverHandler.bindAsEventListener(this),function(){})},mouseHandler:function(a){if(this.t_dim&&this.t_off){var b=Event.pointerX(a);a=Event.pointerY(a);b>this.t_off.left&&b<this.t_off.left+this.t_dim.width&&
a>this.t_off.top-this.options.top_active_area_px&&a<this.t_off.top+this.t_dim.height||this.unhoverHandler()}},show:function(){this.hoverHandler()},hoverHandler:function(){document.observe("mousemove",this.mouseHandler.bindAsEventListener(this));this.t_dim=this.hover_div.getDimensions();this.t_off=this.hover_div.cumulativeOffset();var a=this.position_div.getDimensions(),b=this.position_div.cumulativeOffset();this.child_divs.each(function(c){this.position_child_div(a,b,c);c.show()}.bind(this))},position_child_div:function(a,
b,c){var d={position:"absolute",top:b.top-c.getHeight()+this.options.y_offset+"px"};d.left=this.child_div_position.get(c.getAttribute("id"))=="topright"?b.left+a.width-c.getWidth()+"px":b.left+"px";c.setStyle(d)},reposition:function(a){var b=this.position_div.getDimensions(),c=this.position_div.cumulativeOffset();this.position_child_div(b,c,$(a))},unhoverHandler:function(){document.stopObserving("mousemove",this.mouseHandler.bindAsEventListener(this));this.t_off=this.t_dim=null;this.child_divs.each(function(a){a.hasClassName("phover_donothide")||
a.hide()})},addChildDiv:function(a,b){this.child_divs.push($(a));this.child_div_position.set($(a).id,b);$(a).hide()}});PHover.created_hovers=new Hash;PHover.factory_create=function(a,b,c){if($(a)){var d=PHover.created_hovers.get($(a).getAttribute("id"));if(d)return d;else{b=new PHover(a,b,c);PHover.created_hovers.set($(a).getAttribute("id"),b);return b}}};
if(typeof PSlideGallery2=="undefined"){Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7;Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;var pgallery_stopclick=function(a){Event.stop(a)},themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):
500,loadingDiv=new Element("div",{style:"width: "+themeWidth+"px; padding-top: 158px; padding-bottom: 159px;text-align: center; border: 1px solid #aaa;"}),loadingImage=new Image;loadingImage.src="/images/loading.gif";loadingImage.width=16;loadingImage.height=16;Element.extend(loadingImage).setAttribute("id","mainImage");Element.extend(loadingImage).setAttribute("style","border: none;");loadingDiv.appendChild(loadingImage);var PImage2=Class.create({initialize:function(a){Object.extend(this,a);if(!this.thumb){this.thumb=
"/images/spacer.gif";this.thumbHeight=this.thumbWidth=36}this.imageObj=Element.extend(new Image);this.imageObj.observe("load",this.imageLoaded.bindAsEventListener(this));this.imageObj.src=this.main;if(this.width)this.imageObj.width=this.width;if(this.height)this.imageObj.height=this.height;this.loaded=false;Element.extend(this.imageObj).setAttribute("id","mainImage")},imageLoaded:function(){this.loaded=true;if(this.loadCallback!=null){this.loadCallback(this.imageObj,this.loadCallback_meref);this.loadCallback=
null}},getMainImage:function(a,b){if(this.loaded==true)a(this.imageObj,b);else{a(loadingDiv,b);this.loadCallback=a;this.loadCallback_meref=b}}}),PSlideGallery2=Class.create({initialize:function(a,b,c){this.galleryDiv=$(a);this.zipFile=c.zipFile;this.zipFileSize=c.zipFileSize;this.showDownload=c.showDownload;this.externalUrl=c.external_url;if($$(".posterous_site_data").length>0){this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type");this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type");
this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id");this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id");this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")}else{this.show_type=document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||window.show_type;this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type;this.site_id=document.body.readAttribute("data-site-id")||
document.body.readAttribute("data-site_id")||window.site_id;this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id;this.post_id=document.body.readAttribute("data-post-id")||window.post_id}if(this.site_type=="group")if(thread_div=this.galleryDiv.up(".thread")){thread_slug=thread_div.readAttribute("data-slug");thread_id=thread_div.readAttribute("data-site-id");this.url_slug=thread_slug;this.thread_id=$$("article.post")[0].readAttribute("data-id");
var d=[];$$("article.reply").each(function(g){g.readAttribute("data-parent_id")&&d.push(g.readAttribute("data-id"))});this.reply_ids=d}else{this.url_slug="";this.thread_id=0;this.reply_ids=[]}else{post_div=this.galleryDiv.up(".post");post_title_div=post_div!=undefined?post_div.down(".post-title"):undefined;post_link_div=post_title_div!=undefined?post_title_div.down("a"):undefined;if(post_link_div!=undefined){post_link=post_link_div.href;regex=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)\/(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
if(post_link.match(regex)&&post_link.match(/private/))this.url_slug=post_link.replace(regex,"private/$4");else if(post_link.match(regex))this.url_slug=post_link.replace(regex,"$4")}}this.imageList=[];$A(b).each(function(g){this.imageList.push(new PImage2(g))}.bind(this));this.idx=0;if(!(this.imageList.length==1&&this.imageList[0].largeWidth<=themeWidth&&!this.externalUrl)){this.galleryDiv.update("");this.generateGallery();document.observe("keyup",this.handleKeyboard.bindAsEventListener(this))}},generateGallery:function(){if(this.imageList.length>
1){var a=new Element("div",{style:"margin-bottom: 3px;","class":"posterousGalleryNavigationDiv"}),b=new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"});b.update("<img src='/images/arrowleft.gif' border='0'>");a.appendChild(b);var c=document.createTextNode(" ");a.appendChild(c);c=new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"});c.update("<img src='/images/arrowright.gif' border='0'>");a.appendChild(c);this.labelSpan=new Element("span");
this.labelSpan.addClassName("galleryLabel");this.labelSpan.update("1 of "+this.imageList.length);a.appendChild(this.labelSpan);this.registerPrev(b);this.registerNext(c);this.galleryDiv.appendChild(a);a=new Element("div",{style:"margin-bottom: 2px","class":"posterousGalleryThumbnailsDiv"});this.galleryDiv.appendChild(a);for(b=0;b<this.imageList.length;b++){c=this.imageList[b];if(c!=null){var d=new Element("a",{href:"#",onClick:"return false;",style:"margin-right: 5px !important;"}),g=new Element("img",
{src:c.thumb,width:c.thumbWidth,height:c.thumbWidth});d.appendChild(g);a.appendChild(d);c.thumbLink=d;this.registerThumb(b,d);b==0&&d.addClassName("gallerySelectedImage")}}}this.mainLink=new Element("a",{href:"#",onClick:"return false;"});this.mainLink.addClassName("posterousGalleryMainlink");this.mainImage=this.imageList[this.idx].imageObj;this.mainLink.appendChild(this.mainImage);this.galleryDiv.appendChild(this.mainLink);this.setupCommandPanel();this.registerMainImage(this.mainImage);this.resizeShowBar()},
setupCommandPanel:function(){if(this.commandSpan==null){this.commandSpan=new Element("span");this.commandSpan.addClassName("show");var a=new Element("div",{style:"color: #fff; font-size: 14px;",id:this.galleryDiv.id+"-click"});a.update(this.externalUrl?"Click to view link":"Click to view large");a.update(this.externalUrl?"Click to view link":"<a href='#' style='color:#fff' onclick='return false'>Click to view large</a>");if(this.imageList[this.idx].originalSize){var b=new Element("div",{style:"font-size: 14px;",
id:this.galleryDiv.id+"-dl1"});b.addClassName("posterousGalleryLink");b.update("Download full size ("+this.imageList[this.idx].originalSize+" KB)")}a=new Element("div",{style:"font-size: 14px;",id:this.galleryDiv.id+"-dl2"});a.addClassName("posterousGalleryLink");a.update("Download this gallery (ZIP, "+this.zipFileSize+" KB)");var c=new Element("div",{style:"font-size:14px;position:absolute;right:10px;bottom:0px;",id:this.galleryDiv.id+"-dl3"});if(this.url_slug!=undefined)Prototype.Browser.IE8||Prototype.Browser.IE7||
Prototype.Browser.IE6?c.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' title='Click to view in full screen' />"):c.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />");else Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?c.update("<a href='#' onclick='return false' class='view_slideshow' title='Click to view in full screen' />"):c.update("<a href='#' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />");
this.commandDiv2=b;this.commandDiv3=a;this.commandDiv4=c;this.commandSpan.appendChild(c);if(this.showDownload){if(a){this.commandSpan.appendChild(a);a.observe("click",this.clickDownloadGallery.bindAsEventListener(this))}if(b){this.commandSpan.appendChild(b);b.observe("click",this.clickDownloadFull.bindAsEventListener(this))}}c.observe("click",this.handlePostSlideshow.bindAsEventListener(this));this.mainLink.appendChild(this.commandSpan)}var d=this.imageList[this.idx].largeWidth<=themeWidth&&this.imageList[this.idx].largeHeight<=
themeWidth&&!this.externalUrl,g=this.zipFile!=null;if(d)b&&this.commandDiv2.hide();else{b&&this.commandDiv2.show();c&&this.commandDiv4.show()}if(g){a&&this.commandDiv3.show();c&&this.commandDiv4.show()}else a&&this.commandDiv3.hide();this.showDownload||d||this.commandSpan.addClassName("show")},resizeShowBar:function(){$$("span.show").each(function(a){var b=a.down(".view_slideshow").up(),c=b.next(),d=b.next(1);if(b){if(c&&c.getStyle("display")=="none"&&d&&d.getStyle("display")=="none"||a.childElements().length<=
1)Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.writeAttribute({style:"background-color:transparent"}):a.setStyle({"background-color":"transparent"});if(c&&c.getStyle("display")!="none"&&d&&d.getStyle("display")!="none"&&a.childElements().length>1)Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?b.writeAttribute({bottom:"8px"}):b.setStyle({bottom:"8px"})}})},clickDownloadFull:function(){window.open(this.imageList[this.idx].original)},clickDownloadGallery:function(){window.open(this.zipFile)},
registerThumb:function(a,b){b.observe("mousedown",this.handleThumbClick.bindAsEventListener(this,a));Event.observe(b,"click",pgallery_stopclick,false)},handleThumbClick:function(){this.setIndex($A(arguments)[1])},getCurrentPImage:function(){return this.imageList[this.idx]},registerMainImage:function(){this.mainImage.observe("mousedown",this.handleClick.bindAsEventListener(this))},unregisterMainImage:function(){this.mainImage.stopObserving("mousedown",this.handleClick.bindAsEventListener(this))},handleClick:function(a){Event.stop(a);
if(this.externalUrl)document.location.href=this.externalUrl;else this.setupLargeImage()},handlePostSlideshow:function(){if($$(".posterous_site_data").length>0){this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type");this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type");this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id");this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id");this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")}else{this.show_type=
document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||window.show_type;this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type;this.site_id=document.body.readAttribute("data-site-id")||document.body.readAttribute("data-site_id")||window.site_id;this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id;this.post_id=document.body.readAttribute("data-post-id")||
window.post_id}var a=this.getCurrentPImage(),b=[];if(this.site_type!="group"){var c=this.galleryDiv.up(".inner")||this.galleryDiv.up(".copy")||this.galleryDiv.up(".post")||this.galleryDiv.up(".content")||this.galleryDiv.up(".post_body")||this.galleryDiv.up(".bodytext")||this.galleryDiv.up(".regular");this.galleryDiv.readAttribute("data-posterous-file-list");b.push(a);c.childElements().each(function(d){if(d.hasClassName("posterousGalleryMainDiv")){d=d.readAttribute("data-posterous-file-list");d=unescape(d).evalJSON();
for(var g=0,e=d.length;g<e;++g){var j=d[g];j.large!=a.large&&b.push(j)}}})}if(this.externalUrl)document.location.href=this.externalUrl;else if(this.site_type!="group"&&this.site_type!="application"&&(this.show_type=="site"||this.show_type=="post")){slides=b.flatten().length<=1?new startSlideshow({show_type:"post",site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,user_id:this.user_id,image_list:b.flatten(),current_image:a,slug:this.url_slug,autoplay:false}):new startSlideshow({show_type:"post",
site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,user_id:this.user_id,image_list:b.flatten(),current_image:a,slug:this.url_slug,autoplay:true});if(this.post_id)slideshow.setLocation("#!/slideshow");else this.url_slug&&this.post_id==undefined&&slideshow.setLocation("#!/"+this.url_slug+"/slideshow")}else if(this.site_type=="application"){post_div=this.galleryDiv.up(".articlePost");post_id=post_div.readAttribute("data-id");site_id=post_div.readAttribute("data-site");user_id=post_div.readAttribute("data-user");
slug=post_div.readAttribute("data-slug");slides=b.flatten().length<=1?new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:b.flatten(),current_image:a,slug:slug,autoplay:false}):new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:b.flatten(),current_image:a,slug:slug,autoplay:true})}else{slides=this.imageList.length<=1?new startSlideshow({show_type:"thread",site_type:this.site_type,
thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:a,autoplay:false}):new startSlideshow({show_type:"thread",site_type:this.site_type,thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:a,autoplay:true});if(this.url_slug&&this.thread_id)slideshow.setLocation("#!/"+this.url_slug+"/slideshow");else this.url_slug&&
this.thread_id==undefined&&slideshow.setLocation("#!/"+this.url_slug+"/slideshow")}},setupLargeImage:function(){var a=this.getCurrentPImage();a.large!=null&&Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'><img src='"+a.large+"' width='"+a.largeWidth+"' height='"+a.largeHeight+"'id='posterousGalleryExpandedImg_"+this.galleryDiv.id+"'></a>",{opacity:0.6,width:parseInt(a.largeWidth),height:parseInt(a.largeHeight)});this.setupSlideshowGlyph()},setupSlideshowGlyph:function(){var a=
new Element("div",{style:"font-size: 14px;position:absolute;right:30px;bottom:15px;",id:this.galleryDiv.id+"-dl3"}),b=$("modal_container"),c=this.galleryDiv.id;if(this.url_slug!=undefined)Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' title='Click to view in full screen' />"):a.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+
this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />");else Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' title='Click to view in full screen' />"):a.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />");
b.appendChild(a);a.observe("click",this.handlePostSlideshow.bindAsEventListener(this));b.observe("mouseover",function(){$(""+c+"-slideshow")!=null&&$(""+c+"-slideshow").show()});b.observe("mouseout",function(){$(""+c+"-slideshow")!=null&&$(""+c+"-slideshow").hide()})},registerPrev:function(a){a.observe("mousedown",this.prevButtonClick.bindAsEventListener(this));Event.observe(a,"click",pgallery_stopclick,false)},isVisibleInViewport:function(){var a=$(this.galleryDiv).viewportOffset().top;return a>=
-200&&a<=document.viewport.getHeight()-200},handleKeyboard:function(a){if(this.isVisibleInViewport()){a=a.charCode||a.keyCode;if(a==37)this.prev();else a==39&&this.next()}},prevButtonClick:function(){this.prev()},prev:function(){this.idx==0?this.setIndex(this.imageList.length-1):this.setIndex(this.idx-1)},registerNext:function(a){a.observe("mousedown",this.nextButtonClick.bindAsEventListener(this));Event.observe(a,"click",pgallery_stopclick,false)},nextButtonClick:function(){this.next()},next:function(){this.idx==
this.imageList.length-1?this.setIndex(0):this.setIndex(this.idx+1)},setIndex:function(a){if(this.imageList[a].thumb!=null||this.imageList[this.idx].thumbLink!=null){this.imageList[this.idx].thumbLink.removeClassName("gallerySelectedImage");this.imageList[a].thumbLink.addClassName("gallerySelectedImage")}this.idx=a;this.labelSpan.update(this.idx+1+" of "+this.imageList.length);this.imageList[this.idx].getMainImage(this.setMainImage,this);Control.Modal.current&&$("posterousGalleryExpandedImg_"+this.galleryDiv.id)&&
this.setupLargeImage()},setMainImage:function(a,b){if(b==null)b=this;if(a!=null){b.unregisterMainImage(b.mainImage);$(b.mainImage).replace(a);b.mainImage=a;b.registerMainImage(b.mainImage);b.setupCommandPanel()}}})}
if(PWidgets==null){themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):500;var PWidgets="loaded";Event.observe(window,"load",function(){for(var a=$$(".post img, div.body div.inner img"),b=0;b<a.length;b++){var c=a[b];c.width>themeWidth&&new PosterousLargeExternal(c)}});var PosterousLargeExternal=Class.create({initialize:function(a){this.element=a;this.oldWidth=a.width;this.oldHeight=a.height;a.observe("click",this.handleClick.bindAsEventListener(this));
var b=posterous_resize_image(a.width,a.height,themeWidth);if(b!=null){a.width=b[0];a.height=b[1]}a.addClassName("pointer_cursor")},handleClick:function(){Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'><img src='"+this.element.src+"' width='"+this.oldWidth+"' height='"+this.oldHeight+"'></a>",{opacity:0.6})}}),posterous_resize_image=function(a,b,c){return a>c?[c,c*b/a]:null},pw_stopclick=function(a){Event.stop(a)}}if(typeof deconcept=="undefined")var deconcept={};
if(typeof deconcept.util=="undefined")deconcept.util={};if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil={};
deconcept.SWFObject=function(a,b,c,d,g,e,j,k,m,q){if(document.getElementById){this.DETECT_KEY=q?q:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];a&&this.setAttribute("swf",a);b&&this.setAttribute("id",b);c&&this.setAttribute("width",c);d&&this.setAttribute("height",d);g&&this.setAttribute("version",new deconcept.PlayerVersion(g.toString().split(".")));this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();
if(!window.opera&&document.all&&this.installedVer.major>7)deconcept.SWFObject.doPrepUnload=true;e&&this.addParam("bgcolor",e);this.addParam("quality",j?j:"high");this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);this.setAttribute("xiRedirectUrl",k?k:window.location);this.setAttribute("redirectUrl","");m&&this.setAttribute("redirectUrl",m)}};
deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"expressinstall.swf":a;this.setAttribute("useExpressInstall",true)},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addParam:function(a,b){this.params[a]=b},getParams:function(){return this.params},addVariable:function(a,b){this.variables[a]=b},getVariable:function(a){return this.variables[a]},getVariables:function(){return this.variables},getVariablePairs:function(){var a=
[],b,c=this.getVariables();for(b in c)a[a.length]=b+"="+c[b];return a},getSWFHTML:function(){var a="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}a='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';a+=
' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var b=this.getParams(),c;for(c in b)a+=[c]+'="'+b[c]+'" ';c=this.getVariablePairs().join("&");if(c.length>0)a+='flashvars="'+c+'"';a+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}a='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+
'" style="'+this.getAttribute("style")+'">';a+='<param name="movie" value="'+this.getAttribute("swf")+'" />';b=this.getParams();for(c in b)a+='<param name="'+c+'" value="'+b[c]+'" />';c=this.getVariablePairs().join("&");if(c.length>0)a+='<param name="flashvars" value="'+c+'" />';a+="</object>"}return a},write:function(a){if(this.getAttribute("useExpressInstall"))if(this.installedVer.versionIsValid(new deconcept.PlayerVersion([6,0,65]))&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",
true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){(typeof a=="string"?document.getElementById(a):a).innerHTML=this.getSWFHTML();return true}else this.getAttribute("redirectUrl")!=""&&document.location.replace(this.getAttribute("redirectUrl"));
return false}};
deconcept.SWFObjectUtil.getPlayerVersion=function(){var a=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var b=navigator.plugins["Shockwave Flash"];if(b&&b.description)a=new deconcept.PlayerVersion(b.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){b=1;for(var c=3;b;)try{c++;b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);a=new deconcept.PlayerVersion([c,
0,0])}catch(d){b=null}}else{try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(g){try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a=new deconcept.PlayerVersion([6,0,21]);b.AllowScriptAccess="always"}catch(e){if(a.major==6)return a}try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(j){}}if(b!=null)a=new deconcept.PlayerVersion(b.GetVariable("$version").split(" ")[1].split(","))}return a};
deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major)return false;if(this.major>a.major)return true;if(this.minor<a.minor)return false;if(this.minor>a.minor)return true;if(this.rev<a.rev)return false;return true};
deconcept.util={getRequestParameter:function(a){var b=document.location.search||document.location.hash;if(a==null)return b;if(b){b=b.substring(1).split("&");for(var c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return b[c].substring(b[c].indexOf("=")+1)}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){for(var a=document.getElementsByTagName("OBJECT"),b=a.length-1;b>=0;b--){a[b].style.display="none";for(var c in a[b])if(typeof a[b][c]=="function")a[b][c]=function(){}}};
if(deconcept.SWFObject.doPrepUnload)if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}if(!document.getElementById&&document.all)document.getElementById=function(a){return document.all[a]};
var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject,SWFObject=deconcept.SWFObject,PFavorite=Class.create({initialize:function(a,b,c,d,g){this.options=Object.extend({y_offset:20},g||{});this.hoverContainer=$(a);this.positionContainer=$(b);this.postid=c;this.isFaved=d;this.mouseoverHandler=this.mouseoverHandler_delegate.bindAsEventListener(this);this.mouseoutHandler=this.mouseoutHandler_delegate.bindAsEventListener(this);this.clickHandler=this.clickHandler_delegate.bindAsEventListener(this);
this.isLoading=false;this.createFavPanel();this.tooltip=PHover.factory_create(a,b,this.options);this.tooltip.addChildDiv(this.favpanel,"topright");this.favpanel.observe("mouseover",this.mouseoverHandler);this.favpanel.observe("mouseout",this.mouseoutHandler);this.favpanel.observe("click",this.clickHandler)},createFavPanel:function(){this.favpanel=new Element("div",{id:"favpanel_"+this.postid,style:"display:none;"});this.favpanel.addClassName("fav_star");this.favpanel.addClassName("posterous_favorite");
document.body.appendChild(this.favpanel);this.messageDiv=new Element("span",{style:"display:none;"});this.favpanel.appendChild(this.messageDiv);this.favImg=new Element("img",{src:"/images/icons/star.png",width:16,height:16});this.favpanel.appendChild(this.favImg);this.updateView()},mouseoverHandler_delegate:function(){if(!this.isLoading){this.messageDiv.show();this.favpanel.addClassName("fav_mouseover")}this.resetFavpanelPosition()},mouseoutHandler_delegate:function(){if(!this.isLoading){this.messageDiv.hide();
this.favpanel.removeClassName("fav_mouseover")}this.resetFavpanelPosition()},updateMessage:function(){this.messageDiv.innerHTML=this.isLoading?"Saving...":this.isFaved?"Unfavorite this":"Favorite this"},updateIcon:function(){this.favImg.src=this.isLoading?"/images/loading.gif":this.isFaved?"/images/icons/star.png":"/images/icons/star-hover.png"},updateView:function(){this.updateMessage();this.updateIcon()},clickHandler_delegate:function(){this.isLoading=true;this.messageDiv.show();this.updateView();
this.favpanel.addClassName("phover_donothide");var a=this;new Ajax.Updater(this.messageDiv,"/reader/favorite",{parameters:{id:this.postid,add:!a.isFaved,authenticity_token:window._token},onLoading:function(){a.resetFavpanelPosition()},onComplete:function(){a.isFaved=!a.isFaved;a.isLoading=false;a.updateIcon();a.resetFavpanelPosition()}})},resetFavpanelPosition:function(){this.tooltip.reposition(this.favpanel.getAttribute("id"))}}),PComment=Class.create({initialize:function(a,b,c){this.container=$(c);
this.postId=b;this.commentLink=$(a);this.linkClickHandler=this.linkClick_delegate.bindAsEventListener(this);this.commentLink.observe("click",this.linkClickHandler)},linkClick_delegate:function(a){$(this.commentLink.parentNode).hide();this.commentDiv==null?this.createCommentDiv():Effect.SlideDown(this.outerDiv,{duration:0.5});Event.stop(a);return false},hideCommentDiv:function(){Effect.SlideUp(this.outerDiv);Effect.SlideDown($(this.commentLink.parentNode))},createCommentDiv:function(){this.outerDiv=
new Element("div",{"class":"posterous_comments_wrapper",style:"display: none"});this.commentDiv=new Element("div");this.commentDiv.addClassName("posterous_comments");this.loadingDiv=new Element("div",{style:"display: none;"});this.loadingDiv.addClassName("comment_loading_div");this.loadingImg=new Element("img",{src:"/images/loading.gif"});this.loadingDiv.appendChild(this.loadingImg);this.container.appendChild(this.loadingDiv);this.outerDiv.appendChild(this.commentDiv);this.container.appendChild(this.outerDiv);
this.loadingDiv.show();new Ajax.Updater(this.commentDiv,"/posts/getcomments",{parameters:{id:this.postId,authenticity_token:window._token},evalScripts:true,onLoading:function(){},onComplete:function(){Effect.SlideDown(this.outerDiv,{duration:0.5,afterFinish:function(){p.initializeCommentForm(null,this.commentDiv.down('[data-posterous-comment-form="true"]').id)}.bind(this)});this.loadingDiv.hide();FB.XFBML.parse()}.bind(this)})}}),PTwitterComment=Class.create({initialize:function(a,b,c,d,g,e,j){this.twitterCheckbox=
$(a);this.commentBox=$(b);this.twitterBox=$(c);this.twitterDiv=$(d);this.twitterUsername=g;this.twitterShorturl=e;this.linkOutput=true;this.showLink=j;this.setup();this.updateAll()},updateAll:function(){this.updateTwitterBox();this.updateCheckbox()},setup:function(){this.twitterCheckbox.observe("click",this.updateCheckbox.bindAsEventListener(this));this.twitterBox.observe("change",function(){this.linkOutput=false}.bindAsEventListener(this));this.twitterBox.observe("keyup",this.updateTwitterCount.bindAsEventListener(this));
this.commentBox.observe("keyup",this.updateTwitterBox.bindAsEventListener(this));this.numLeft=new Element("div",{style:"font-size: 10px; color: #090; line-height: 12px;"});this.twitterDiv.appendChild(this.numLeft);this.twitterBoxExpander=new Texpand(this.twitterBox)},getCommentBoxValue:function(){return this.commentBox.value.gsub(/\n/,"")},specialTruncate:function(a,b){if(a.length>b){a=a.substring(0,b-3).replace(/[ \.]\w+$/,"");a+="..."}return a},updateTwitterBox:function(){if(this.linkOutput){var a=
this.twitterUsername?this.twitterUsername+" ":"",b=this.twitterShorturl?" "+this.twitterShorturl:"",c=140-a.length,d=this.getCommentBoxValue();if(c>=d.length&&this.twitterUsername&&!this.showLink)this.twitterBox.value=a+d;else if(d.length>0)this.twitterBox.value=a+this.specialTruncate(d,c-b.length)+b;this.updateTwitterCount();this.twitterBoxExpander._autoExpand()}},updateTwitterCount:function(){var a=140-this.twitterBox.value.length;this.numLeft.innerHTML=a>=0?a+" characters left":-1*a+" characters over the 140 character limit"},
updateCheckbox:function(){this.twitterCheckbox.checked?this.twitterDiv.show():this.twitterDiv.hide()}}),retweet_modal_window=null;
function client_retweet_update(a){var b=b||unescape($$('[data-posterous-backtype="true"]').first().readAttribute("data-posterous-urls-to-ids").gsub("+"," ")).evalJSON();retweets=a.tweetcounts;for(i=0;i<retweets.length;i++){url=retweets[i].url;count=retweets[i].tweetcount;post_id=b[url];count_id="num_tweets_"+post_id;parent_id="retweet_count_"+post_id;label_id="retweet_count_label_"+post_id;$(count_id)&&$(count_id).update(count);if(count==0)$(parent_id)&&$(parent_id).hide();else count==1&&$(label_id)&&
$(label_id).update("mention")}}function retweet_init_oauth_and_redirect(a){retweet_modal_window.location.href=a;new PeriodicalExecuter(function(b){if(retweet_modal_window.closed){submit_retweet("twitter_retweet_box");b.stop()}},0.25)}
var PRetweet=Class.create({initialize:function(a,b){this.retweet_box=$(a);this.charcount_box=$(b);this.retweet_box.observe("keyup",this.updateTwitterCount.bindAsEventListener(this));this.updateTwitterCount()},updateTwitterCount:function(){var a=140-this.retweet_box.value.length,b="";if(a<0){this.charcount_box.style.color="#FF0000";b=-1*a+" characters over the 140 character limit"}else{this.charcount_box.style.color="#009900";b=a+" characters left"}this.charcount_box.innerHTML=b}}),submit_retweet=
function(a){a=$(a).value;new Ajax.Request("/posts/retweet",{method:"post",parameters:{twitter_body:a,authenticity_token:$("retweet_authenticity_token").value},onSuccess:function(){Control.Modal.close()}})},Texpand=Class.create();
Texpand.prototype={initialize:function(a){var b=this;this.element=$(a);this.increment=14;if(this.element.tagName.toLowerCase()!="textarea")throw"Texpand: can only be initialized with a <textarea> but got <"+this.element.tagName.toLowerCase()+">";if(typeof Prototype=="undefined"||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)throw"Texpand: requires Prototype 1.6.0+";if(typeof Effect=="undefined")throw"Textpand: requires Script.aculo.us, specifically Effects";this.element.insert({after:'<div id="texpand-mimic-'+
this.element.identify()+'"></div>'});this.mimic=this.element.next();this.mimic.update(this.element.value);if(Prototype.Browser.IE){a=this.element.getStyle("fontSize");a.search(/em/)>=0&&this.element.setStyle({fontSize:parseFloat(a.replace(/em/,""))*10+"px"})}var c={};$w("borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing").each(function(d){c[d]=
b.element.getStyle(d)});this.mimic.setStyle(c);this.mimic.setStyle({display:"none",position:"absolute",left:"-9999px",top:"-9999px"});this.element.observe("keyup",b._autoExpand.bind(b));this._autoExpand(null);return this.element},_autoExpand:function(){this.mimic.update(this.element.value.replace(/\n/gm,"<br />"));var a=this.mimic.getHeight(),b=this.element.getHeight();a=b-a;b=b+(this.increment-a);if(a<this.increment){Effect.Queues.get("texpand"+this.element.identify()).each(function(c){c.cancel()});
this.element.morph("height: "+b+"px;",{duration:0.1,queue:{position:"end",scope:"texpand"+this.element.identify(),limit:2}})}}};
var PosterousHeader=Class.create({initialize:function(a,b){this.options=Object.extend({imgClear:"/images/header/default-clear-right.png",imgColored:"/images/header/yellow-arrow.png",imgArrow:"/images/header/yellow-arrow.png",imgExpanded:"/images/header/yellow-expanded.png",imgClearLeft:"/images/header/default-clear-left.png",imgColoredLeft:"/images/header/yellow-arrow-left.png",imgArrowLeft:"/images/header/yellow-arrow-left.png",imgExpandedLeft:"/images/header/yellow-expanded-left.png",clearDefault:true,
top_active_area_px:25,hide_offset_px:25,direction:"right"},b||{});this.headerDiv=$(a);this.viewstate="";this.setup();this.observeSubscriptionButtons()},observeSubscriptionButtons:function(){var a=$("posterous_bar_unsubscribe"),b=$("posterous_bar_subscribe"),c=$("posterous_loading_image");if(a&&b){a.observe("click",function(d){d.stop();confirm("Are you sure you want to unsubscribe from this posterous?")&&this.performSubscriptionAction(a,b,c)}.bindAsEventListener(this));b.observe("click",function(d){d.stop();
this.performSubscriptionAction(b,a,c)}.bindAsEventListener(this))}},performSubscriptionAction:function(a,b,c){action=a.readAttribute("data-action");siteId=a.readAttribute("data-site_id");method=action=="addsub"?"post":"delete";new Ajax.Request("/members",{method:method,parameters:{authenticity_token:window._token,site_id:siteId},onLoading:function(){c.show();a.hide()},onSuccess:function(){b.show()},onComplete:function(){c.hide()}})},setup:function(){$("posterousbar_nojs")&&$("posterousbar_nojs").hide();
if(this.options.clearDefault)this.getColorSum(this.getParentBackgroundColor(this.headerDiv.up()))>384?this.headerDiv.addClassName("posterousHeaderLight"):this.headerDiv.addClassName("posterousHeaderDark");else this.headerDiv.addClassName("posterousHeaderLight");this.options.direction=="left"&&this.headerDiv.addClassName("posterousHeaderLeft");this.headerDiv.addClassName("posterousHeader");var a=this.headerDiv.innerHTML;this.headerDiv.innerHTML="";if(this.options.direction=="right"){this.defaultImg=
(new Element("img",{src:this.options.clearDefault?this.options.imgClear:this.options.imgColored})).addClassName("posterousHeaderImageRight");this.defaultArrowImg=(new Element("img",{src:this.options.imgArrow,style:"display: none;"})).addClassName("posterousHeaderImageRight");this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpanded,style:"display: none;"})).addClassName("posterousHeaderImageRight")}else{this.defaultImg=(new Element("img",{src:this.options.clearDefault?this.options.imgClearLeft:
this.options.imgColoredLeft})).addClassName("posterousHeaderImageLeft");this.defaultArrowImg=(new Element("img",{src:this.options.imgArrowLeft,style:"display: none;"})).addClassName("posterousHeaderImageLeft");this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpandedLeft,style:"display: none;"})).addClassName("posterousHeaderImageLeft")}var b=new Element("a",{href:"http://posterous.com/"});b.appendChild(this.defaultImg);b.appendChild(this.defaultArrowImg);b.appendChild(this.defaultExpandedImg);
this.posterousImg=this.defaultImg;this.headerDiv.appendChild(b);this.expandedDiv=(new Element("div",{id:this.headerDiv.id+"expanded_content",style:"display: none;"})).update("Hello world!");this.expandedDiv.innerHTML=a;this.expandedDiv.addClassName(this.options.direction=="right"?this.options.clearDefault?"posterousHeaderExpandedDivRight":"posterousHeaderExpandedDivRightOpaque":this.options.clearDefault?"posterousHeaderExpandedDivLeft":"posterousHeaderExpandedDivLeftOpaque");this.headerDiv.appendChild(this.expandedDiv);
this.setState("hidden");document.observe("mousemove",this.mouseHandler.bindAsEventListener(this));Effect.Appear(this.headerDiv)},getParentBackgroundColor:function(a){if(a.getStyle==null)return"transparent";var b=a.getStyle("background-color");if(b&&b!="transparent"&&b!="rgba(0, 0, 0, 0)")return b;if(!a.up())return"transparent";return this.getParentBackgroundColor(a.up())},getColorSum:function(a){var b=0;if(Prototype.Browser.IE){a=a.gsub(/^#/,"");a=a.gsub(/^([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,
"#{1}#{1}#{2}#{2}#{3}#{3}");a=a.gsub(/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,function(c){return parseInt(c[1],16)+" "+parseInt(c[2],16)+" "+parseInt(c[3],16)})}a.scan(/\d+/,function(c){b+=parseInt(c)});return b},mouseHandler:function(a){var b=Event.pointerX(a);a=Event.pointerY(a);this.getCurrentPositions();if(this.viewstate=="expanded"&&this.isInExpandedArea(b,a)||this.isInActivationArea(b,a))this.setState("expanded");else this.viewstate!="expanded"&&this.isInTeaserArea(b,a)?this.setState("arrow"):
this.setState("hidden")},setState:function(a){if(this.viewstate!=a){if(a=="expanded"){this.defaultImg.hide();this.defaultArrowImg.hide();this.posterousImg=this.defaultExpandedImg;if(Prototype.Browser.IE)this.expandedDiv.show();else{this.sliding=true;Effect.Appear(this.expandedDiv,Object.extend({duration:0.15,afterFinish:function(){this.sliding=false}.bindAsEventListener(this)}))}this.posterousImg.show()}else if(a=="arrow"&&this.viewstate!="expanded"&&!this.sliding){this.defaultImg.hide();this.defaultExpandedImg.hide();
this.posterousImg=this.defaultArrowImg;this.posterousImg.show()}else{this.posterousImg=this.defaultImg;if(Prototype.Browser.IE){this.defaultArrowImg.hide();this.defaultExpandedImg.hide();this.posterousImg.show();this.expandedDiv.hide()}else{this.sliding=true;Effect.Fade(this.expandedDiv,Object.extend({duration:0.1,afterFinish:function(){this.defaultArrowImg.hide();this.defaultExpandedImg.hide();this.posterousImg.show();this.sliding=false}.bindAsEventListener(this)}))}}this.viewstate=a}},isInActivationArea:function(a,
b){return b<this.e_off.top+this.e_dim.height+5&&a>=this.e_off.left&&a<=this.e_off.left+this.e_dim.width},isInExpandedArea:function(a,b){return b<this.t_off.top+this.t_dim.height+this.options.hide_offset_px&&a>=this.t_off.left-this.options.hide_offset_px&&a<=this.t_off.left+this.t_dim.width+this.options.hide_offset_px},isInTeaserArea:function(a,b){return b<this.t_off.top+this.t_dim.height+this.options.top_active_area_px&&a>=this.e_off.left-this.options.top_active_area_px&&a<=this.e_off.left+this.e_dim.width+
this.options.top_active_area_px},getCurrentPositions:function(){this.e_dim=this.posterousImg.getDimensions();this.e_off=this.posterousImg.cumulativeOffset();this.t_dim=this.headerDiv.getDimensions();this.t_off=this.headerDiv.cumulativeOffset()}});
document.observe("dom:loaded",function(){if($("posterous_modal_flash")){setTimeout("Effect.Appear($('posterous_modal_flash'))",1E3);$("posterous_modal_flash").observe("click",function(){Effect.Fade($("posterous_modal_flash"),{duration:0.5})})}$("footerbar")&&$("footerbar").hasClassName("claimbar")&&setTimeout("Effect.BlindDown($('footerbar'))",1E3)});
var isIphone=navigator.userAgent.toLowerCase().indexOf("mobile")!=-1&&(navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1),Posterous=Class.create({_posterousDefaultAnimationDurationLong:0.5,_posterousDefaultAnimationDurationShort:0.2,modalWindow:null,posts:{},postIds:[],retries:0,initialize:function(){if($$("body").first().hasClassName("mobile"))this.initializeMobile();else{this.registerProtomenus();
this.initializeSubscriptionButtons();this.initializeSubscriptionLinks();if($$('meta[name="generator"]').first()){try{this.registerShowOnClickActions();this.registerShowOnHoverActions();this.registerSearchBoxes();this.registerComment();this.registerRetweetButtons();this.parseCodeBlocks();this.initializeEditBoxes();this.fillAllTimeAgoFields()}catch(a){}this.afterDeferredContentCallbacks=[this.setAuthenticityToken.bind(this),this.registerPosterousBar.bind(this),this.registerSubscribeLinks.bind(this),
this.registerSubscribeContent.bind(this),this.createFavorite.bind(this),this.replaceViewCounts.bind(this),this.createNewCommentForm.bind(this),this.initializeCommentForm.bind(this),this.insertAdminBox.bind(this),this.removeUnauthorizedEditBoxes.bind(this),this.fixDeleteLinks.bind(this),this.registerProtomenus.bind(this),this.setupUpsell.bind(this),this.postMixpanelUserActivity.bind(this)]}}},initializeMobile:function(){this.fillAllTimeAgoFields()},makeDeferredCallbacks:function(a){this.afterDeferredContentCallbacks.each(function(b){b(a)},
this)},setupUpsell:function(a){if(!a.logged_in&&a.show_upsell&&!isIphone){a=(new Element("a",{id:"posterous_footerbar",href:"http://www.posterous.com"})).update("Share it your way on Posterous - Create your own site, blog or group for free&nbsp;&raquo;");var b=(parseInt($(document.body).getStyle("margin-bottom"),10)+60).toString()+"px";$(document.body).setStyle("margin-bottom",b);$(document.body).appendChild(a);mpmetrics.track("JS - Upsell - Shown");a.observe("click",function(c){c.stop();mpmetrics.track("JS - Upsell - Clicked",
{},function(){window.location="http://www.posterous.com"})})}},postMixpanelUserActivity:function(a){if(a.logged_in){mpmetrics.track("User Activity",{id:a.uid,type:"Logged in Page View"});mpmetrics.track("User Activity, No Emails",{id:a.uid,type:"Logged in Page View"})}},registerProtomenus:function(){Prototype.Browser.IE||$$('[data-posterous-protomenu="true"]').each(function(a){a.href="#";a.down("img").show();items=$(a.readAttribute("data-posterous-items-list-id")).select("li a").map(function(b){return{href:b.href,
name:b.innerHTML,icon:b.readAttribute("data-icon")}});new Proto.Menu({selector:"#"+a.id,position:"relative",location:a,click:"left",width:200,className:"menu desktop",menuItems:items})})},insertBacktypeJavascript:function(){$$('[data-posterous-backtype="true"]').each(function(a){a=a.readAttribute("data-posterous-url");a=new Element("script",{type:"text/javascript",src:a,defer:"defer"});$$("head").first().insert(a)})},registerShowOnClickActions:function(){$$('[data-posterous-show-on-click="true"]').each(function(a){var b=
$(a.readAttribute("data-posterous-hide-on-click-id")),c=$(a.readAttribute("data-posterous-action-trigger-id")),d=$(a.readAttribute("data-posterous-id-to-show-on-click"));c&&d&&c.observe("click",function(g){g.stop();b&&b.hide();Effect.toggle(d,"slide",{duration:this._posterousDefaultAnimationDurationLong,afterFinish:function(){$j("body").trigger("show-on-click:finished")}})}.bindAsEventListener(this))},this)},registerShowOnHoverActions:function(){$$('[data-posterous-show-on-hover="true"]').each(function(a){var b=
$(a.readAttribute("data-posterous-action-trigger-id")),c=$(a.readAttribute("data-posterous-id-to-show-on-hover"));if(b&&c){b.observe("mouseover",function(){c.show()});b.observe("mouseout",function(){c.hide()})}})},registerSubscribeLinks:function(a){$$('[data-posterous-subscribe-link="true"]').each(function(b){var c=$(b.readAttribute("data-posterous-action-trigger-id")),d=$(b.readAttribute("data-posterous-id-to-be-replaced")),g=$(b.readAttribute("data-posterous-loading-element")),e=b.readAttribute("data-posterous-subscription-action").strip()==
"addsub"?"addsub":"removesub",j=b.readAttribute("data-posterous-site-id");if(e=="addsub")a.subscribed_to_this_site?b.hide():b.show();else a.subscribed_to_this_site?b.show():b.hide();c&&c.observe("click",function(k){k.stop();new Ajax.Request("/members/modal",{method:"get",evalScripts:true,parameters:{site_id:j},onLoading:function(){g.show();c.hide();d.update()},onComplete:function(){g.hide()},onSuccess:function(m){Control.Modal.open(m.responseJSON.rsp,{height:5,width:500});Control.Modal.showInternalElement($("modal_container").down(),
Effect.Appear);this.initializeSubscriptionModal()}.bind(this)})}.bind(this))}.bind(this))},initializeSubscriptionButtons:function(){$$('[data-posterous-subscribe-onsite-link="true"]').each(function(a){new StateButton(a,{initialState:a.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Subscribed",tooltip:"Click to change notification settings or unsubscribe."},contributor:{text:"You're a contributor",tooltip:"Click to change notification settings or unsubscribe."},
admin:{text:"You're an admin",tooltip:"Click to change notification settings or unsubscribe."},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},initializeSubscriptionLinks:function(){$$(".posterous_trigger_member_modal").each(function(a){new StateLink(a,{initialState:a.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Manage how I get email updates"},contributor:{text:"Manage how I get email updates"},
admin:{text:"Manage how I get email updates"},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},registerSubscribeContent:function(a){$$('[data-posterous-subscribe2-link="true"]').each(function(b){new StateContainer(b,{initialState:a.member_type,states:{unsubscribed:b.readAttribute("data-posterous-subscription-unsubscribed-content"),subscribed:b.readAttribute("data-posterous-subscription-subscribed-content"),contributor:b.readAttribute("data-posterous-subscription-contributor-content"),
admin:b.readAttribute("data-posterous-subscription-admin-content"),nonuser:b.readAttribute("data-posterous-subscription-non-user-content"),loading:b.readAttribute("data-posterous-loading")},stateTriggers:{unsubscribed:b.readAttribute("data-posterous-subscription-unsubscribed-action"),subscribed:b.readAttribute("data-posterous-subscription-subscribed-action"),contributor:b.readAttribute("data-posterous-subscription-contributor-action"),admin:b.readAttribute("data-posterous-subscription-admin-action"),
nonuser:b.readAttribute("data-posterous-subscription-non-user-action")},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},subscriptionButtonClicked:function(a){var b=a.currentState(),c=a.element.readAttribute("data-posterous-site-id");a.changeState("loading");var d=this;if(b=="unsubscribed"){mpmetrics.track("JS - Member Modal - Trigger Subscribe",{state:b});new Ajax.Request("/members",{method:"post",parameters:{site_id:c,authenticity_token:window._token},onComplete:a.changeState.bind(a,
"subscribed"),onSuccess:function(){d.openSubscriptionModal(b,c,{stateButton:a,afterClose:function(){b!="unsubscribed"&&a.changeState(b)}})}})}else{mpmetrics.track("JS - Member Modal - Trigger Edit",{state:b});this.openSubscriptionModal(b,c,{stateButton:a,afterClose:function(){b!="unsubscribed"&&a.changeState(b)}})}},openSubscriptionModal:function(a,b,c){c=$H({}).merge($H(c||{}));var d=a=="nonuser"?500:250;new Ajax.Request("/members/modal",{method:"get",parameters:{site_id:b,just_followed:a=="unsubscribed"?
true:null},onSuccess:function(g){Control.Modal.open(g.responseJSON.rsp,{height:5,width:d,afterClose:c.get("afterClose")});Control.Modal.showInternalElement($("modal_container").down(),Effect.Appear);this.initializeSubscriptionModal(c);typeof c.get("callback")=="function"&&c.get("callback")(a)}.bind(this)})},initializeSubscriptionModal:function(a){$$(".modal_cancel").each(function(b){b.observe("click",Control.Modal.close)});this.initializeNotificationForm(a);this.initializeSubscriptionForm(a)},initializeNotificationForm:function(){$("notification_user_option_form")&&
$("notification_user_option_select").observe("change",function(){mpmetrics.track("JS - Member Modal - Trigger freq of notification");$("notification_user_option_form").request({onLoading:function(){$("notification_user_option_ajax_result").update("<img src='/images/loading.gif' width='16' height='16' alt='loading'/>")},onSuccess:function(){$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/accept.png' width='16' height='16'/>")},onFailure:function(){$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/error.png' width='16' height='16'/>")}})})},
initializeSubscriptionForm:function(a){if($("subscribe_form")){var b=$$("#modal_container .subscription_form").first();$("subscribe_form_submit").observe("click",function(c){c.stop();if(!b||b.readAttribute("data-is-admin-or-contributor")!=""||confirm("Are you sure you want to remove yourself from this site?"))$("subscribe_form").request({onLoading:function(){$("subscribe_form_response").visible()&&Control.Modal.hideInternalElement($("subscribe_form_response"));Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_buttons"),
$("subscribe_form_loading"))})},onSuccess:function(d){var g=d.responseJSON;$("subscribe_form_response").removeClassName("subscribe_form_response_fail");$("subscribe_form_response").addClassName("subscribe_form_response_success");$("subscribe_form_response").update(g.rsp);if(b&&a.get("stateButton")){delete Control.Modal.current.options.afterClose;if(b.readAttribute("data-member")=="")a.get("stateButton").changeState("unsubscribed");else b.readAttribute("data-logged-in")==""&&a.get("stateButton").changeState("subscribed")}Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),
$("subscribe_form_response"))});Effect.waitForQueueClear(function(){g.reloadWindow?window.location.reload(true):setTimeout(function(){Control.Modal.close(false,true)},1500)})},onFailure:function(d){$("subscribe_form_response").addClassName("subscribe_form_response_fail");$("subscribe_form_response").update(d.responseJSON.rsp);Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),$("subscribe_form_buttons"))});Effect.waitForQueueClear(function(){Control.Modal.showInternalElement($("subscribe_form_response"))})}})})}},
registerSearchBoxes:function(){$$('[data-posterous-search-box="true"]').each(function(a){var b=$(a.readAttribute("data-posterous-search-button-id"));a=$(a.readAttribute("data-posterous-search-box-id"));var c=false;if(b&&a){b.observe("mouseover",function(){c=true});b.observe("mouseout",function(){c=false});a.observe("focus",function(){b.show()});a.observe("blur",function(){c||b.hide()})}})},registerPosterousBar:function(a){$$('[data-posterous-bar="true"]').each(function(b){$(b.readAttribute("data-posterous-action-id")||
b.id).insert({bottom:a.posterous_bar});new PosterousHeader($(b.readAttribute("data-posterous-action-id")||b.id),{direction:b.readAttribute("data-posterous-direction")||"left",clearDefault:b.readAttribute("data-posterous-translucent")||"false"})});$$('[data-posterous-bar-legacy="true"]').each(function(b){b.update(a.posterous_bar_legacy).show()},this)},createFavorite:function(a){var b=null;$$('[data-posterous-favorite="true"]').each(function(d){if($(d.readAttribute("data-posterous-position"))&&$(d.readAttribute("data-posterous-hover"))){b=
a.post_favorited[parseInt(d.readAttribute("data-posterous-identifier"),10)];new PFavorite(d.readAttribute("data-posterous-hover"),d.readAttribute("data-posterous-position"),d.readAttribute("data-posterous-identifier"),b==true)}},this);var c;$j("[data-posterous-like-button-for-post-id]").each(function(){c=$j(this).attr("data-posterous-like-button-for-post-id");p.setLikedState(c,a.post_favorited[parseInt(c,10)])})},setLikedState:function(a,b){var c=$j('[data-posterous-like-button-for-post-id="'+a+'"]');
if(b)var d=c.attr("data-posterous-unlike-text"),g="unlike_post",e=c.attr("data-unlike-url");else{d=c.attr("data-posterous-like-text");g="like_post";e=c.attr("data-like-url")}c.removeClass().addClass(g).attr("href",e).attr("title",d).children("span").html(d);if(!Modernizr&&(document.body||document.documentElement).style.WebkitPerspective===undefined||!Modernizr.csstransforms3d)if(b){c.children(".p_unlike_icon").show();c.children(".p_like_icon").hide()}else{c.children(".p_unlike_icon").hide();c.children(".p_like_icon").show()}else{c.children(".p_unlike_icon").show();
c.children(".p_like_icon").show()}},registerComment:function(){$$('[data-posterous-comment="true"]').each(function(a){if($(a.readAttribute("data-posterous-comment-link")))window[a.readAttribute("data-posterous-comment-var")]=new PComment($(a.readAttribute("data-posterous-comment-link")),a.readAttribute("data-posterous-post-identifier"),$(a.readAttribute("data-posterous-post-div")))})},registerRetweetButtons:function(){$$('[data-posterous-retweet="true"]').each(function(a){new PModal(a.id,"/posts/retweet",
{post_id:a.readAttribute("data-posterous-post-id"),authenticity_token:window._token},{width:500,height:160,identifier:"retweet_modal_"+a.readAttribute("data-posterous-post-id")})})},parseCodeBlocks:function(){if($$('[data-posterous-parse-code="true"]').length>0){dp.SyntaxHighlighter.ClipboardSwf="/javascripts/syntaxhighlighter/clipboard.swf";dp.SyntaxHighlighter.HighlightAll("code",false)}},replaceViewCounts:function(a){$$('[data-posterous-view-count="true"]').each(function(b){var c=parseInt(b.readAttribute("data-posterous-post-id"),
10);if(a&&a.post_views&&(a.post_views[c]||a.post_views[c]===0))b.replace(a.post_views[c])})},fillAllTimeAgoFields:function(){var a=null;$$('[data-posterous-time-ago="true"]').each(function(b){a=parseInt(b.readAttribute("data-posterous-pubdate"),10);b.replace(this._timeAgoInWords(a)+" ago")},this)},insertAdminBox:function(a){$$('[data-posterous-admin-box="true"]').each(function(b){b.replace(a.admin_box)})},initializeCommentForm:function(a,b){var c=null,d=false,g=null,e=null,j=null,k=null,m=b?[$(b)]:
$$('[data-posterous-comment-form="true"]');$$('[data-posterous-user-setting-toggle="true"]').each(function(q){q.observe("click",function(){if(q.checked)new Ajax.Request("/user_settings/set/"+q.readAttribute("data-posterous-user-setting-attribute"),{method:"get"});else new Ajax.Request("/user_settings/unset/"+q.readAttribute("data-posterous-user-setting-attribute"),{method:"get"})})});m.each(function(q){c=q.readAttribute("data-posterous-post-id");d=q.readAttribute("data-posterous-facebook")=="true";
if(e=$("pcomment_newbody_"+c))new Texpand(e);q.select('.facebook_login_button, [data-facebook-login-botton="true"]').each(function(w){w.observe("click",function(u){u.stop();FB.login(function(){window.location.href=w.href})})});if(g=q.down(".facebook_logout_button"))g.observe("click",function(w){w.stop();FB.logout(function(){window.location.reload(true)})});if(k=$$('[data-posterous-twitter-oauth="true"]').first())this.posts=unescape(k.readAttribute("data-posterous-post-ids").gsub("+"," ")).evalJSON();
q.select(".twitter_login_button").each(function(w){w.observe("click",function(u){u.stop();this.initOauthAndRedirectToPost("1",this.posts[parseInt(c,10)])}.bindAsEventListener(this))},this);if($("comment_email_notify_toast_"+c)){$("comment_email_notify_"+c).observe("click",function(){this._refreshToast(c,true)});this._refreshToast(c,false)}if(twitterPreview=$("twitter_preview_"+c)){j=new PTwitterComment("push_twitter_comment_"+c,"pcomment_newbody_"+c,"twitter_body_"+c,"twitter_preview_"+c,twitterPreview.readAttribute("data-posterous-twitter-username"),
twitterPreview.readAttribute("data-posterous-short-url"),twitterPreview.readAttribute("data-posterous-show-lin"));j.updateAll()}q.observe("submit",function(w){w.stop();$("push_fbfeed_"+c)&&$("push_fbfeed_"+c).checked&&FB.getSession()==null&&FB.login(Prototype.empty);$("pcomment_submit_loading_"+c).show();$("posterous_submit_"+c).hide();$j.ajax({type:"post",url:q.action,data:$j(this).serialize(),success:function(){$("pcomment_newbody_"+c).value="";if($("twitter_body_"+c))$("twitter_body_"+c).value=
""},complete:function(u){$j("#pcomment_comments_new_"+c).append(u.responseText);$("pcomment_submit_loading_"+c).hide();$("posterous_submit_"+c).show();$("first_comment_"+c)&&$("first_comment_"+c).hide();$("pcomment_comments_new_"+c).highlight();d&&p.publishCommentToFacebook(c)}})})},this)},publishCommentToFacebook:function(a,b,c){window["fb_comment_"+a]=b||$("pcomment_newbody_"+a).value;window["push_fbfeed_"+a]=c||($("push_fbfeed_"+a)?$("push_fbfeed_"+a).checked:false);if(window["push_fbfeed_"+a]){if(window["fb_comment_attachment_"+
a]==undefined)window["fb_comment_attachment_"+a]=null;if(window["fb_comment_action_link_"+a]==undefined)window["fb_comment_action_link_"+a]=null;if(window.fbid_site_owner==undefined)window.fbid_site_owner=1;new PeriodicalExecuter(function(d){if(FB.getSession()!=null){FB.ui({method:"stream.publish",message:window["fb_comment_"+a],user_message_prompt:"What are your comments?",attachment:window["fb_comment_attachment_"+a],action_links:window["fb_comment_action_link_"+a]});d.stop()}},1)}FB.XFBML.parse()},
createNewCommentForm:function(a){a.new_comment_form&&$$('[data-posterous-new-comment-form="true"]').each(function(b){b.replace(a.new_comment_form);FB.XFBML.parse()})},initializeTagForm:function(a,b){var c=$j(this),d=$j.parseJSON($j(b.modal).find("[data-tag-feed]").attr("data-tag-feed")),g=c.attr("data-post-id"),e=$j(b.modal).find("[data-tag-feed]").attr("data-create-url"),j=$j(b.modal).find("[data-tag-feed]").attr("data-destroy-url");(new ProtoMultiSelect("tags-input-box",null,{feed:d,defaultMessage:"Type the name of a tag you'd like to add to this post.",
newValues:true,sortResults:true,onUserAdd:function(k){$j.jsonp({url:e,data:{tags:k.caption,post_id:g,authenticity_token:window._token,format:"jsonp"}})},onUserRemove:function(k){$j.jsonp({url:j,data:{caption:k.caption,id:k.value,new_value:k.newValue,post_id:g,authenticity_token:window._token,format:"jsonp"}})}})).inputElem.focus()},initializeEditBoxes:function(){$j('[data-posterous-tag-form="true"]').bind("modal:success",this.initializeTagForm);$$('[data-posterous-autopost-modal="true"]').each(function(a){new PModal(a.id,
"/autopost/crosspost",{post_id:a.readAttribute("data-posterous-post-id")},{width:300,height:300})})},removeUnauthorizedEditBoxes:function(a){$$('[data-posterous-edit-box="true"]').each(function(b){a.edit_boxes[parseInt(b.readAttribute("data-posterous-post-id"),10)]?b.removeClassName("posterous_edit_box_hidden"):b.remove()})},setAuthenticityToken:function(a){if(a.authenticity_token)window._token=a.authenticity_token},fixDeleteLinks:function(){$$('[data-posterous-delete-link="true"]').each(function(a){a.observe("click",
function(b){a.innerHTML="Deleting...";Event.stop(b);confirm(a.readAttribute("data-posterous-confirm"))&&new Ajax.Request(a.href,{method:"delete",parameters:{authenticity_token:window._token},onSuccess:function(){window.location.reload()}})})})},_refreshToast:function(a,b){if($("comment_email_notify_"+a).checked){$("comment_email_notify_toast_"+a).value="Please enter your email address here";$("comment_email_notify_toast_"+a).show();if(b){$("comment_email_notify_toast_"+a).focus();$("comment_email_notify_toast_"+
a).select()}}else{$("comment_email_notify_toast_"+a).value="";$("comment_email_notify_toast_"+a).hide()}},initOauthAndRedirectToPost:function(a,b){this.modalWindow=window.open("","_blank","height=400,width=800,left=300,top=200,resizable=yes",true);this.modalWindow.location.href=$$('[data-posterous-twitter-oauth="true"]').first().readAttribute("data-posterous-redirect-url")+a;new PeriodicalExecuter(function(c){if(this.modalWindow.closed){if(window.location.href==b||window.location.href+"#comments"==
b)window.location.reload();else window.location.href=b;c.stop()}}.bind(this),0.25)},_timeAgoInWords:function(a){return this._distanceOfTimeInWords(Math.floor((new Date).getTime()/1E3),a)},_distanceOfTimeInWords:function(a,b){secondsAgo=a-b;minutesAgo=Math.max(Math.floor(secondsAgo/60),0);if(minutesAgo==0)return"less than a minute";if(minutesAgo==1)return"1 minute ago";if(minutesAgo<45)return minutesAgo+" minutes";if(minutesAgo<90)return" 1 hour";hoursAgo=Math.floor(minutesAgo/60);if(minutesAgo<1440)return hoursAgo+
" hours";if(minutesAgo<2880)return"1 day";daysAgo=Math.floor(minutesAgo/1440);if(minutesAgo<43200)return daysAgo+" days";if(minutesAgo<86400)return"1 month";monthsAgo=Math.floor(minutesAgo/43200);if(minutesAgo<525960)return monthsAgo+" months";if(minutesAgo<1051920)return"1 year";yearsAgo=Math.floor(minutesAgo/525960);return"over "+yearsAgo+" years"}});
typeof Effect!="undefined"&&Object.extend(Effect,{swapElems:function(a,b,c){c||(c={});Effect.Fade(a,Object.extend(c,{queue:"front"}));Effect.Appear(b,Object.extend(c,{queue:"end"}))},waitForQueueClear:function(a,b){b||(b="global");new PeriodicalExecuter(function(c){if(Effect.Queues.get(b).effects.length==0){c.stop();a()}},0.2)}});Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();Ajax.activeRequestCount--};
document.observe("dom:loaded",function(){afterload=(new Date).getTime();p=new Posterous;$$("body").first().fire("posterous:initialized");p.insertBacktypeJavascript();if(typeof beforeload!="undefined"){loadtime=Math.round((afterload-beforeload)/1E3*Math.pow(10,1))/Math.pow(10,1);mpmetrics.track("Pageview - IP",{type:pagetype,load_time:loadtime})}});
var ActionMenu=Class.create({initialize:function(a,b){var c=$H({onItemSelected:null,onMenuOpened:null});this.menu=$(a);if(!this.menu.readAttribute("data-menu-activated")!="true"){this.menu.writeAttribute("data-menu-activated","true");this.options=c.merge($H(b||{}));this.button=this.menu.down(".button, .action_menu_dropdown_button");this.dropDown=this.button.next();this.button.observe("click",this.menuOpened.bindAsEventListener(this));this.dropDown.select("a").each(function(d){d.observe("click",this.itemSelected.bindAsEventListener(this,
d))},this)}},itemSelected:function(a,b,c){c||typeof this.options.get("onItemSelected")=="function"&&this.options.get("onItemSelected")(a,b,this)},menuOpened:function(a){a.stop();ActionMenu.resetAllDropdowns();if(!this.button.hasClassName("active")){this.button.addClassName("active");this.dropDown.show()}this.menu.setStyle({zIndex:1E3});typeof this.options.get("onMenuOpened")=="function"&&this.options.get("onMenuOpened")(a,this)}});
ActionMenu.resetAllDropdowns=function(){$$(".action_menu, .state_menu").each(function(a){a.setStyle({zIndex:1});a.down(".action_menu_dropdown:visible").hide();a.down(".action_menu_dropdown_button, .button").removeClassName("active")})};
var StateMenu=Class.create(ActionMenu,{initialize:function($super,b,c){$super(b,c);this.value=this.menu.readAttribute("data-value")||this.button.down("span").innerHTML;this.previousItem=this.menu.select("li.selected a").first()||this.menu.select("li").first()},itemSelected:function($super,b,c,d){b&&b.stop();var g=c.down("span").innerHTML;this.menu.writeAttribute("data-value",c.readAttribute("data-value")||g);this.value=this.menu.readAttribute("data-value");this.button.down("span").innerHTML=g;this.previousItem=
c.up("ul").select("li.selected a").first();c.up("ul").select("li").invoke("removeClassName","selected");c.up("li").addClassName("selected");ActionMenu.resetAllDropdowns();$super(b,c,d)},undo:function(){this.itemSelected(null,this.previousItem,true)}}),ActionSplitButton=Class.create({initialize:function(a,b){this.menu=$(a);this.onItemSelected=b;this.menu.select("li").each(function(c){c.observe("click",this.itemSelected.bindAsEventListener(this,c))},this)},itemSelected:function(a,b){a.stop();if(!b.hasClassName("active")){b.up("ul").select("li").invoke("removeClassName",
"active");b.addClassName("active");typeof this.onItemSelected=="function"&&this.onItemSelected(a,b)}}}),AutoFadeInput=Class.create({initialize:function(a,b){this.options=$H({onKeypress:null,onBlur:null,onFocus:null}).merge($H(b||{}));this.input=$(a);this.label=this.input.adjacent("label").first();this.input.observe("keyup",this.keyWasPressed.bind(this));this.input.observe("focus",this.inputWasFocused.bind(this));this.input.observe("blur",this.inputWasBlurred.bind(this));this.keyWasPressed()},keyWasPressed:function(){this.input.present()&&
this.label.hide();typeof this.options.get("onKeypress")=="function"&&this.options.get("onKeypress")(this)},inputWasBlurred:function(){this.input.present()||this.label.appear({duration:p._posterousDefaultAnimationDurationShort,to:1});typeof this.options.get("onBlur")=="function"&&this.options.get("onBlur")(this)},inputWasFocused:function(){this.label.fade({duration:p._posterousDefaultAnimationDurationShort,to:0.5});typeof this.options.get("onFocus")=="function"&&this.options.get("onFocus")(this)}}),
ErrorBox=Class.create({initialize:function(a,b,c,d,g){a=$(a);var e=(new Element("a",{"class":"close",href:"#",title:"Close this popup"})).update("Close");b=(new Element("h1")).update(b.stripTags());c=(new Element("p")).update(c.stripTags());var j=(new Element("div",{"class":"p_popup "+g})).insert((new Element("div")).insert((new Element("div",{"class":"inner"})).insert(e).insert(b).insert(c)));this.outer=j;$(document.body).insert(j);g=a.cumulativeOffset();a=a.getWidth();c=j.getDimensions();j.setStyle({left:g[0]+
a/2-c.width/2+"px",top:g[1]-c.height-20+"px"});e.observe("click",function(k){Event.stop(k);d!==false?this.dropAndFade(e.up(".p_popup"),{duration:p._posterousDefaultAnimationDurationLong,afterFinish:function(){j.remove()}}):j.remove()}.bind(this));document.body.observe("click",function(k){Event.element(k).up(".p_popup")||$$(".p_popup").invoke("remove")});d!==false?this.dropAndAppear(j,{duration:p._posterousDefaultAnimationDurationLong}):j.show().setOpacity(1)},dropAndAppear:function(a,b){a.addClassName("active");
if(typeof a.style.webkitTransform=="undefined")new Effect.Parallel([new Effect.Move(a.down(),{sync:true,y:20,mode:"relative"}),new Effect.Appear(a.down(),{sync:true})],b||{});else a.show()},dropAndFade:function(a,b){if(typeof a.style.webkitTransform=="undefined")new Effect.Parallel([new Effect.Move(a.down(),{sync:true,y:-20,mode:"relative"}),new Effect.Fade(a.down())],b||{});else a.removeClassName("active")},dismiss:function(){this.dropAndFade(this.outer,{afterFinish:function(){this.outer.remove();
delete this}.bind(this)})}}),StateLink=Class.create({initialize:function(a,b){var c=$H({states:{}});this.element=$(a);this.options=c.merge($H(b||{}));this.states=this.options.get("states");this.observeStateTrigger();this.changeState(this.options.get("initialState")||"")},observeStateTrigger:function(){this.element.observe("click",this.buttonClicked.bindAsEventListener(this))},buttonClicked:function(a){a.stop();typeof this.options.get("onButtonClicked")=="function"&&this.options.get("onButtonClicked")(this)},
changeState:function(a){var b=this.currentState();this.element.writeAttribute("data-state",a);this.element.removeClassName(b).addClassName(a);this.updateStateText();this.states[this.currentState()].tooltip?this.element.writeAttribute("data-posterous-tooltip",this.states[this.currentState()].tooltip):this.element.removeAttribute("data-posterous-tooltip");typeof this.options.get("onChangeState")=="function"&&this.options.get("onChangeState")(this)},updateStateText:function(){var a=this.currentState();
this.states[a]&&this.element.update(this.states[a].text)},currentState:function(){return this.element.readAttribute("data-state")}}),StateButton=Class.create(StateLink,{updateStateText:function(){var a=this.currentState();this.states[a]&&this.element.down("span").update(this.states[a].text)}}),StateContainer=Class.create(StateLink,{observeStateTrigger:function(){this.stateTriggers=$H(this.options.get("stateTriggers")||{});this.stateTriggers.each(function(a){$(a.value).observe("click",this.buttonClicked.bindAsEventListener(this))},
this)},changeState:function($super,b){var c=this.currentState();this.element.writeAttribute("data-state",b);this.states[c]&&$(this.states[c]).hide();this.states[b]&&$(this.states[b]).show();typeof this.options.get("onChangeState")=="function"&&this.options.get("onChangeState")(this)}});
(function(a){a(function(){a("[data-posterous-tooltip]").live("mouseover mouseout",function(b){if(b.type=="mouseover"){b=a(this).attr("data-posterous-tooltip");var c=a(this).offset(),d=a(this).innerHeight(),g=a(this).innerWidth(),e=a(window).width(),j="left";if(c.left+200>e)j="right";a("body").append('<div class="p_tooltip '+j+'" data-posterous-tooltip-box="true"><div class="p_nub"><div class="p_icon"></div></div><div class="inner">'+b+"</div></div>");a(".p_tooltip").css({top:c.top+d+8+"px"});j=="right"?
a(".p_tooltip").css({right:e-c.left-g/2-31+"px"}):a(".p_tooltip").css({left:c.left+g/2-31+"px"})}else a('[data-posterous-tooltip-box="true"]').remove();return false})})})($j);document.observe("click",ActionMenu.resetAllDropdowns);if(typeof window.innerShiv==="undefined")window.innerShiv=function(a){return a};
var Responses=function(a){function b(){a("[data-posterous-toggle-for]").live("click",function(o){o.preventDefault();o=a(this);var t=o.attr("data-posterous-toggle-for");t=o.siblings('[name="'+t+'"]');if(t.val()=="1"){o.removeClass("active");t.val("0")}else{o.addClass("active");t.val("1")}})}function c(){a('[data-posterous-twitter-login-button="true"]').live("click",function(o){o.preventDefault();p.initOauthAndRedirectToPost("1",a(this).attr("data-posterous-jumpto-url"))})}function d(){a(".p_action_links a").live("click",
function(o){o.preventDefault();var t=a(this),x=this;o=a(this).attr("href");if(t.attr("data-confirm")&&!confirm(t.attr("data-confirm")))return false;v(t);a.ajax({url:o,type:"get",success:function(s){s=new ErrorBox(x,"Done and done.",s,true,"confirmation");g(t,s)},error:function(s){new ErrorBox(t,"Oops. There was an error",s,true,"error")},complete:function(){a(t).removeClass("loading").children("img").remove()}})})}function g(o,t){a(o).attr("data-posterous-approve-comment")=="true"?setTimeout(function(){a(o).remove();
t.dismiss()},4E3):setTimeout(function(){t.dismiss();a(o).closest("article").fadeOut(500,function(){a(o).remove()})},3E3)}function e(){a(".p_responses_link a").live("click",function(o){o.preventDefault();o=a(this);var t=o.attr("href"),x=o.attr("data-response-post-id"),s=a('[data-posterous-responses-for-post-id="'+x+'"]');x=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");if(x!=undefined&&x=="site"){n(s);if(s.children(".p_response_container").size()>0&&s.children(".p_response_container").css("display")!=
"none"&&o.parent().siblings(".p_comment_link").hasClass("active")==false)s.children().slideUp();else if(s.children(".p_response_container").size()>0)s.children().slideDown();else{h(s);a.ajax({url:t,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(y){l(s);s.append(innerShiv(y.html));s.find(".p_response_container").slideDown();s.find(".p_response_container").find(".p_responses_list").children().show();FB.XFBML.parse()}})}}else if(s.children(".p_like_failed").size()>
0){n(s);s.children().slideDown();s.next(".p_comment_form").slideDown()}})}function j(){a(".p_like_link .like_post, .p_like_link .unlike_post").live("click",function(o){o.preventDefault();var t=a(this),x=a(this).hasClass("like_post");o=t.attr("href");var s=t.parents(".p_response_widget").next();n(s);x?h(s,"Liking"):h(s,"Unliking");a.ajax({url:o,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(y){l(s);if(x){if(s.children().size()>0){s.children(".p_response_container").children(".p_responses_list").append(innerShiv(y.html));
s.children(".p_response_container").children(".p_responses_list").find(".p_like:last").fadeIn()}count_elm=t.parent().parent().children(".p_responses_link").children().children("strong");u(count_elm)}else{s.children().size()>0&&a('[data-posterous-responses-for-post-id="'+y.post_id+'"] [data-likes_user_id="'+y.user_id+'"]').remove();var z=count_elm=t.parent().parent().children(".p_responses_link").children().children("strong");count=count_elm.html();new_count=parseInt(count)-1;z.html(new_count);(header_elm=
z.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link"))&&header_elm.html("View All "+new_count)}p.setLikedState(y.post_id,x)},error:function(y){var z=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");l(s);if(s.children().size()>0){s.children().slideUp();z!=undefined&&z=="post"&&s.next(".p_comment_form").slideUp()}s.append(innerShiv(a.parseJSON(y.responseText).html));s.find(".p_like_failed").slideDown();if(t.parent().siblings(".p_comment_link").hasClass("active")){t.parent().siblings(".p_comment_link").children(".p_comment_link a").removeClass("active");
t.parent().siblings(".p_comment_link").removeClass("active")}t.parent().siblings(".p_responses_link").hasClass("active")&&t.parent().siblings(".p_responses_link").removeClass("active");FB.XFBML.parse()}})})}function k(){a(".p_comment_link a").live("click",function(o){o.preventDefault();o=a(this);var t=o.attr("href"),x=o.attr("data-comment-post-id"),s=a('[data-posterous-responses-for-post-id="'+x+'"]');x=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");if(x!=
undefined&&x=="post")if(s.children(".p_like_failed").size()>0){n(s);s.children().slideDown();s.next(".p_comment_form").slideDown();setTimeout(function(){form_elm=s.next(".p_comment_form").find("#new_comment");a("html, body").animate({scrollTop:form_elm.offset().top},500);form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()},
500)}else{form_elm=s.next(".p_comment_form").find("#new_comment");a("html, body").animate({scrollTop:form_elm.offset().top},500);form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}else{n(s);if(s.children(".p_response_container").size()>0&&s.children(".p_response_container").css("display")!="none"&&o.parent().siblings(".p_responses_link").hasClass("active")==
false)s.children().slideUp();else{h(s);if(s.children(".p_response_container").size()>0){s.children().slideDown();l(s);list_form=s.children(".p_response_container").children(".p_comment_form").find("#new_comment");form_elm=list_form.size()==0?s.next(".p_comment_form").find("#new_comment"):list_form;a("html, body").animate({scrollTop:form_elm.offset().top},500);form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}else a.ajax({url:t,
type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(y){l(s);s.append(innerShiv(y.html));s.find(".p_response_container").slideDown();s.find(".p_response_container").find(".p_responses_list").children().fadeIn();form_elm=s.children(".p_response_container").children(".p_comment_form");a("html, body").animate({scrollTop:form_elm.offset().top},500);form_elm.find("#new_comment").children(".p_not_authorized").size()>0?form_elm.find("#new_comment").children(".p_comment_section").children().children("#comment_name").focus():
form_elm.find("#new_comment").children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}})}}})}function m(){var o=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");typeof o!=="undefined"&&o=="post"&&a(".p_responses_link a").parent().addClass("active");a(".p_responses_link a").live("click",function(){var t=a(this).parent();if(t.hasClass("active"))o!=undefined&&o=="site"&&t.removeClass("active");else t.addClass("active");
if(t.siblings(".p_comment_link").children(".p_comment_link a").hasClass("active")){t.siblings(".p_comment_link").children(".p_comment_link a").removeClass("active");t.siblings(".p_comment_link").removeClass("active")}t.siblings(".p_like_link").hasClass("active")&&t.siblings(".p_like_link").removeClass("active")});a(".p_comment_link a").live("click",function(){var t=a(this),x=t.parent();if(t.hasClass("active")){if(o!=undefined&&o=="site"){t.removeClass("active");x.removeClass("active")}}else{t.addClass("active");
x.addClass("active")}x.siblings(".p_responses_link").hasClass("active")&&x.siblings(".p_responses_link").removeClass("active");x.siblings(".p_like_link").hasClass("active")&&x.siblings(".p_like_link").removeClass("active")})}function q(){a(".new_comment").find("button").live("click",function(o){o.preventDefault();var t=a(this),x=t.find("span"),s=t.closest("form"),y=x.text();s.find(".p_responses_list");t.addClass("loading").attr("disabled","disabled");x.html("Submitting...");s.find("[data-posterous-push-to-facebook]").val()==
"1"&&FB.getSession()==null&&FB.login();a.ajax({type:"post",url:s.attr("action"),dataType:"json",data:s.serialize(),success:function(z){var A=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");a(".p_no_responses").remove();container=A!=undefined&&A=="site"?s.parent().parent():s.parent().prev().find(".p_response_container");container.children(".p_responses_list").append(innerShiv(z.html));container.children(".p_responses_list").find(".p_comment:last").fadeIn();
s.find("[data-posterous-push-to-facebook]").size()>0&&p.publishCommentToFacebook(s.find('[name="comment[post_id]"]').val(),s.find("textarea").val(),s.find("[data-posterous-push-to-facebook]").val()=="1");t.removeClass("loading").removeAttr("disabled");x.text(y);count_elm=container.children(".p_responses_list").parent().parent().siblings(".p_response_widget").children().children(".p_responses_link").children().children("strong");u(count_elm);s[0].reset()},error:function(z){z=a.parseJSON(z.responseText);
t.removeClass("loading").removeAttr("disabled").children().html(y);new ErrorBox(t.get(0),z.return_heading,z.messages[0],true,"error")}});return false});a(".new_comment").live("submit",function(o){o.preventDefault();return false})}function w(){a(".new_comment").find("button").live("click",function(o){o.preventDefault();var t=a(this),x=a(".action_button_label"),s=t.closest("form"),y=x.text();t.addClass("loading").attr("disabled","disabled");x.text("Submitting...");a.ajax({type:"post",url:s.attr("action"),
dataType:"json",data:s.serialize(),success:function(z){a(z.html).hide().appendTo(".p_responses_list").fadeIn(function(){a(".p_responses_list").children().css("opacity","")});t.removeClass("loading").removeAttr("disabled");x.text(y);s[0].reset()}});return false})}function u(o){count=count_elm.html();new_count=parseInt(count)+1;o.html(new_count);(header_elm=o.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link"))&&header_elm.html("View All "+new_count)}function r(o){return a(o).parents(".p_responses").hasClass("dark")?
"/images/site/responses_loader_dark.gif":"/images/site/responses_loader.gif"}function v(o){a(o).addClass("loading").append('<img src="'+r(o)+'" alt=""/>')}function h(o,t){var x;(new Image).src=r(o);x=t!=null?'<div class="loading_comment"><div class="loading"><img src="'+r(o)+'" /><span>'+t+"...</span></div></div>":'<div class="loading_comment"><div class="loading"><img src="'+r(o)+'" /><span>Loading...</span></div></div>';response_item=o.siblings(".p_response_widget").children().children(".p_responses_link");
response_item.children().hide();response_item.prepend(x).show()}function l(o){response_item=o.siblings(".p_response_widget").children().children(".p_responses_link");response_item.children(".loading_comment").remove();response_item.children().show()}function n(o){failed_elm=o.children(".p_like_failed");failed_elm.size()>0&&failed_elm.remove()}a(document).ready(function(){if(window.hotmail!=true){e();j();k();m();d();c();b();q();a(".p_responses_list").children().show()}else{a.support.opacity=true;w()}})},
responses=Responses($j),ContentParts=function(a){function b(){if(FlashDetect.installed){a("[data-posterous-flash-video-embed]").show();a("[data-posterous-html5-video-embed]").hide()}else{a("[data-posterous-flash-video-embed]").hide();a("[data-posterous-html5-video-embed]").show()}a("[data-posterous-html5-video-embed] video").click(function(){this.play()})}function c(){if(FlashDetect.installed){var g;a('[data-posterous-scribd-embed="false"]').each(function(e){a(this).attr("id","posterous_scribd_embed_"+
e);g=scribd.Document.getDocFromUrl(a(this).attr("data-posterous-url"),"pub-50214570658991172461");g.addParam("height",600);g.addParam("width",500);g.addParam("public",false);g.addParam("disable_print",1);g.addParam("download_formats","");g.addParam("disable_related_docs",1);g.addParam("hide_disabled_buttons",1);g.addParam("my_user_id",a(this).attr("data-posterous-user-id"));g.write("posterous_scribd_embed_"+e);a(this).attr("data-posterous-scribd-embed","true")})}}function d(){a('[data-posterous-image-gallery][data-posterous-image-gallery-initialized="false"]').each(function(){new PSlideGallery2(a(this).get()[0],
a.parseJSON(unescape(a(this).attr("data-posterous-file-list"))),a.parseJSON(unescape(a(this).attr("data-posterous-options"))));a(this).attr("data-posterous-image-gallery-initialized","true")})}return{init:function(){b();if(FlashDetect.installed){a("[data-posterous-flash-audio-embed]").show();a("[data-posterous-html5-audio-embed]").hide()}else{a("[data-posterous-flash-audio-embed]").hide();a("[data-posterous-html5-audio-embed]").show()}c();d()}}},contentParts=ContentParts(jQuery);$j(document).ready(function(){contentParts.init()});
var handlebars=function(){var a={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,hashSegments:29,hashSegment:30,ID:31,EQUALS:32,pathSegments:33,SEP:34,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",
14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",31:"ID",32:"EQUALS",34:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[26,1],[29,2],[29,1],[30,3],[30,3],[21,1],[33,3],[33,1]],performAction:function(c,d,g,e,j,k){c=k.length-1;switch(j){case 1:return k[c-
1];case 2:this.$=new e.ProgramNode(k[c-2],k[c]);break;case 3:this.$=new e.ProgramNode(k[c]);break;case 4:this.$=new e.ProgramNode([]);break;case 5:this.$=[k[c]];break;case 6:k[c-1].push(k[c]);this.$=k[c-1];break;case 7:this.$=new e.InverseNode(k[c-2],k[c-1],k[c]);break;case 8:this.$=new e.BlockNode(k[c-2],k[c-1],k[c]);break;case 9:this.$=k[c];break;case 10:this.$=k[c];break;case 11:this.$=new e.ContentNode(k[c]);break;case 12:this.$=new e.CommentNode(k[c]);break;case 13:this.$=new e.MustacheNode(k[c-
1][0],k[c-1][1]);break;case 14:this.$=new e.MustacheNode(k[c-1][0],k[c-1][1]);break;case 15:this.$=k[c-1];break;case 16:this.$=new e.MustacheNode(k[c-1][0],k[c-1][1]);break;case 17:this.$=new e.MustacheNode(k[c-1][0],k[c-1][1],true);break;case 18:this.$=new e.PartialNode(k[c-1]);break;case 19:this.$=new e.PartialNode(k[c-2],k[c-1]);break;case 21:this.$=[[k[c-2]].concat(k[c-1]),k[c]];break;case 22:this.$=[[k[c-1]].concat(k[c]),null];break;case 23:this.$=[[k[c-1]],k[c]];break;case 24:this.$=[[k[c]],
null];break;case 25:k[c-1].push(k[c]);this.$=k[c-1];break;case 26:this.$=[k[c]];break;case 27:this.$=k[c];break;case 28:this.$=new e.StringNode(k[c]);break;case 29:this.$=new e.HashNode(k[c]);break;case 30:k[c-1].push(k[c]);this.$=k[c-1];break;case 31:this.$=[k[c]];break;case 32:this.$=[k[c-2],k[c]];break;case 33:this.$=[k[c-2],new e.StringNode(k[c])];break;case 34:this.$=new e.IdNode(k[c]);break;case 35:k[c-2].push(k[c]);this.$=k[c-2];break;case 36:this.$=[k[c]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,
9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,
13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,31:[1,25],33:24},{17:26,21:23,31:[1,25],33:24},{17:27,21:23,31:[1,25],33:24},{17:28,21:23,31:[1,25],33:24},{21:29,
31:[1,25],33:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,31:[1,25],33:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,34],28:[2,34],31:[2,34],34:[1,44]},{18:[2,36],28:[2,36],31:[2,36],34:[2,36]},{18:[1,45]},{18:[1,46]},{18:[1,47]},{18:[1,48],
21:49,31:[1,25],33:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:50,31:[1,25],33:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:51,27:52,
28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,23]},{18:[2,26],28:[2,26],31:[2,26]},{18:[2,29],30:53,31:[1,54]},{18:[2,27],28:[2,27],31:[2,27]},{18:[2,28],28:[2,28],31:[2,28]},{18:[2,31],31:[2,31]},{18:[2,36],28:[2,36],31:[2,36],32:[1,55],34:[2,36]},{31:[1,56]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],
23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,57]},{18:[1,58]},{18:[2,21]},{18:[2,25],28:[2,25],31:[2,25]},{18:[2,30],31:[2,30]},{32:[1,55]},{21:59,28:[1,60],31:[1,25],33:24},{18:[2,35],28:[2,35],31:[2,35],34:[2,35]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,32],31:[2,32]},{18:[2,
33],31:[2,33]}],defaultActions:{16:[2,1],37:[2,23],51:[2,21]},parseError:function(c){throw Error(c);},parse:function(c){function d(){var y;y=g.lexer.lex()||1;if(typeof y!=="number")y=g.symbols_[y]||y;return y}var g=this,e=[0],j=[null],k=[],m=this.table,q="",w=0,u=0,r=0;this.lexer.setInput(c);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;c=this.lexer.yylloc;k.push(c);if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;for(var v,h,l,n,o={},t,x;;){l=e[e.length-1];if(this.defaultActions[l])n=
this.defaultActions[l];else{if(v==null)v=d();n=m[l]&&m[l][v]}if(typeof n==="undefined"||!n.length||!n[0]){if(!r){h=[];for(t in m[l])this.terminals_[t]&&t>2&&h.push("'"+this.terminals_[t]+"'");var s="";s=this.lexer.showPosition?"Parse error on line "+(w+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+h.join(", "):"Parse error on line "+(w+1)+": Unexpected "+(v==1?"end of input":"'"+(this.terminals_[v]||v)+"'");this.parseError(s,{text:this.lexer.match,token:this.terminals_[v]||v,line:this.lexer.yylineno,
loc:c,expected:h})}if(r==3){if(v==1)throw Error(s||"Parsing halted.");u=this.lexer.yyleng;q=this.lexer.yytext;w=this.lexer.yylineno;c=this.lexer.yylloc;v=d()}for(;;){if((2).toString()in m[l])break;if(l==0)throw Error(s||"Parsing halted.");e.length-=2;j.length-=1;k.length-=1;l=e[e.length-1]}h=v;v=2;l=e[e.length-1];n=m[l]&&m[l][2];r=3}if(n[0]instanceof Array&&n.length>1)throw Error("Parse Error: multiple actions possible at state: "+l+", token: "+v);switch(n[0]){case 1:e.push(v);j.push(this.lexer.yytext);
k.push(this.lexer.yylloc);e.push(n[1]);v=null;if(h){v=h;h=null}else{u=this.lexer.yyleng;q=this.lexer.yytext;w=this.lexer.yylineno;c=this.lexer.yylloc;r>0&&r--}break;case 2:x=this.productions_[n[1]][1];o.$=j[j.length-x];o._$={first_line:k[k.length-(x||1)].first_line,last_line:k[k.length-1].last_line,first_column:k[k.length-(x||1)].first_column,last_column:k[k.length-1].last_column};l=this.performAction.call(o,q,u,w,this.yy,n[1],j,k);if(typeof l!=="undefined")return l;if(x){e=e.slice(0,-1*x*2);j=j.slice(0,
-1*x);k=k.slice(0,-1*x)}e.push(this.productions_[n[1]][0]);j.push(o.$);k.push(o._$);n=m[e[e.length-2]][e[e.length-1]];e.push(n);break;case 3:return true}}return true}},b=function(){var c={EOF:1,parseError:function(d,g){if(this.yy.parseError)this.yy.parseError(d,g);else throw Error(d);},setInput:function(d){this._input=d;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,
last_column:0};return this},input:function(){var d=this._input[0];this.yytext+=d;this.yyleng++;this.match+=d;this.matched+=d;d.match(/\n/)&&this.yylineno++;this._input=this._input.slice(1);return d},unput:function(d){this._input=d+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var d=this.matched.substr(0,this.matched.length-this.match.length);return(d.length>20?"...":"")+d.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var d=this.match;if(d.length<
20)d+=this._input.substr(0,20-d.length);return(d.substr(0,20)+(d.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var d=this.pastInput(),g=Array(d.length+1).join("-");return d+this.upcomingInput()+"\n"+g+"^"},next:function(){if(this.done)return this.EOF;if(!this._input)this.done=true;var d,g;if(!this._more)this.match=this.yytext="";for(var e=this._currentRules(),j=0;j<e.length;j++)if(d=this._input.match(this.rules[e[j]])){if(g=d[0].match(/\n.*/g))this.yylineno+=g.length;this.yylloc=
{first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:g?g[g.length-1].length-1:this.yylloc.last_column+d.length};this.yytext+=d[0];this.match+=d[0];this.matches=d;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(d[0].length);this.matched+=d[0];if(d=this.performAction.call(this,this.yy,this,e[j],this.conditionStack[this.conditionStack.length-1]))return d;else return}if(this._input==="")return this.EOF;else this.parseError("Lexical error on line "+
(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var d=this.next();return typeof d!=="undefined"?d:this.lex()},begin:function(d){this.conditionStack.push(d)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}};c.performAction=function(d,g,e){switch(e){case 0:this.begin("mu");if(g.yytext)return 14;break;case 1:return 14;
case 2:return 24;case 3:return 16;case 4:return 20;case 5:return 19;case 6:return 19;case 7:return 23;case 8:return 23;case 9:g.yytext=g.yytext.substr(3,g.yyleng-5);this.begin("INITIAL");return 15;case 10:return 22;case 11:return 32;case 12:return 31;case 13:return 31;case 14:return 34;case 16:this.begin("INITIAL");return 18;case 17:this.begin("INITIAL");return 18;case 18:g.yytext=g.yytext.substr(1,g.yyleng-2).replace(/\\"/g,'"');return 28;case 19:return 31;case 20:return"INVALID";case 21:return 5}};
c.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{!.*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^[a-zA-Z0-9_]+(?=[=} /.])/,/^./,/^$/];c.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],inclusive:false},INITIAL:{rules:[0,1,21],inclusive:true}};return c}();a.lexer=b;return a}();
if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=handlebars;exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)};exports.main=function(a){if(!a[1])throw Error("Usage: "+a[0]+" FILE");a=typeof process!=="undefined"?require("fs").readFileSync(require("path").join(process.cwd(),a[1]),"utf8"):require("file").path(require("file").cwd()).join(a[1]).read({charset:"utf-8"});return exports.parser.parse(a)};if(typeof module!=="undefined"&&require.main===
module)exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args)}var Handlebars={};Handlebars.Parser=handlebars;Handlebars.parse=function(a){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(a)};Handlebars.print=function(a){return(new Handlebars.PrintVisitor).accept(a)};Handlebars.Runtime={};
Handlebars.Runtime.compile=function(a){var b=Handlebars.parse(a);return function(c,d,g){d=d||Handlebars.helpers;g=g||Handlebars.partials;c=new Handlebars.Context(c,d,g);c=new Handlebars.Runtime(c);c.accept(b);return c.buffer}};Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(a,b,c){if(c)b.not=c;this.helpers[a]=b};Handlebars.registerPartial=function(a,b){this.partials[a]=b};
Handlebars.registerHelper("blockHelperMissing",function(a,b,c){c=c||function(){};var d="",g=Object.prototype.toString.call(a);if(g==="[object Function]")a=a();if(a===true)return b(this);else if(a===false||a==null)return c(this);else if(g==="[object Array]"){if(a.length>0){c=0;for(g=a.length;c<g;c++)d+=b(a[c])}else d=c(this);return d}else return b(a)},function(a,b){return b(a)});
Handlebars.registerHelper("each",function(a,b,c){var d="";if(a&&a.length>0){c=0;for(var g=a.length;c<g;c++)d+=b(a[c])}else d=c(this);return d});Handlebars.registerHelper("if",function(a,b,c){return!a||a==[]?c(this):b(this)});Handlebars.registerHelper("unless",function(a,b,c){return Handlebars.helpers["if"].call(this,a,c,b)});Handlebars.registerHelper("with",function(a,b){return b(a)});Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}};
Handlebars.log=function(a,b){Handlebars.logger.log(a,b)};
(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(b,c){this.type="program";this.statements=b;if(c)this.inverse=new Handlebars.AST.ProgramNode(c)};Handlebars.AST.MustacheNode=function(b,c,d){this.type="mustache";this.id=b[0];this.params=b.slice(1);this.hash=c;this.escaped=!d};Handlebars.AST.PartialNode=function(b,c){this.type="partial";this.id=b;this.context=c};var a=function(b,c){if(b.original!==c.original)throw new Handlebars.Exception(b.original+" doesn't match "+c.original);};Handlebars.AST.BlockNode=
function(b,c,d){a(b.id,d);this.type="block";this.mustache=b;this.program=c};Handlebars.AST.InverseNode=function(b,c,d){a(b.id,d);this.type="inverse";this.mustache=b;this.program=c};Handlebars.AST.ContentNode=function(b){this.type="content";this.string=b};Handlebars.AST.HashNode=function(b){this.type="hash";this.pairs=b};Handlebars.AST.IdNode=function(b){this.type="ID";this.original=b.join("/");for(var c=[],d=0,g=0,e=b.length;g<e;g++){var j=b[g];if(j==="..")d++;else j==="."||j==="this"||c.push(j)}this.parts=
c;this.depth=d;this.isSimple=c.length===1&&d===0};Handlebars.AST.StringNode=function(b){this.type="STRING";this.string=b};Handlebars.AST.CommentNode=function(b){this.type="comment";this.comment=b}})();Handlebars.Visitor=function(){};Handlebars.Visitor.prototype={accept:function(a){return this[a.type](a)}};Handlebars.Exception=function(a){this.message=a};Handlebars.SafeString=function(a){this.string=a};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};
(function(){var a={"<":"&lt;",">":"&gt;"},b=/&(?!\w+;)|[<>]/g,c=/[&<>]/,d=function(g){return a[g]||"&amp;"};Handlebars.Utils={escapeExpression:function(g){if(g instanceof Handlebars.SafeString)return g.toString();else if(g==null||g===false)return"";if(!c.test(g))return g;return g.replace(b,d)},isEmpty:function(g){return typeof g==="undefined"?true:g===null?true:g===false?true:Object.prototype.toString.call(g)==="[object Array]"&&g.length===0?true:false}}})();Handlebars.Compiler=function(){};
Handlebars.JavaScriptCompiler=function(){};
(function(a,b){a.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,invokeInverse:14,assignToHash:15};a.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:1,lookup:1,invokeMustache:2,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:2,invokePartial:1,push:1,invokeInverse:1,assignToHash:1};a.DISASSEMBLE_MAP={};
for(var c in a.OPCODE_MAP)a.DISASSEMBLE_MAP[a.OPCODE_MAP[c]]=c;a.multiParamSize=function(e){return a.MULTI_PARAM_OPCODES[a.DISASSEMBLE_MAP[e]]};a.prototype={disassemble:function(){for(var e=this.opcodes,j,k=[],m,q=0,w=e.length;q<w;q++){j=e[q];if(j==="DECLARE"){m=e[++q];j=e[++q];k.push("DECLARE "+m+" = "+j)}else{m=a.DISASSEMBLE_MAP[j];for(var u=a.multiParamSize(j),r=[],v=0;v<u;v++){j=e[++q];if(typeof j==="string")j='"'+j.replace("\n","\\n")+'"';r.push(j)}m=m+" "+r.join(" ");k.push(m)}}return k.join("\n")},
guid:0,compile:function(e){this.children=[];this.depths={list:[]};return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){e=e.statements;var j;this.opcodes=[];for(var k=0,m=e.length;k<m;k++){j=e[k];this[j.type](j)}this.depths.list=this.depths.list.sort(function(q,w){return q-w});return this},compileProgram:function(e){e=(new a).compile(e);var j=this.guid++;this.usePartial=this.usePartial||e.usePartial;this.children[j]=e;for(var k=0,m=e.depths.list.length;k<m;k++){depth=
e.depths.list[k];depth<2||this.addDepth(depth-1)}return j},block:function(e){var j=this.setupStackForMustache(e.mustache),k=this.compileProgram(e.program);if(e.program.inverse){e=this.compileProgram(e.program.inverse);this.declare("inverse",e)}this.opcode("invokeProgram",k,j.length);this.declare("inverse",null);this.opcode("append")},inverse:function(e){this.ID(e.mustache.id);this.opcode("invokeInverse",this.compileProgram(e.program));this.opcode("append")},hash:function(e){e=e.pairs;var j,k;this.opcode("push",
"{}");for(var m=0,q=e.length;m<q;m++){j=e[m];k=j[1];this.accept(k);this.opcode("assignToHash",j[0])}},partial:function(e){var j=e.id;this.usePartial=true;e.context?this.ID(e.context):this.opcode("push","context");this.opcode("invokePartial",j.original);this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){this.opcode("invokeMustache",this.setupStackForMustache(e).length,e.id.original);e.escaped?this.opcode("appendEscaped"):this.opcode("append")},ID:function(e){this.addDepth(e.depth);
this.opcode("getContext",e.depth);this.opcode("lookupWithHelpers",e.parts[0]||null);for(var j=1,k=e.parts.length;j<k;j++)this.opcode("lookup",e.parts[j])},STRING:function(e){this.opcode("pushString",e.string)},comment:function(){},pushParams:function(e){for(var j=e.length,k;j--;){k=e[j];this[k.type](k)}},opcode:function(e,j,k){this.opcodes.push(a.OPCODE_MAP[e]);j!==undefined&&this.opcodes.push(j);k!==undefined&&this.opcodes.push(k)},declare:function(e,j){this.opcodes.push("DECLARE");this.opcodes.push(e);
this.opcodes.push(j)},addDepth:function(e){if(e!==0)if(!this.depths[e]){this.depths[e]=true;this.depths.list.push(e)}},setupStackForMustache:function(e){var j=e.params;this.pushParams(j);e.hash?this.hash(e.hash):this.opcode("push","{}");this.ID(e.id);return j}};b.prototype={nameLookup:function(e,j){return b.RESERVED_WORDS[j]?e+"['"+j+"']":e+"."+j},appendToBuffer:function(e){return"buffer = buffer + "+e+";"},initializeBuffer:function(){return this.quotedString("")},compile:function(e,j){this.environment=
e;this.data=j;this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileChildren(e,j);Handlebars.log(Handlebars.logger.DEBUG,e.disassemble()+"\n\n");var k=e.opcodes;this.i=0;for(g=k.length;this.i<g;this.i++){k=this.nextOpcode(0);if(k[0]==="DECLARE"){this.i+=2;this[k[1]]=k[2]}else{this.i+=k[1].length;this[k[0]].apply(this,k[1])}}return this.createFunction()},nextOpcode:function(e){var j=this.environment.opcodes,k=j[this.i+e],m,q;if(k==="DECLARE"){m=j[this.i+1];e=j[this.i+
2];return["DECLARE",m,e]}else{m=a.DISASSEMBLE_MAP[k];k=a.multiParamSize(k);q=[];for(var w=0;w<k;w++)q.push(j[this.i+w+1+e]);return[m,q]}},eat:function(e){this.i+=e.length},preamble:function(){var e=[];e.push("var buffer = "+this.initializeBuffer()+", currentContext = context");var j="helpers = helpers || Handlebars.helpers;";if(this.environment.usePartial)j+=" partials = partials || Handlebars.partials;";e.push(j);this.lastContext=0;this.source=e},createFunction:function(){var e={escapeExpression:Handlebars.Utils.escapeExpression,
invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(q,w,u,r){var v=this.programs[q];if(r)return Handlebars.VM.program(this.children[q],w,u,r);else{v||(v=this.programs[q]=Handlebars.VM.program(this.children[q],w,u));return v}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop},j=this.stackVars.concat(this.registers.list);if(j.length>0)this.source[0]=this.source[0]+", "+j.join(", ");this.source[0]+=";";this.source.push("return buffer;");j=["Handlebars","context",
"helpers","partials"];this.data&&j.push("data");for(var k=0,m=this.environment.depths.list.length;k<m;k++)j.push("depth"+this.environment.depths.list[k]);j.length===4&&!this.environment.usePartial&&j.pop();j.push(this.source.join("\n"));j=Function.apply(this,j);j.displayName="Handlebars.js";Handlebars.log(Handlebars.logger.DEBUG,j.toString()+"\n\n");e.render=j;e.children=this.environment.children;return function(){try{var q=Array.prototype.slice.call(arguments);q.unshift(Handlebars);return e.render.apply(e,
q)}catch(w){throw w;}}},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }")},appendEscaped:function(){var e=this.nextOpcode(1),j="";if(e[0]==="appendContent"){j=" + "+this.quotedString(e[1][0]);this.eat(e)}this.source.push(this.appendToBuffer("this.escapeExpression("+this.popStack()+")"+j))},getContext:function(e){if(this.lastContext!==e){this.lastContext=
e;e===0?this.source.push("currentContext = context;"):this.source.push("currentContext = depth"+e+";")}},lookupWithHelpers:function(e){if(e){var j=this.nextStack();this.source.push("if('"+e+"' in helpers) { "+j+" = "+this.nameLookup("helpers",e,"helper")+"; } else { "+j+" = "+this.nameLookup("currentContext",e,"context")+"; }")}else this.pushStack("currentContext")},lookup:function(e){var j=this.topStack();this.source.push(j+" = "+this.nameLookup(j,e,"context")+";")},pushString:function(e){this.pushStack(this.quotedString(e))},
push:function(e){this.pushStack(e)},invokeMustache:function(e,j){this.populateParams(e,this.quotedString(j),"{}",null,function(k,m,q){this.source.push("else if("+q+"=== undefined) { "+k+" = helpers.helperMissing.call("+m+"); }");this.source.push("else { "+k+" = "+q+"; }")})},invokeProgram:function(e,j){var k=this.programExpression(this.inverse),m=this.programExpression(e);this.populateParams(j,null,m,k,function(q,w){this.source.push("else { "+q+" = helpers.blockHelperMissing.call("+w+"); }")})},populateParams:function(e,
j,k,m,q){for(var w=this.popStack(),u=[],r=this.popStack(),v=0;v<e;v++){var h=this.popStack();u.push(h)}this.register("tmp1",k);this.source.push("tmp1.hash = "+r+";");if(m){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+m+";")}this.data&&this.source.push("tmp1.data = data;");u.push("tmp1");m&&u.push(m);this.populateCall(u,w,j||w,q)},populateCall:function(e,j,k,m){var q=["context"].concat(e).join(", ");e=["context"].concat(k).concat(e).join(", ");nextStack=this.nextStack();this.source.push("if(typeof "+
j+" === 'function') { "+nextStack+" = "+j+".call("+q+"); }");m.call(this,nextStack,e,j)},invokeInverse:function(e){e=this.programExpression(e);this.pushStack("helpers.blockHelperMissing.call("+["context",this.topStack(),"this.noop",e].join(", ")+")")},invokePartial:function(e){this.pushStack("this.invokePartial("+this.nameLookup("partials",e,"partial")+", '"+e+"', "+this.popStack()+", helpers, partials);")},assignToHash:function(e){var j=this.popStack();this.source.push(this.topStack()+"['"+e+"'] = "+
j+";")},compiler:b,compileChildren:function(e,j){for(var k=e.children,m,q,w=[],u=0,r=k.length;u<r;u++){m=k[u];q=new this.compiler;w[u]=q.compile(m,j)}e.rawChildren=k;e.children=w},programExpression:function(e){if(e==null)return"this.noop";var j=[e,"helpers","partials"],k=this.environment.rawChildren[e].depths.list;this.data&&j.push("data");for(var m=0,q=k.length;m<q;m++){depth=k[m];depth===1?j.push("context"):j.push("depth"+(depth-1))}if(!this.environment.usePartial)if(j[3])j[2]="null";else j.pop();
if(k.length===0)return"this.program("+j.join(", ")+")";else{j[0]="this.children["+e+"]";return"this.programWithDepth("+j.join(", ")+")"}},register:function(e,j){this.useRegister(e);this.source.push(e+" = "+j+";")},useRegister:function(e){if(!this.registers[e]){this.registers[e]=true;this.registers.list.push(e)}},pushStack:function(e){this.source.push(this.nextStack()+" = "+e+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+
this.stackSlot);return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(e){return'"'+e.replace(/\\/,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};c="break case catch continue default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with null true false".split(" ");compilerWords=b.RESERVED_WORDS={};for(var d=0,g=c.length;d<
g;d++)compilerWords[c[d]]=true})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);
Handlebars.VM={programWithDepth:function(a){var b=Array.prototype.slice.call(arguments,1);return function(c,d,g,e){b[0]=d||b[0];b[1]=g||b[1];b[2]=e||b[2];return a.apply(this,[c].concat(b))}},program:function(a,b,c,d){return function(g,e,j,k){return a(g,e||b,j||c,k||d)}},noop:function(){return""},compile:function(a,b){var c=Handlebars.parse(a);c=(new Handlebars.Compiler).compile(c);return(new Handlebars.JavaScriptCompiler).compile(c,b)},invokePartial:function(a,b,c,d,g){if(a===undefined)throw new Handlebars.Exception("The partial "+
b+" could not be found");else if(a instanceof Function)return a(c,d,g);else{g[b]=Handlebars.VM.compile(a);return g[b](c,d,g)}}};Handlebars.compile=Handlebars.VM.compile;
(function(a){a.Class.extend("Modal",{openModals:[],currentModal:function(){return this.openModals.length?this.openModals[0]:null}},{init:function(b){this.link=b;this.url=this.link.attr("href");b=a(document).scrollTop()+200;this.modal=a("body").append(Modal.template({})).find('[data-posterous-modal-container="true"]').last().get();a(this.modal).css({"padding-top":b});a.jsonp({url:this.url,data:{format:"modal"},success:a.proxy(this.onSuccess,this),error:a.proxy(this.onError,this)});a(this.modal).click(a.proxy(this.closeUnlessClickedInsideWindow,
this))},showLoader:function(){a(this.modal).find(".p_modal_contents").css({visibility:"hidden"});a(this.modal).find(".p_modal_loading").show()},hideLoader:function(){a(this.modal).find(".p_modal_loading").hide();a(this.modal).find(".p_modal_contents").css({visibility:"visible"})},closeUnlessClickedInsideWindow:function(b){if(b.target==b.currentTarget||a(b.target).closest(".p_modal_close").length){b.preventDefault();this.close()}},onSuccess:function(b){a(this.modal).find(".p_modal_title h1").text(unescape(b.title));
var c=a(unescape(b.contents)).hide().appendTo(a(this.modal).find(".p_modal_contents"));b=c.outerWidth()+40;var d=c.outerHeight()+47+40;a(this.modal).find(".p_modal_inner").animate({width:b+"px",height:d+"px"},{complete:a.proxy(function(){this.hideLoader();c.show();this.link.triggerHandler("modal:success",this);a(this.modal).find(".p_modal_inner").css({height:"auto"})},this)})},onError:function(){this.hideLoader();a(this.modal).find(".p_modal_contents").html('Something went wrong. Please try again, or email us at <a href="mailto:help@posterous.com">help@posterous.com.</a>');
this.link.trigger("modal:failure")},close:function(){var b=a.inArray(this,this.Class.openModals);b!=-1&&this.Class.openModals.splice(b,1);a(this.modal).hide().remove()}});a(function(){a.get("/javascripts/views/modal.html.handlebars",function(b){Modal.template=Handlebars.compile(b)});a("body").delegate('a[data-posterous-modal="true"]',"click",function(b){b.preventDefault();Modal.openModals.push(new Modal(a(this)))})})})(jQuery);
(function(a){a.Class.extend("Map",{maps:[]},{init:function(b){this.mapDiv=a(b);b={zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMAL},mapTypeControl:false,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,size:new google.maps.Size(300,150)};var c=a.parseJSON(this.mapDiv.attr("data-posterous-lat-lngs"));if(c.length!=0){c=a.map(c,function(d){return new google.maps.LatLng(parseFloat(d[0]),parseFloat(d[1]))});this.bounds=new google.maps.LatLngBounds;this.googleMap=
new google.maps.Map(document.getElementById(this.mapDiv.attr("id")),b);for(i=0;i<c.length;i++){new google.maps.Marker({position:c[i],map:this.googleMap});this.bounds.extend(c[i])}this.googleMap.fitBounds(this.bounds);this.googleMap.zoom!=undefined&&this.resize()}},resize:function(){google.maps.event.trigger(this.googleMap,"resize");this.googleMap.fitBounds(this.bounds);this.googleMap.setZoom(Math.min(this.googleMap.zoom,parseInt(this.mapDiv.attr("data-posterous-max-zoom"),10)))}});a(function(){a('[data-posterous-map="true"]').each(function(){a(this).attr("id",
"map_"+Math.floor(Math.random()*1E3));Map.maps.push(new Map(a(this)));a("body").bind("show-on-click:finished",function(){a.each(Map.maps,function(b,c){c.resize()})})})})})(jQuery);
(function(a,b){var c,d=/:([\w\d]+)/g,g=/\?([^#]*)$/,e=function(h){return Array.prototype.slice.call(h)},j=function(h){return Object.prototype.toString.call(h)==="[object Function]"},k=function(h){return Object.prototype.toString.call(h)==="[object Array]"},m=decodeURIComponent,q=encodeURIComponent,w=function(h){return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},u=function(h){return function(l,n){return this.route.apply(this,[h,l,n])}},r={},v=[];c=function(){var h=e(arguments),
l,n;c.apps=c.apps||{};if(h.length===0||h[0]&&j(h[0]))return c.apply(c,["body"].concat(h));else if(typeof(n=h.shift())=="string"){l=c.apps[n]||new c.Application;l.element_selector=n;h.length>0&&a.each(h,function(o,t){l.use(t)});l.element_selector!=n&&delete c.apps[n];return c.apps[l.element_selector]=l}};c.VERSION="0.6.2";c.addLogger=function(h){v.push(h)};c.log=function(){var h=e(arguments);h.unshift("["+Date()+"]");a.each(v,function(l,n){n.apply(c,h)})};if(typeof b.console!="undefined")j(b.console.log.apply)?
c.addLogger(function(){b.console.log.apply(b.console,arguments)}):c.addLogger(function(){b.console.log(arguments)});else typeof console!="undefined"&&c.addLogger(function(){console.log.apply(console,arguments)});a.extend(c,{makeArray:e,isFunction:j,isArray:k});c.Object=function(h){return a.extend(this,h||{})};a.extend(c.Object.prototype,{escapeHTML:w,h:w,toHash:function(){var h={};a.each(this,function(l,n){j(n)||(h[l]=n)});return h},toHTML:function(){var h="";a.each(this,function(l,n){j(n)||(h+="<strong>"+
l+"</strong> "+n+"<br />")});return h},keys:function(h){var l=[],n;for(n in this)if(!j(this[n])||!h)l.push(n);return l},has:function(h){return this[h]&&a.trim(this[h].toString())!=""},join:function(){var h=e(arguments),l=h.shift();return h.join(l)},log:function(){c.log.apply(c,arguments)},toString:function(h){var l=[];a.each(this,function(n,o){if(!j(o)||h)l.push('"'+n+'": '+o.toString())});return"Sammy.Object: {"+l.join(",")+"}"}});c.HashLocationProxy=function(h,l){this.app=h;this.is_native=false;
this._startPolling(l)};c.HashLocationProxy.prototype={bind:function(){var h=this,l=this.app;a(b).bind("hashchange."+this.app.eventNamespace(),function(n,o){if(h.is_native===false&&!o){c.log("native hash change exists, using");h.is_native=true;b.clearInterval(c.HashLocationProxy._interval)}l.trigger("location-changed")});if(!c.HashLocationProxy._bindings)c.HashLocationProxy._bindings=0;c.HashLocationProxy._bindings++},unbind:function(){a(b).unbind("hashchange."+this.app.eventNamespace());c.HashLocationProxy._bindings--;
c.HashLocationProxy._bindings<=0&&b.clearInterval(c.HashLocationProxy._interval)},getLocation:function(){var h=b.location.toString().match(/^[^#]*(#.+)$/);return h?h[1]:""},setLocation:function(h){return b.location=h},_startPolling:function(h){var l=this;if(!c.HashLocationProxy._interval){h||(h=10);var n=function(){var o=l.getLocation();if(!c.HashLocationProxy._last_location||o!=c.HashLocationProxy._last_location)b.setTimeout(function(){a(b).trigger("hashchange",[true])},13);c.HashLocationProxy._last_location=
o};n();c.HashLocationProxy._interval=b.setInterval(n,h)}}};c.Application=function(h){var l=this;this.routes={};this.listeners=new c.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1E3,10);this.context_prototype=function(){c.EventContext.apply(this,arguments)};this.context_prototype.prototype=new c.EventContext;j(h)&&h.apply(this,[this]);this._location_proxy||this.setLocationProxy(new c.HashLocationProxy(this,this.run_interval_every));this.debug&&
this.bindToAllEvents(function(n,o){l.log(l.toString(),n.cleaned_type,o||{})})};c.Application.prototype=a.extend({},c.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:false,element_selector:"body",debug:false,raise_errors:false,run_interval_every:50,template_engine:null,
toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(h){return h?a(this.element_selector).find(h):a(this.element_selector)},use:function(){var h=e(arguments),l=h.shift(),n=l||"";try{h.unshift(this);if(typeof l=="string"){n="Sammy."+l;l=c[l]}l.apply(this,h)}catch(o){if(typeof l==="undefined")this.error("Plugin Error: called use() but plugin ("+n.toString()+") is not defined",o);else j(l)?this.error("Plugin Error",o):this.error("Plugin Error: called use() but '"+n.toString()+
"' is not a function",o)}return this},setLocationProxy:function(h){var l=this._location_proxy;this._location_proxy=h;if(this.isRunning()){l&&l.unbind();this._location_proxy.bind()}},route:function(h,l,n){var o=this,t=[],x,s;if(!n&&j(l)){n=l=h;h="any"}h=h.toLowerCase();if(l.constructor==String){for(d.lastIndex=0;(s=d.exec(l))!==null;)t.push(s[1]);l=RegExp("^"+l.replace(d,"([^/]+)")+"$")}if(typeof n=="string")n=o[n];x=function(y){var z={verb:y,path:l,callback:n,param_names:t};o.routes[y]=o.routes[y]||
[];o.routes[y].push(z)};h==="any"?a.each(this.ROUTE_VERBS,function(y,z){x(z)}):x(h);return this},get:u("get"),post:u("post"),put:u("put"),del:u("delete"),any:u("any"),mapRoutes:function(h){var l=this;a.each(h,function(n,o){l.route.apply(l,o)});return this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(h,l,n){var o=this;if(typeof n=="undefined")n=l;l=function(t,x){var s;if(x&&x.context){s=x.context;delete x.context}else s=new o.context_prototype(o,"bind",t.type,
x,t.target);t.cleaned_type=t.type.replace(o.eventNamespace(),"");n.apply(s,[t,x])};this.listeners[h]||(this.listeners[h]=[]);this.listeners[h].push(l);this.isRunning()&&this._listen(h,l);return this},trigger:function(h,l){this.$element().trigger([h,this.eventNamespace()].join("."),[l]);return this},refresh:function(){this.last_location=null;this.trigger("location-changed");return this},before:function(h,l){if(j(h)){l=h;h={}}this.befores.push([h,l]);return this},after:function(h){return this.bind("event-context-after",
h)},around:function(h){this.arounds.push(h);return this},isRunning:function(){return this._running},helpers:function(h){a.extend(this.context_prototype.prototype,h);return this},helper:function(h,l){this.context_prototype.prototype[h]=l;return this},run:function(h){if(this.isRunning())return false;var l=this;a.each(this.listeners.toHash(),function(n,o){a.each(o,function(t,x){l._listen(n,x)})});this.trigger("run",{start_url:h});this._running=true;this.last_location=null;this.getLocation()==""&&typeof h!=
"undefined"&&this.setLocation(h);this._checkLocation();this._location_proxy.bind();this.bind("location-changed",function(){l._checkLocation()});this.bind("submit",function(n){return l._checkFormSubmission(a(n.target).closest("form"))===false?n.preventDefault():false});a(b).bind("beforeunload",function(){l.unload()});return this.trigger("changed")},unload:function(){if(!this.isRunning())return false;var h=this;this.trigger("unload");this._location_proxy.unbind();this.$element().unbind("submit").removeClass(h.eventNamespace());
a.each(this.listeners.toHash(),function(l,n){a.each(n,function(o,t){h._unlisten(l,t)})});this._running=false;return this},bindToAllEvents:function(h){var l=this;a.each(this.APP_EVENTS,function(n,o){l.bind(o,h)});a.each(this.listeners.keys(true),function(n,o){l.APP_EVENTS.indexOf(o)==-1&&l.bind(o,h)});return this},routablePath:function(h){return h.replace(g,"")},lookupRoute:function(h,l){var n=this,o=false;this.trigger("lookup-route",{verb:h,path:l});typeof this.routes[h]!="undefined"&&a.each(this.routes[h],
function(t,x){if(n.routablePath(l).match(x.path)){o=x;return false}});return o},runRoute:function(h,l,n,o){var t=this,x=this.lookupRoute(h,l),s,y,z,A,E,D,F;this.log("runRoute",[h,l].join(" "));this.trigger("run-route",{verb:h,path:l,params:n});if(typeof n=="undefined")n={};a.extend(n,this._parseQueryString(l));if(x){this.trigger("route-found",{route:x});if((D=x.path.exec(this.routablePath(l)))!==null){D.shift();a.each(D,function(B,C){if(x.param_names[B])n[x.param_names[B]]=m(C);else{if(!n.splat)n.splat=
[];n.splat.push(m(C))}})}s=new this.context_prototype(this,h,l,n,o);o=this.arounds.slice(0);z=this.befores.slice(0);E=[s].concat(n.splat);y=function(){for(var B;z.length>0;){A=z.shift();if(t.contextMatchesOptions(s,A[0])){B=A[1].apply(s,[s]);if(B===false)return false}}t.last_route=x;s.trigger("event-context-before",{context:s});B=x.callback.apply(s,E);s.trigger("event-context-after",{context:s});return B};a.each(o.reverse(),function(B,C){var G=y;y=function(){return C.apply(s,[G])}});try{F=y()}catch(H){this.error(["500 Error",
h,l].join(" "),H)}return F}else return this.notFound(h,l)},contextMatchesOptions:function(h,l,n){l=l;if(typeof l==="undefined"||l=={})return true;if(typeof n==="undefined")n=true;if(typeof l==="string"||j(l.test))l={path:l};if(l.only)return this.contextMatchesOptions(h,l.only,true);else if(l.except)return this.contextMatchesOptions(h,l.except,false);var o=true,t=true;if(l.path)o=j(l.path.test)?l.path.test(h.path):l.path.toString()===h.path;if(l.verb)t=l.verb===h.verb;return n?t&&o:!(t&&o)},getLocation:function(){return this._location_proxy.getLocation()},
setLocation:function(h){return this._location_proxy.setLocation(h)},swap:function(h){return this.$element().html(h)},templateCache:function(h,l){return typeof l!="undefined"?r[h]=l:r[h]},clearTemplateCache:function(){return r={}},notFound:function(h,l){var n=this.error(["404 Not Found",h,l].join(" "));return h==="get"?n:true},error:function(h,l){l||(l=Error());l.message=[h,l.message].join(" ");this.trigger("error",{message:l.message,error:l});if(this.raise_errors)throw l;else this.log(l.message,l)},
_checkLocation:function(){var h,l;h=this.getLocation();if(!this.last_location||this.last_location[0]!="get"||this.last_location[1]!=h){this.last_location=["get",h];l=this.runRoute("get",h)}return l},_getFormVerb:function(h){h=a(h);var l,n;n=h.find('input[name="_method"]');if(n.length>0)l=n.val();l||(l=h[0].getAttribute("method"));return a.trim(l.toString().toLowerCase())},_checkFormSubmission:function(h){var l,n,o;this.trigger("check-form-submission",{form:h});l=a(h);n=l.attr("action");o=this._getFormVerb(l);
if(!o||o=="")o="get";this.log("_checkFormSubmission",l,n,o);if(o==="get"){this.setLocation(n+"?"+this._serializeFormParams(l));h=false}else{l=a.extend({},this._parseFormParams(l));h=this.runRoute(o,n,l,h.get(0))}return typeof h=="undefined"?false:h},_serializeFormParams:function(h){var l="";h=h.serializeArray();var n;if(h.length>0){l=this._encodeFormPair(h[0].name,h[0].value);for(n=1;n<h.length;n++)l=l+"&"+this._encodeFormPair(h[n].name,h[n].value)}return l},_encodeFormPair:function(h,l){return q(h)+
"="+q(l)},_parseFormParams:function(h){var l={};h=h.serializeArray();var n;for(n=0;n<h.length;n++)l=this._parseParamPair(l,h[n].name,h[n].value);return l},_parseQueryString:function(h){var l={},n,o;if(h=h.match(g)){h=h[1].split("&");for(o=0;o<h.length;o++){n=h[o].split("=");l=this._parseParamPair(l,m(n[0]),m(n[1]))}}return l},_parseParamPair:function(h,l,n){if(h[l])if(k(h[l]))h[l].push(n);else h[l]=[h[l],n];else h[l]=n;return h},_listen:function(h,l){return this.$element().bind([h,this.eventNamespace()].join("."),
l)},_unlisten:function(h,l){return this.$element().unbind([h,this.eventNamespace()].join("."),l)}});c.RenderContext=function(h){this.event_context=h;this.callbacks=[];this.content=this.previous_content=null;this.waiting=this.next_engine=false};c.RenderContext.prototype=a.extend({},c.Object.prototype,{then:function(h){if(!j(h))if(typeof h==="string"&&h in this.event_context){var l=this.event_context[h];h=function(o){return l.apply(this.event_context,[o])}}else return this;var n=this;if(this.waiting)this.callbacks.push(h);
else{this.wait();b.setTimeout(function(){var o=h.apply(n,[n.content,n.previous_content]);o!==false&&n.next(o)},13)}return this},wait:function(){this.waiting=true},next:function(h){this.waiting=false;if(typeof h!=="undefined"){this.previous_content=this.content;this.content=h}this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(h,l,n){var o=this;return this.then(function(){var t,x,s;if(j(l)){n=l;l={}}else l=a.extend({},l);n&&this.then(n);if(typeof h==="string"){t=(s=h.match(/\.json$/)||
l.json)&&l.cache===true||l.cache!==false;o.next_engine=o.event_context.engineFor(h);delete l.cache;delete l.json;if(l.engine){o.next_engine=l.engine;delete l.engine}if(t&&(x=this.event_context.app.templateCache(h)))return x;this.wait();a.ajax(a.extend({url:h,data:{},dataType:s?"json":null,type:"get",success:function(y){t&&o.event_context.app.templateCache(h,y);o.next(y)}},l));return false}else{if(h.nodeType)return h.innerHTML;if(h.selector){o.next_engine=h.attr("data-engine");return l.clone===false?
h.remove()[0].innerHTML.toString():h[0].innerHTML.toString()}}})},render:function(h,l,n){if(j(h)&&!l)return this.then(h);else{if(!l&&this.content)l=this.content;return this.load(h).interpolate(l,h).then(n)}},partial:function(h,l){return this.render(h,l).swap()},send:function(){var h=this,l=e(arguments),n=l.shift();if(k(l[0]))l=l[0];return this.then(function(){l.push(function(o){h.next(o)});h.wait();n.apply(n,l);return false})},collect:function(h,l,n){var o=this,t=function(){if(j(h)){l=h;h=this.content}var x=
[],s=false;a.each(h,function(y,z){var A=l.apply(o,[y,z]);if(A.jquery&&A.length==1){A=A[0];s=true}x.push(A);return A});return s?x:x.join("")};return n?t():this.then(t)},renderEach:function(h,l,n,o){if(k(l)){o=n;n=l;l=null}return this.load(h).then(function(t){var x=this;n||(n=k(this.previous_content)?this.previous_content:[]);if(o)a.each(n,function(s,y){var z={},A=this.next_engine||h;l?z[l]=y:z=y;o(y,x.event_context.interpolate(t,z,A))});else return this.collect(n,function(s,y){var z={},A=this.next_engine||
h;l?z[l]=y:z=y;return this.event_context.interpolate(t,z,A)},true)})},interpolate:function(h,l,n){var o=this;return this.then(function(t,x){if(!h&&x)h=x;if(this.next_engine){l=this.next_engine;this.next_engine=false}var s=o.event_context.interpolate(t,h,l);return n?x+s:s})},swap:function(){return this.then(function(h){this.event_context.swap(h)}).trigger("changed",{})},appendTo:function(h){return this.then(function(l){a(h).append(l)}).trigger("changed",{})},prependTo:function(h){return this.then(function(l){a(h).prepend(l)}).trigger("changed",
{})},replace:function(h){return this.then(function(l){a(h).html(l)}).trigger("changed",{})},trigger:function(h,l){return this.then(function(n){if(typeof l=="undefined")l={content:n};this.event_context.trigger(h,l)})}});c.EventContext=function(h,l,n,o,t){this.app=h;this.verb=l;this.path=n;this.params=new c.Object(o);this.target=t};c.EventContext.prototype=a.extend({},c.Object.prototype,{$element:function(){return this.app.$element(e(arguments).shift())},engineFor:function(h){var l;if(j(h))return h;
h=h.toString();if(l=h.match(/\.([^\.]+)$/))h=l[1];if(h&&j(this[h]))return this[h];if(this.app.template_engine)return this.engineFor(this.app.template_engine);return function(n){return n}},interpolate:function(h,l,n){return this.engineFor(n).apply(this,[h,l])},render:function(h,l,n){return(new c.RenderContext(this)).render(h,l,n)},renderEach:function(h,l,n,o){return(new c.RenderContext(this)).renderEach(h,l,n,o)},load:function(h,l,n){return(new c.RenderContext(this)).load(h,l,n)},partial:function(h,
l){return(new c.RenderContext(this)).partial(h,l)},send:function(){var h=new c.RenderContext(this);return h.send.apply(h,arguments)},redirect:function(){var h;h=e(arguments);var l=this.app.getLocation();if(h.length>1){h.unshift("/");h=this.join.apply(this,h)}else h=h[0];this.trigger("redirect",{to:h});this.app.last_location=[this.verb,this.path];this.app.setLocation(h);l==h&&this.app.trigger("location-changed")},trigger:function(h,l){if(typeof l=="undefined")l={};if(!l.context)l.context=this;return this.app.trigger(h,
l)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(h){return this.app.swap(h)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(h){return a.parseJSON(h)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}});a.sammy=b.Sammy=c})(jQuery,window);
(function(a){a.fn.swipe=function(b){var c={threshold:{x:30,y:10},swipeLeft:function(){alert("swiped left")},swipeRight:function(){alert("swiped right")}};b=a.extend(c,b);if(!this)return false;return this.each(function(){function d(j){g.x=j.targetTouches[0].pageX;g.y=j.targetTouches[0].pageY}function d(j){g.x=j.targetTouches[0].pageX;g.y=j.targetTouches[0].pageY;e.x=g.x;e.y=g.y}a(this);var g={x:0,y:0},e={x:0,y:0};this.addEventListener("touchstart",d,false);this.addEventListener("touchmove",function(j){j.preventDefault();
e.x=j.targetTouches[0].pageX;e.y=j.targetTouches[0].pageY},false);this.addEventListener("touchend",function(){var j=g.y-e.y;if(j<c.threshold.y&&j>c.threshold.y*-1){changeX=g.x-e.x;changeX>c.threshold.x&&c.swipeLeft();changeX<c.threshold.x*-1&&c.swipeRight()}},false);this.addEventListener("touchcancel",function(){},false)})}})(jQuery);$j(function(){slideshow.run();$j(".posterousHeaderActions a.slideshow").live("click",function(a){a.preventDefault();slideshow.setLocation("#!/slideshow")})});
var slideshow=$j.sammy(function(){this.get("#!/",function(){this.log("slideshows")});this.get("#!/slideshow",function(){if($j(".posterous_site_data").length>0)var a=$j(".posterous_site_data").first().attr("data-show-type"),b=$j(".posterous_site_data").first().attr("data-site-type"),c=$j(".posterous_site_data").first().attr("data-site-id"),d=$j(".posterous_site_data").first().attr("data-user-id"),g=$j(".posterous_site_data").first().attr("data-post-id");else{a=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||
window.show_type;b=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type;c=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id;d=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id;g=$j("body").attr("data-post-id")||window.post_id}if(b!="group")if($j("#whole_site").length==0){this.log("running sitewide");slides=new startSlideshow({show_type:a,site_type:b,post_id:g,site_id:c,user_id:d,image_list:null,current_image:null,
autoplay:true})}});this.get("#!/:slug/slideshow",function(){if($j(".posterous_site_data").length>0){$j(".posterous_site_data").first().attr("data-show-type");var a=$j(".posterous_site_data").first().attr("data-site-type");$j(".posterous_site_data").first().attr("data-site-id");$j(".posterous_site_data").first().attr("data-user-id");var b=$j(".posterous_site_data").first().attr("data-post-id")}else{$j("body").attr("data-show-type")||$j("body").attr("data-show_type");a=$j("body").attr("data-site-type")||
$j("body").attr("data-site_type")||window.site_type;$j("body").attr("data-site-id")||$j("body").attr("data-site_id");$j("body").attr("data-user-id")||$j("body").attr("data-admin_id");b=$j("body").attr("data-post-id")||window.post_id}if(a!="group")if(b!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked")){this.log("running post slides");this.redirect("/"+this.params.slug+"/#!/slideshow")}});this.get("#!/private/:slug/slideshow",function(){if($j(".posterous_site_data").length>
0){$j(".posterous_site_data").first().attr("data-show-type");var a=$j(".posterous_site_data").first().attr("data-site-type");$j(".posterous_site_data").first().attr("data-site-id");$j(".posterous_site_data").first().attr("data-user-id");var b=$j(".posterous_site_data").first().attr("data-post-id")}else{$j("body").attr("data-show-type")||$j("body").attr("data-show_type");a=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type;$j("body").attr("data-site-id")||$j("body").attr("data-site_id");
$j("body").attr("data-user-id")||$j("body").attr("data-admin_id");b=$j("body").attr("data-post-id")||window.post_id}if(a!="group")if(b!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked")){this.log("running post slides");this.redirect("/private/"+this.params.slug+"/#!/slideshow")}});this.get("#!/:slug",function(){this.log("route for "+this.params.slug)})});
Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7;Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;
var slideshowTimer,currentPages=[],currentPage=null,currentSlideLength=null,pageAttempts=0,image_post_ids=[],image_sources=[],slideCount=0,windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,startSlideshow=Class.create({initialize:function(a){this.show_type=a.show_type;this.site_type=a.site_type;this.current_image=a.current_image;
this.image_list=a.image_list;this.user_id=a.user_id;this.site_id=a.site_id;this.post_id=a.post_id;this.thread_id=a.thread_id;this.reply_ids=a.reply_ids;this.slug=a.slug;this.autoplay=a.autoplay;this.setupPostSlideshow();if(this.site_type!=undefined&&this.show_type=="thread"){$("this_thread").addClassName("clicked");setTimeout(function(){if(this.current_image!=null){this.insertThreadSlides();this.insertThreadReplySlides();this.startThreadSlides()}else{this.insertThreadSlides();this.insertThreadReplySlides()}this.setupSlideControls()}.bind(this),
1E3)}else if(this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")setTimeout(function(){this.insertSiteSlides();this.setupSlideControls()}.bind(this),1E3);else if(this.show_type=="post"&&this.current_image!=null&&this.image_list!=null){$("this_post").addClassName("clicked");setTimeout(function(){this.insertPostSlides();this.startPostSlides();this.setupSlideControls()}.bind(this),250)}else if(this.show_type=="post"&&this.current_image==null&&this.image_list==null){$("this_post").addClassName("clicked");
$("whole_site").addClassName("clicked");setTimeout(function(){this.insertPostSlides();this.setupSlideControls()}.bind(this),1E3)}this.boundKeyboardSlides=this.keyboardSlides.bind(this);this.boundStopSlides=this.stopSlides.bind(this);Event.observe(document.onresize?document:window,"resize",function(){this.resizeImages()}.bind(this))},setupPostSlideshow:function(){if($("slide_div")==undefined){this.slide_div=isIphone?new Element("div",{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:"+
window.innerHeight+"px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"}):new Element("div",{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:100%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"});
new Effect.Appear(document.body.appendChild(this.slide_div),{duration:0.5})}else new Effect.Appear($("slide_div"),{duration:0.5});!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"hidden"});if(this.slide_div!=undefined){if(this.autoplay==true&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'});
else if(this.autoplay==true&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="navigation">                <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>              </div>            </div>         </div>'});
else if(this.autoplay==false&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'});
else if(this.autoplay==false&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>              </div>           </div>'});
else this.autoplay==true?this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close" ><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'}):
this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'});
if(($$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):false)=="true"){var a=new Element("div",{"class":"event_slideshow_instructions"});a.insert({top:'          <div id="post-to">             Post your photos using Posterous Mobile       \t\t</div>'});this.slide_div.insert({top:a})}}isIphone&&noTouchMove()},resizeImages:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||
window.document.documentElement.clientWidth||window.document.body.clientWidth,c=a/b;$$("img.img").each(function(d){currentFactor=d.readAttribute("scaling-factor");if(c>currentFactor)!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8?d.writeAttribute({width:"100%",height:"","scaling-factor":currentFactor}):d.writeAttribute({width:b+"px",height:b/currentFactor+"px","scaling-factor":currentFactor});else!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8?d.writeAttribute({height:"100%",
width:"","scaling-factor":currentFactor}):d.writeAttribute({height:a+"px",width:a/currentFactor+"px","scaling-factor":currentFactor})})},insertPostSlides:function(){var a=this,b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,d=b/c;$("slideshow_loading").show();console.log("inserting post slides");if(this.current_image){var g=this.current_image;if(g.large!=
null){var e=parseInt(g.largeWidth),j=parseInt(g.largeHeight),k=j/e;image=new Element("img",{src:g.large,"class":"img","scaling-factor":k})}else{e=parseInt(g.imageObj.width);j=parseInt(g.imageObj.height);k=j/e;image=new Element("img",{src:g.imageObj.src,"class":"img","scaling-factor":k})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>k?image.writeAttribute({width:c+"px",height:c/k+"px"}):image.writeAttribute({height:b+"px",width:b/k+"px"});else if(Prototype.Browser.IE7||
Prototype.Browser.IE6)if(d>k){var m=c/e*j;image.writeAttribute({height:m,width:c})}else{m=b/j*e;image.writeAttribute({height:b,width:m})}else d>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({top:slide.insert({top:image})});slideCount+=1}if(this.image_list!=null||
this.current_image!=null){for(var q=0,w=this.image_list.length;q<w;++q){m=this.image_list[q];if(this.image_list[q]!=g){if(m.large!=null){e=parseInt(m.largeWidth);j=parseInt(m.largeHeight);k=j/e;image=new Element("img",{src:m.large,"class":"img","scaling-factor":k})}else{e=parseInt(m.imageObj.width);j=parseInt(m.imageObj.height);k=j/e;image=new Element("img",{src:m.imageObj.src,"class":"img","scaling-factor":k})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>
k?image.writeAttribute({width:c+"px",height:c/k+"px"}):image.writeAttribute({height:b+"px",width:b/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>k){m=c/e*j;image.writeAttribute({height:m,width:c})}else{m=b/j*e;image.writeAttribute({height:b,width:m})}else d>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});
$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){if(a.autoplay){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause")}else a.stopSlides();a.playSlides()}else console.log("no autoplay")},100)}else{$("slidesource").childElements();new Ajax.Request("/api/v2/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.post_id+"/photos",{method:"get",onLoading:function(){$("slideshow_loading").show()},
onSuccess:function(u){u=u.responseText.evalJSON();for(var r=0,v=u.length;r<v;++r){var h=u[r];if(h.scaled1000!=undefined){e=h.scaled1000.width;j=h.scaled1000.height;k=j/e;image=new Element("img",{src:h.scaled1000.url,alt:h.scaled1000.caption,"data-id":h.scaled1000.post_id,"class":"img","scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>k?image.writeAttribute({width:c+"px",height:c/k+"px"}):image.writeAttribute({height:b+"px",width:b/k+
"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>k){h=c/e*j;image.writeAttribute({height:h,width:c})}else{h=b/j*e;image.writeAttribute({height:b,width:h})}else d>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(h.scaled500){e=
h.scaled500.width;j=h.scaled500.height;k=j/e;image=new Element("img",{src:h.scaled500.url,alt:h.scaled500.caption,"data-id":h.scaled500.post_id,"class":"img","scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>k?image.writeAttribute({width:c+"px",height:c/k+"px"}):image.writeAttribute({height:b+"px",width:b/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>k){h=c/e*j;image.writeAttribute({height:h,width:c})}else{h=b/j*
e;image.writeAttribute({height:b,width:h})}else d>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(h.full){e=h.full.width;j=h.full.height;k=j/e;image=new Element("img",{src:h.full.url,alt:h.full.caption,"data-id":h.full.post_id,"class":"img",
"scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>k?image.writeAttribute({width:c+"px",height:c/k+"px"}):image.writeAttribute({height:b+"px",width:b/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>k){h=c/e*j;image.writeAttribute({height:h,width:c})}else{h=b/j*e;image.writeAttribute({height:b,width:h})}else d>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",
style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var l=$("slidesource").childElements().first();slides=$("slidesource").childElements();l.addClassName("activeslide");l.appear()},500)},onFailure:function(){alert("Weird, something went wrong with the slideshow for this post. Try refreshing your browser.")},onComplete:function(){if(a.autoplay==
true&&$("slidesource").childElements().length>1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause")}else a.stopSlides();a.playSlides()}}})}},startPostSlides:function(){var a=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(a==undefined){a=$("slidesource").down(".slide");slides=$("slidesource").childElements();a.addClassName("activeslide");a.appear({duration:0.5})}else a.appear({duration:0.5})},
startThreadSlides:function(){var a=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(a==undefined){a=$("slidesource").down(".slide");slides=$("slidesource").childElements();a.addClassName("activeslide");a.appear({duration:0.5})}else a.appear({duration:0.5});if(this.autoplay&&this.reply_ids.length<1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause")}else this.stopSlides();this.playSlides()}},
setupSlideControls:function(){document.observe("keydown",this.keyboardSlides.bind(this));$("nextslide").observe("click",function(){$("slidesource").childElements().length>1&&this.nextSlide()}.bind(this));$("prevslide").observe("click",function(){$("slidesource").childElements().length>1&&this.prevSlide()}.bind(this));$("pauseplay").observe("click",function(){if($("slidesource").childElements().length>1)if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");
this.playSlides()}else if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}}.bind(this));$("close").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides);$("slide_div")!=undefined&&$("slide_div").remove()}});
!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"});isIphone&&doTouchMove();this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/")}.bind(this));$("this_post")!=undefined&&$("this_post").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}if(!$("this_post").hasClassName("on")){$("whole_site").removeClassName("on");
$("this_post").addClassName("on");this.switchSlideshow();this.insertPostSlides();this.startPostSlides()}if(this.slug!=undefined&&this.show_type=="site")slideshow.setLocation("#!/"+this.slug+"/slideshow");else this.slug!=undefined&&this.show_type=="post"&&slideshow.setLocation("#!/slideshow")}.bind(this));$("this_thread")!=undefined&&$("this_thread").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}if(!$("this_thread").hasClassName("on")){$("whole_site").removeClassName("on");
$("this_thread").addClassName("on");this.switchSlideshow();this.insertThreadSlides();this.insertThreadReplySlides();this.current_image!=null&&this.startThreadSlides()}this.slug!=undefined&&slideshow.setLocation("/#!/"+this.slug+"/slideshow")}.bind(this));if($("whole_site")!=undefined){pageAttempts=0;$("whole_site").observe("click",function(){if(!$("whole_site").hasClassName("on")){if($("this_post"))$("this_post").removeClassName("on");else $("this_thread")&&$("this_thread").removeClassName("on");
$("whole_site").addClassName("clicked");$("whole_site").addClassName("on");this.insertSiteSlides()}if(this.show_type=="site"||this.show_type=="post")slideshow.setLocation("#!/slideshow")}.bind(this))}document.observe("load",function(){setTimeout(function(){$("controls-wrapper").hide();$("close").hide()},4500)}.bind(this));document.observe("mousemove",function(){clearTimeout(this.controltimer);$("controls-wrapper")!=undefined&&$("controls-wrapper").show();$("close")!=undefined&&$("close").show();this.controltimer=
setTimeout(function(){$("controls-wrapper")!=undefined&&$("controls-wrapper").hide();$("close")!=undefined&&$("close").hide()},4500)}.bind(this))},keyboardSlides:function(a){var b=$("slidesource").childElements();a=a.charCode||a.keyCode;if(b.length>1)if(a==37)this.prevSlide();else if(a==39)this.nextSlide();else if(a==32)if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");this.playSlides()}else if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");
$("pauseplay").addClassName("play");this.stopSlides()}if(a==27){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides);$("slide_div")!=undefined&&$("slide_div").remove()}});!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"});
this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/")}},nextSlide:function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}active_slide=$$("#slidesource .activeslide").first();next_slide=active_slide.next(".slide");if(next_slide==undefined){next_slide=$("slidesource").down(".slide");slideCount<currentSlideLength&&this.updateSiteSlides()}active_slide.removeClassName("activeslide");
next_slide.addClassName("activeslide");if(!next_slide.hasClassName("clicked")){slideCount+=1;next_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))this.updateSiteSlides();else if(currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))){console.log("update slides");this.updateSiteSlides()}active_slide.fade();
next_slide.appear()},prevSlide:function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}active_slide=$$("#slidesource .activeslide").first();prev_slide=active_slide.previous(".slide");if(prev_slide==undefined){prev_slide=$("slidesource").childElements().last();slideCount<currentSlideLength&&this.updateSiteSlides()}active_slide.removeClassName("activeslide");prev_slide.addClassName("activeslide");if(!prev_slide.hasClassName("clicked")){slideCount+=
1;prev_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))this.updateSiteSlides();else if(currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))this.updateSiteSlides();active_slide.fade();prev_slide.appear()},playSlides:function(){var a=this;slideshowTimer=window.setInterval(function(){active_slide=$$("#slidesource .activeslide").first();
if(active_slide!=undefined){next_slide=active_slide.next(".slide");if(next_slide==undefined){next_slide=$("slidesource").down(".slide");slideCount<currentSlideLength&&a.updateSiteSlides()}active_slide.removeClassName("activeslide");next_slide.addClassName("activeslide");if(!next_slide.hasClassName("clicked")){slideCount+=1;next_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))a.updateSiteSlides();
else if(currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))a.updateSiteSlides();active_slide.fade();next_slide.appear()}},7E3)},stopSlides:function(){window.clearInterval(slideshowTimer);return false},insertThreadSlides:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,
c=a/b;image_sources=[];var d=this;console.log("inserting thread slides");if(this.current_image){var g=this.current_image;if(g.large!=null){image_sources.push(g.large);var e=parseInt(g.largeWidth),j=parseInt(g.largeHeight),k=j/e;image=new Element("img",{src:g.large,"class":"img","scaling-factor":k})}else{e=parseInt(g.imageObj.width);j=parseInt(g.imageObj.height);k=j/e;image=new Element("img",{src:g.imageObj.src,"class":"img","scaling-factor":k})}if(isIphone)image.writeAttribute("height",window.innerHeight);
else if(Prototype.Browser.IE8)c>k?image.writeAttribute({width:b+"px",height:b/k+"px"}):image.writeAttribute({height:a+"px",width:a/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>k){var m=b/e*j;image.writeAttribute({height:m,width:b})}else{m=a/j*e;image.writeAttribute({height:a,width:m})}else c>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"});if(Prototype.Browser.IE7||
Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({top:slide.insert({top:image})});slideCount+=1}if(this.image_list!=null||this.current_image!=null)for(var q=0,w=this.image_list.length;q<w;++q){m=this.image_list[q];if(this.image_list[q]!=g){if(m.large!=null){image_sources.push(m.large);e=parseInt(m.largeWidth);j=parseInt(m.largeHeight);k=j/e;image=new Element("img",{src:m.large,"class":"img","scaling-factor":k})}else{image_sources.push(m.imageObj.src);
e=parseInt(m.imageObj.width);j=parseInt(m.imageObj.height);k=j/e;image=new Element("img",{src:m.imageObj.src,"class":"img","scaling-factor":k})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>k?image.writeAttribute({width:b+"px",height:b/k+"px"}):image.writeAttribute({height:a+"px",width:a/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>k){m=b/e*j;image.writeAttribute({height:m,width:b})}else{m=a/j*e;image.writeAttribute({height:a,width:m})}else c>
k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}else{$("slidesource").childElements();image_sources=[];new Ajax.Request("/api/v2/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.thread_id+"/photos",{method:"get",onLoading:function(){$("slideshow_loading").show()},
onSuccess:function(u){u=u.responseText.evalJSON();for(var r=0,v=u.length;r<v;++r){var h=u[r];if(h.scaled1000!=undefined){image_sources.push(h.scaled1000.url);e=h.scaled1000.width;j=h.scaled1000.height;k=j/e;image=new Element("img",{src:h.scaled1000.url,alt:h.scaled1000.caption,"data-id":h.scaled1000.post_id,"class":"img","scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>k?image.writeAttribute({width:b+"px",height:b/k+"px"}):image.writeAttribute({height:a+
"px",width:a/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>k){h=b/e*j;image.writeAttribute({height:h,width:b})}else{h=a/j*e;image.writeAttribute({height:a,width:h})}else c>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(h.scaled500){image_sources.push(h.scaled500.url);
e=h.scaled500.width;j=h.scaled500.height;k=j/e;image=new Element("img",{src:h.scaled500.url,alt:h.scaled500.caption,"data-id":h.scaled500.post_id,"class":"img","scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>k?image.writeAttribute({width:b+"px",height:b/k+"px"}):image.writeAttribute({height:a+"px",width:a/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>k){h=b/e*j;image.writeAttribute({height:h,width:b})}else{h=a/
j*e;image.writeAttribute({height:a,width:h})}else c>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(h.full){image_sources.push(h.full.url);e=h.full.width;j=h.full.height;k=j/e;image=new Element("img",{src:h.full.url,alt:h.full.caption,"data-id":h.full.post_id,
"class":"img","scaling-factor":k});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>k?image.writeAttribute({width:b+"px",height:b/k+"px"}):image.writeAttribute({height:a+"px",width:a/k+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>k){h=b/e*j;image.writeAttribute({height:h,width:b})}else{h=a/j*e;image.writeAttribute({height:a,width:h})}else c>k?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",
{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var l=$("slidesource").childElements().first();slides=$("slidesource").childElements();l.addClassName("activeslide");l.appear()},500);if(d.autoplay&&d.reply_ids.length<1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");
$("pauseplay").addClassName("pause")}else d.stopSlides();d.playSlides()}},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})}},insertThreadReplySlides:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,c=a/b,d=this;$("slidesource").childElements();console.log("inserting thread reply slides");
for(var g=0,e=this.reply_ids.length;g<e;++g)new Ajax.Request("/api/v2/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.reply_ids[g]+"/photos",{method:"get",onSuccess:function(j){j=j.responseText.evalJSON();for(var k=0,m=j.length;k<m;++k){var q=j[k];if(q.scaled1000&&image_sources.include(q.scaled1000.url)||q.scaled500&&image_sources.include(q.scaled500.url)||q.full&&image_sources.include(q.full.url))console.log("has image");else{console.log("new image");if(q.scaled1000!=undefined){image_sources.push(q.scaled1000.url);
currentWidth=q.scaled1000.width;currentHeight=q.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:q.scaled1000.url,alt:q.scaled1000.caption,"data-id":q.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||
Prototype.Browser.IE6)if(c>currentFactor){q=b/currentWidth*currentHeight;image.writeAttribute({height:q,width:b})}else{q=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:q})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(q.scaled500){image_sources.push(q.scaled500.url);
currentWidth=q.scaled500.width;currentHeight=q.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:q.scaled500.url,alt:q.scaled500.caption,"data-id":q.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||
Prototype.Browser.IE6)if(c>currentFactor){q=b/currentWidth*currentHeight;image.writeAttribute({height:q,width:b})}else{q=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:q})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(q.full){image_sources.push(q.full.url);
currentWidth=q.full.width;currentHeight=q.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:q.full.url,alt:q.full.caption,"data-id":q.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>
currentFactor){q=b/currentWidth*currentHeight;image.writeAttribute({height:q,width:b})}else{q=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:q})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}}setTimeout(function(){if(d.autoplay==
true){if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause")}else d.stopSlides();d.playSlides()}},1E3)},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})},insertSiteSlides:function(a){var b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,
d=b/c,g=$("slidesource").childElements(),e=[];currentPages=[];image_post_ids=[];var j=this,k=a?pageAttempts==3&&a!=1?1:pageAttempts>=3?a+1:rand(30):rand(30);a="/api/v2/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+k;console.log("inserting site slides");active_slide=$$("#slidesource .activeslide").first();active_slide!=undefined&&active_slide.fade({duration:1});if(g.length>0){for(var m=0,q=g.length;m<q;++m){var w=g[m];w.remove()}if(this.image_list!=null||this.current_image!=null){m=0;
for(q=this.image_list.length;m<q;++m){w=this.image_list[m];w.large!=null?e.push(w.large):e.push(w.imageObj.src)}}}new Ajax.Request(a,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(u){u=u.responseText.evalJSON();if(u.length==0){pageAttempts+=1;if(pageAttempts>=30){new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keyup",this.boundKeyboardSlides);$("slide_div")!=undefined&&$("slide_div").remove()}});!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&
!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"});this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/");alert("We can't seem to find any photos for this site.")}else{currentPages.push(k);j.insertSiteSlides(k)}}else{slideCount=pageAttempts=0;currentPage=k;currentPages.push(k);currentSlideLength=u.length;var r=u[0];if(r.scaled1000){image_post_ids.push(r.scaled1000.post_id);currentWidth=
r.scaled1000.width;currentHeight=r.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.scaled1000.url,alt:r.scaled1000.caption,"data-id":r.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||
Prototype.Browser.IE6)if(d>currentFactor){r=c/currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(r.scaled500){image_post_ids.push(r.scaled500.post_id);
currentWidth=r.scaled500.width;currentHeight=r.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.scaled500.url,alt:r.scaled500.caption,"data-id":r.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||
Prototype.Browser.IE6)if(d>currentFactor){r=c/currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(r.full){image_post_ids.push(r.full.post_id);
currentWidth=r.full.width;currentHeight=r.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.full.url,alt:r.full.caption,"data-id":r.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>
currentFactor){r=c/currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}setTimeout(function(){active_slide=
$("slidesource").down(".activeslide");slide=$("slidesource").down(".slide");if(active_slide==undefined&&slide!=undefined){$("slideshow_loading").hide();slide.addClassName("activeslide");slide.addClassName("clicked");slideCount+=1;slide.appear()}},500);for(var v=1,h=u.length;v<h;++v){r=u[v];if(r.scaled1000){image_post_ids.push(r.scaled1000.post_id);currentWidth=r.scaled1000.width;currentHeight=r.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.scaled1000.url,
alt:r.scaled1000.caption,"data-id":r.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){r=c/currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*
currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(r.scaled500){image_post_ids.push(r.scaled500.post_id);currentWidth=r.scaled500.width;currentHeight=r.scaled500.height;
currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.scaled500.url,alt:r.scaled500.caption,"data-id":r.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){r=c/
currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(r.full){image_post_ids.push(r.full.post_id);
currentWidth=r.full.width;currentHeight=r.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:r.full.url,alt:r.full.caption,"data-id":r.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>
currentFactor){r=c/currentWidth*currentHeight;image.writeAttribute({height:r,width:c})}else{r=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:r})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){console.log("load photos and start slideshow");
if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause")}else j.stopSlides();j.playSlides()},1500)}},onFailure:function(){alert("Weird, something went wrong with the site wide slideshow. Try refreshing your browser.")}})},updateSiteSlides:function(a){if(!($("this_post")!=undefined&&$("this_post").hasClassName("on")||$("this_thread")!=undefined&&$("this_thread").hasClassName("on"))){var b=window.innerHeight||window.document.documentElement.clientHeight||
window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,d=b/c,g=$("slidesource").childElements(),e=[],j=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):false,k=this;if(a)if(pageAttempts==3)var m=1;else if(pageAttempts>3)if(currentPages.include(a))m=a+1;else currentPages.include(a)||(m=a);else m=rand(10);else m=rand(30);if(j=="true"){if(m!=1)if(currentPages.include(m))m+=1}else if(currentPages.include(m))m+=
1;a="/api/v2/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+m;console.log("updating site slides");if(g.length>0){j=0;for(var q=g.length;j<q;++j)e.push(g[j].readAttribute("data-id"))}new Ajax.Request(a,{method:"get",onSuccess:function(w){w=w.responseText.evalJSON();if(w.length==0||currentPages.include(m)&&m!=1){pageAttempts+=1;currentPages.push(m);k.updateSiteSlides(rand(30))}else{slideCount=pageAttempts=0;currentPage=m;currentPages.push(m);currentSlideLength=w.length;for(var u=0,r=w.length;u<
r;++u){var v=w[u];if(v.scaled1000&&image_post_ids.include(v.scaled1000.post_id))console.log("has image");else if(v.scaled500&&image_post_ids.include(v.scaled500.post_id))console.log("has image");else if(v.full&&image_post_ids.include(v.full.post_id))console.log("has image");else{console.log("new image");if(v.scaled1000){image_post_ids.push(v.scaled1000.post_id);currentWidth=v.scaled1000.width;currentHeight=v.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:v.scaled1000.url,
alt:v.scaled1000.caption,"data-id":v.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){v=c/currentWidth*currentHeight;image.writeAttribute({height:v,width:c})}else{v=b/currentHeight*
currentWidth;image.writeAttribute({height:b,width:v})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(v.scaled500){image_post_ids.push(v.scaled500.post_id);currentWidth=v.scaled500.width;currentHeight=v.scaled500.height;
currentFactor=currentHeight/currentWidth;image=new Element("img",{src:v.scaled500.url,alt:v.scaled500.caption,"data-id":v.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){v=c/
currentWidth*currentHeight;image.writeAttribute({height:v,width:c})}else{v=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:v})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(v.full){image_post_ids.push(v.full.post_id);
currentWidth=v.full.width;currentHeight=v.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:v.full.url,alt:v.full.caption,"data-id":v.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>
currentFactor){v=c/currentWidth*currentHeight;image.writeAttribute({height:v,width:c})}else{v=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:v})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}}}},onFailure:function(){return false}})}},
switchSlideshow:function(){var a=$("slidesource").childElements();active_slide=$$("#slidesource .activeslide").first();active_slide!=undefined&&active_slide.fade({duration:1});for(var b=0,c=a.length;b<c;++b)a[b].remove()}});function rand(a){return Math.floor(Math.random()*a+1)}function doTouchMove(a){document.ontouchmove=function(){return a}}function noTouchMove(){document.ontouchmove=function(a){a.preventDefault()}};
